<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE Dark Mode FAB Rendering Test</title>
    
    <!-- WordPress Admin Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dashicons/0.9.0/dashicons.min.css">
    
    <!-- MASE Styles -->
    <link rel="stylesheet" href="../assets/css/mase-admin.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            padding: 20px;
            background: #f0f0f1;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1d2327;
            margin-bottom: 10px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #2271b1;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .test-button {
            padding: 10px 20px;
            background: #2271b1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #135e96;
        }
        
        .test-button.secondary {
            background: #dcdcde;
            color: #2c3338;
        }
        
        .test-button.secondary:hover {
            background: #c3c4c7;
        }
        
        .test-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .test-result.success {
            background: #d5f4e6;
            border: 1px solid #00a32a;
            color: #00a32a;
        }
        
        .test-result.error {
            background: #fcf0f1;
            border: 1px solid #d63638;
            color: #d63638;
        }
        
        .test-result.info {
            background: #f0f6fc;
            border: 1px solid #2271b1;
            color: #2271b1;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.pass {
            background: #00a32a;
        }
        
        .status-indicator.fail {
            background: #d63638;
        }
        
        .status-indicator.pending {
            background: #dba617;
        }
        
        code {
            background: #f6f7f7;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ MASE Dark Mode FAB Rendering Test</h1>
        <p><strong>Task 6:</strong> Implement FAB rendering and event handling</p>
        <p><strong>Requirements:</strong> 1.1, 1.2, 1.3, 1.4, 1.7, 1.8</p>
        
        <!-- Test Section 1: FAB Rendering -->
        <div class="test-section">
            <h2>Test 1: FAB Rendering</h2>
            <p>Verify that the FAB is rendered correctly with proper structure and attributes.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testFABRendering()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test1-results')">Clear</button>
            </div>
            
            <div id="test1-results"></div>
        </div>
        
        <!-- Test Section 2: Icon Updates -->
        <div class="test-section">
            <h2>Test 2: Icon Updates</h2>
            <p>Verify that the icon switches between sun and moon based on mode.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testIconUpdates()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test2-results')">Clear</button>
            </div>
            
            <div id="test2-results"></div>
        </div>
        
        <!-- Test Section 3: Event Listeners -->
        <div class="test-section">
            <h2>Test 3: Event Listeners</h2>
            <p>Verify that click and hover events are properly attached.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testEventListeners()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test3-results')">Clear</button>
            </div>
            
            <div id="test3-results"></div>
        </div>
        
        <!-- Test Section 4: Tooltip Behavior -->
        <div class="test-section">
            <h2>Test 4: Tooltip Behavior</h2>
            <p>Verify that tooltip shows/hides correctly.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testTooltipBehavior()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test4-results')">Clear</button>
            </div>
            
            <div id="test4-results"></div>
        </div>
        
        <!-- Test Section 5: ARIA Attributes -->
        <div class="test-section">
            <h2>Test 5: ARIA Attributes</h2>
            <p>Verify that ARIA attributes are properly set and updated.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testARIAAttributes()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test5-results')">Clear</button>
            </div>
            
            <div id="test5-results"></div>
        </div>
        
        <!-- Test Section 6: Transition Prevention -->
        <div class="test-section">
            <h2>Test 6: Rapid Click Prevention</h2>
            <p>Verify that rapid clicking is prevented during transitions.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="testRapidClickPrevention()">Run Test</button>
                <button class="test-button secondary" onclick="clearResults('test6-results')">Clear</button>
            </div>
            
            <div id="test6-results"></div>
        </div>
        
        <!-- Manual Test Section -->
        <div class="test-section">
            <h2>Manual Test: Interactive FAB</h2>
            <p>Click the FAB button in the bottom-right corner to test interactivity.</p>
            
            <div class="test-controls">
                <button class="test-button" onclick="initializeFAB()">Initialize FAB</button>
                <button class="test-button secondary" onclick="removeFAB()">Remove FAB</button>
            </div>
            
            <div id="manual-test-results"></div>
        </div>
    </div>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- MASE Admin JS -->
    <script src="../assets/js/mase-admin.js"></script>
    
    <script>
        // Mock WordPress admin data
        var maseAdmin = {
            nonce: 'test-nonce-12345',
            ajaxUrl: '/wp-admin/admin-ajax.php',
            darkMode: {
                userPreference: 'light'
            }
        };
        
        var ajaxurl = '/wp-admin/admin-ajax.php';
        
        // Helper functions
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            
            const indicator = document.createElement('span');
            indicator.className = `status-indicator ${type === 'success' ? 'pass' : type === 'error' ? 'fail' : 'pending'}`;
            
            resultDiv.appendChild(indicator);
            resultDiv.appendChild(document.createTextNode(message));
            container.appendChild(resultDiv);
        }
        
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }
        
        // Test 1: FAB Rendering
        function testFABRendering() {
            clearResults('test1-results');
            
            try {
                // Initialize dark mode toggle
                MASE.darkModeToggle.init();
                
                // Check if FAB exists
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test1-results', '‚ùå FAIL: FAB not rendered', 'error');
                    return;
                }
                logResult('test1-results', '‚úì PASS: FAB element exists', 'success');
                
                // Check FAB structure
                const hasIcon = $fab.find('.dashicons').length > 0;
                if (!hasIcon) {
                    logResult('test1-results', '‚ùå FAIL: FAB missing icon', 'error');
                    return;
                }
                logResult('test1-results', '‚úì PASS: FAB has icon element', 'success');
                
                const hasTooltip = $fab.find('.mase-fab-tooltip').length > 0;
                if (!hasTooltip) {
                    logResult('test1-results', '‚ùå FAIL: FAB missing tooltip', 'error');
                    return;
                }
                logResult('test1-results', '‚úì PASS: FAB has tooltip element', 'success');
                
                const hasSRText = $fab.find('.sr-only').length > 0;
                if (!hasSRText) {
                    logResult('test1-results', '‚ùå FAIL: FAB missing screen reader text', 'error');
                    return;
                }
                logResult('test1-results', '‚úì PASS: FAB has screen reader text', 'success');
                
                // Check positioning
                const position = $fab.css('position');
                if (position !== 'fixed') {
                    logResult('test1-results', `‚ùå FAIL: FAB position is ${position}, expected fixed`, 'error');
                    return;
                }
                logResult('test1-results', '‚úì PASS: FAB has fixed positioning', 'success');
                
                logResult('test1-results', '‚úÖ All FAB rendering tests passed!', 'success');
                
            } catch (error) {
                logResult('test1-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Test 2: Icon Updates
        function testIconUpdates() {
            clearResults('test2-results');
            
            try {
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test2-results', '‚ùå FAIL: FAB not found. Run Test 1 first.', 'error');
                    return;
                }
                
                const $icon = $fab.find('.dashicons');
                
                // Test light mode icon
                MASE.darkModeToggle.state.currentMode = 'light';
                MASE.darkModeToggle.updateIcon();
                
                if (!$icon.hasClass('dashicons-moon')) {
                    logResult('test2-results', '‚ùå FAIL: Light mode should show moon icon', 'error');
                    return;
                }
                logResult('test2-results', '‚úì PASS: Light mode shows moon icon', 'success');
                
                // Test dark mode icon
                MASE.darkModeToggle.state.currentMode = 'dark';
                MASE.darkModeToggle.updateIcon();
                
                if (!$icon.hasClass('dashicons-sun')) {
                    logResult('test2-results', '‚ùå FAIL: Dark mode should show sun icon', 'error');
                    return;
                }
                logResult('test2-results', '‚úì PASS: Dark mode shows sun icon', 'success');
                
                logResult('test2-results', '‚úÖ All icon update tests passed!', 'success');
                
            } catch (error) {
                logResult('test2-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Test 3: Event Listeners
        function testEventListeners() {
            clearResults('test3-results');
            
            try {
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test3-results', '‚ùå FAIL: FAB not found. Run Test 1 first.', 'error');
                    return;
                }
                
                // Check if click event is attached
                const events = $._data($fab[0], 'events');
                if (!events || !events.click) {
                    logResult('test3-results', '‚ùå FAIL: Click event not attached', 'error');
                    return;
                }
                logResult('test3-results', '‚úì PASS: Click event attached', 'success');
                
                // Check if hover events are attached
                if (!events.mouseenter || !events.mouseleave) {
                    logResult('test3-results', '‚ùå FAIL: Hover events not attached', 'error');
                    return;
                }
                logResult('test3-results', '‚úì PASS: Hover events attached', 'success');
                
                // Check if keyboard event is attached
                if (!events.keydown) {
                    logResult('test3-results', '‚ùå FAIL: Keyboard event not attached', 'error');
                    return;
                }
                logResult('test3-results', '‚úì PASS: Keyboard event attached', 'success');
                
                logResult('test3-results', '‚úÖ All event listener tests passed!', 'success');
                
            } catch (error) {
                logResult('test3-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Test 4: Tooltip Behavior
        function testTooltipBehavior() {
            clearResults('test4-results');
            
            try {
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test4-results', '‚ùå FAIL: FAB not found. Run Test 1 first.', 'error');
                    return;
                }
                
                const $tooltip = $fab.find('.mase-fab-tooltip');
                
                // Test show tooltip
                MASE.darkModeToggle.showTooltip();
                if (!$tooltip.hasClass('mase-fab-tooltip-visible')) {
                    logResult('test4-results', '‚ùå FAIL: Tooltip not shown', 'error');
                    return;
                }
                logResult('test4-results', '‚úì PASS: Tooltip shown successfully', 'success');
                
                // Test hide tooltip
                MASE.darkModeToggle.hideTooltip();
                if ($tooltip.hasClass('mase-fab-tooltip-visible')) {
                    logResult('test4-results', '‚ùå FAIL: Tooltip not hidden', 'error');
                    return;
                }
                logResult('test4-results', '‚úì PASS: Tooltip hidden successfully', 'success');
                
                logResult('test4-results', '‚úÖ All tooltip tests passed!', 'success');
                
            } catch (error) {
                logResult('test4-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Test 5: ARIA Attributes
        function testARIAAttributes() {
            clearResults('test5-results');
            
            try {
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test5-results', '‚ùå FAIL: FAB not found. Run Test 1 first.', 'error');
                    return;
                }
                
                // Check initial ARIA attributes
                const ariaLabel = $fab.attr('aria-label');
                if (!ariaLabel) {
                    logResult('test5-results', '‚ùå FAIL: aria-label not set', 'error');
                    return;
                }
                logResult('test5-results', `‚úì PASS: aria-label set to "${ariaLabel}"`, 'success');
                
                const ariaPressed = $fab.attr('aria-pressed');
                if (!ariaPressed) {
                    logResult('test5-results', '‚ùå FAIL: aria-pressed not set', 'error');
                    return;
                }
                logResult('test5-results', `‚úì PASS: aria-pressed set to "${ariaPressed}"`, 'success');
                
                const role = $fab.attr('role');
                if (role !== 'switch') {
                    logResult('test5-results', '‚ùå FAIL: role should be "switch"', 'error');
                    return;
                }
                logResult('test5-results', '‚úì PASS: role set to "switch"', 'success');
                
                // Test ARIA updates
                MASE.darkModeToggle.state.currentMode = 'dark';
                MASE.darkModeToggle.updateIcon();
                
                const newAriaPressed = $fab.attr('aria-pressed');
                if (newAriaPressed !== 'true') {
                    logResult('test5-results', '‚ùå FAIL: aria-pressed not updated to "true" for dark mode', 'error');
                    return;
                }
                logResult('test5-results', '‚úì PASS: aria-pressed updated correctly', 'success');
                
                logResult('test5-results', '‚úÖ All ARIA attribute tests passed!', 'success');
                
            } catch (error) {
                logResult('test5-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Test 6: Rapid Click Prevention
        function testRapidClickPrevention() {
            clearResults('test6-results');
            
            try {
                const $fab = $('.mase-dark-mode-fab');
                if ($fab.length === 0) {
                    logResult('test6-results', '‚ùå FAIL: FAB not found. Run Test 1 first.', 'error');
                    return;
                }
                
                // Set transitioning state
                MASE.darkModeToggle.state.isTransitioning = true;
                
                // Try to toggle (should be prevented)
                const initialMode = MASE.darkModeToggle.state.currentMode;
                MASE.darkModeToggle.toggle();
                
                // Mode should not change during transition
                if (MASE.darkModeToggle.state.currentMode !== initialMode) {
                    logResult('test6-results', '‚ùå FAIL: Toggle not prevented during transition', 'error');
                    return;
                }
                logResult('test6-results', '‚úì PASS: Rapid clicking prevented during transition', 'success');
                
                // Reset state
                MASE.darkModeToggle.state.isTransitioning = false;
                
                logResult('test6-results', '‚úÖ Rapid click prevention test passed!', 'success');
                
            } catch (error) {
                logResult('test6-results', `‚ùå ERROR: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Manual test functions
        function initializeFAB() {
            clearResults('manual-test-results');
            try {
                MASE.darkModeToggle.init();
                logResult('manual-test-results', '‚úì FAB initialized. Check bottom-right corner.', 'success');
            } catch (error) {
                logResult('manual-test-results', `‚ùå ERROR: ${error.message}`, 'error');
            }
        }
        
        function removeFAB() {
            $('.mase-dark-mode-fab').remove();
            logResult('manual-test-results', '‚úì FAB removed', 'info');
        }
        
        // Auto-initialize on page load
        $(document).ready(function() {
            console.log('Test page loaded');
            logResult('manual-test-results', '‚ÑπÔ∏è Click "Initialize FAB" to start manual testing', 'info');
        });
    </script>
</body>
</html>
