<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 12: Template Manager Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f1;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1d2327;
            border-bottom: 2px solid #2271b1;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #2271b1;
            margin-top: 0;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .test-result.pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .mase-template-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            display: inline-block;
            width: 250px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .mase-template-card.active {
            border: 2px solid #2271b1;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .mase-template-card.selected {
            border: 2px solid #2271b1;
        }
        
        .mase-template-info {
            margin-bottom: 10px;
        }
        
        .mase-template-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .mase-template-description {
            font-size: 13px;
            color: #666;
        }
        
        .mase-active-badge {
            display: inline-block;
            background: #2271b1;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .button {
            display: inline-block;
            padding: 8px 16px;
            background: #2271b1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin-right: 5px;
        }
        
        .button:hover {
            background: #135e96;
        }
        
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .button-secondary {
            background: #f0f0f1;
            color: #2c3338;
        }
        
        .button-secondary:hover {
            background: #dcdcde;
        }
        
        .button-link-delete {
            background: transparent;
            color: #b32d2e;
        }
        
        .button-link-delete:hover {
            color: #8a2424;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #test-results {
            margin-top: 20px;
        }
        
        .notice {
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .notice-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .notice-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .notice-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>Task 12: Template Manager Implementation Test</h1>
    
    <div class="test-section">
        <h2>Requirements Coverage</h2>
        <ul>
            <li><strong>Requirement 2.1:</strong> Display template gallery</li>
            <li><strong>Requirement 2.2:</strong> Display template preview on General tab</li>
            <li><strong>Requirement 2.3:</strong> Navigate to Templates tab</li>
            <li><strong>Requirement 2.4:</strong> Apply, save, and delete templates</li>
            <li><strong>Requirement 2.5:</strong> Show active template badge</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>Template Gallery (Requirement 2.1)</h2>
        <div id="template-gallery">
            <div class="mase-template-card active" data-template-id="modern-minimal">
                <div class="mase-template-info">
                    <div class="mase-template-name">Modern Minimal</div>
                    <div class="mase-template-description">Clean and minimal design</div>
                </div>
                <div class="mase-template-actions">
                    <button class="button mase-template-apply-btn" data-template-id="modern-minimal">Apply</button>
                    <button class="button button-secondary mase-template-preview-btn" data-template-id="modern-minimal">Preview</button>
                </div>
            </div>
            
            <div class="mase-template-card" data-template-id="dark-elegance">
                <div class="mase-template-info">
                    <div class="mase-template-name">Dark Elegance</div>
                    <div class="mase-template-description">Sophisticated dark theme</div>
                </div>
                <div class="mase-template-actions">
                    <button class="button mase-template-apply-btn" data-template-id="dark-elegance">Apply</button>
                    <button class="button button-secondary mase-template-preview-btn" data-template-id="dark-elegance">Preview</button>
                </div>
            </div>
            
            <div class="mase-template-card" data-template-id="custom-template-1">
                <div class="mase-template-info">
                    <div class="mase-template-name">My Custom Template</div>
                    <div class="mase-template-description">Custom saved template</div>
                </div>
                <div class="mase-template-actions">
                    <button class="button mase-template-apply-btn" data-template-id="custom-template-1">Apply</button>
                    <button class="button button-link-delete mase-template-delete-btn" data-template-id="custom-template-1">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Save Custom Template (Requirement 2.4)</h2>
        <div class="form-group">
            <label for="custom-template-name">Template Name:</label>
            <input type="text" id="custom-template-name" placeholder="Enter template name">
        </div>
        <button class="button" id="mase-save-custom-template-btn">Save Custom Template</button>
    </div>
    
    <div class="test-section">
        <h2>View All Templates Link (Requirement 2.3)</h2>
        <a href="#" id="mase-view-all-templates-link" class="button button-secondary">View All Templates</a>
    </div>
    
    <div id="mase-notices"></div>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <button class="button" onclick="runTests()">Run All Tests</button>
        <div id="test-results"></div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock MASE object structure
        var MASE = {
            config: {
                ajaxUrl: '/wp-admin/admin-ajax.php',
                nonce: 'test-nonce-12345',
                debounceDelay: 300
            },
            
            state: {
                currentTemplate: 'modern-minimal',
                isDirty: false
            },
            
            templateManager: {
                apply: function(templateId) {
                    var self = MASE;
                    self.showNotice('info', 'Applying template: ' + templateId, false);
                    
                    // Simulate AJAX call
                    setTimeout(function() {
                        self.state.currentTemplate = templateId;
                        self.templateManager.updateActiveBadge(templateId);
                        self.showNotice('success', 'Template "' + templateId + '" applied successfully!');
                    }, 500);
                },
                
                save: function(name, settings) {
                    var self = MASE;
                    
                    if (!name || name.trim() === '') {
                        self.showNotice('error', 'Please enter a template name');
                        return;
                    }
                    
                    self.showNotice('info', 'Saving custom template: ' + name, false);
                    
                    // Simulate AJAX call
                    setTimeout(function() {
                        self.showNotice('success', 'Custom template "' + name + '" saved successfully!');
                    }, 500);
                },
                
                delete: function(templateId) {
                    var self = MASE;
                    
                    if (!confirm('Are you sure you want to delete this custom template? This action cannot be undone.')) {
                        return;
                    }
                    
                    self.showNotice('info', 'Deleting custom template: ' + templateId, false);
                    
                    // Simulate AJAX call
                    setTimeout(function() {
                        $('.mase-template-card[data-template-id="' + templateId + '"]').fadeOut(300, function() {
                            $(this).remove();
                        });
                        self.showNotice('success', 'Custom template deleted successfully!');
                    }, 500);
                },
                
                updateActiveBadge: function(templateId) {
                    // Remove all active badges and classes
                    $('.mase-template-card').removeClass('active');
                    $('.mase-active-badge').remove();
                    
                    // Add active class and badge to the selected template
                    var $templateCard = $('.mase-template-card[data-template-id="' + templateId + '"]');
                    $templateCard.addClass('active');
                    
                    // Add active badge if it doesn't exist
                    if ($templateCard.find('.mase-active-badge').length === 0) {
                        $templateCard.find('.mase-template-info').append(
                            '<span class="mase-active-badge">Active</span>'
                        );
                    }
                },
                
                collectSettings: function() {
                    return {
                        palettes: { current: 'professional-blue' },
                        templates: { current: 'modern-minimal' },
                        typography: {},
                        visual_effects: {},
                        effects: {},
                        advanced: {},
                        mobile: {},
                        accessibility: {}
                    };
                }
            },
            
            showNotice: function(type, message, dismissible) {
                dismissible = typeof dismissible !== 'undefined' ? dismissible : true;
                
                var $notice = $('<div class="notice notice-' + type + '"><p>' + message + '</p></div>');
                $('#mase-notices').html($notice);
                
                if (type !== 'error') {
                    setTimeout(function() {
                        $notice.fadeOut(400, function() {
                            $(this).remove();
                        });
                    }, 3000);
                }
            },
            
            switchTab: function(tabId) {
                MASE.showNotice('info', 'Switching to tab: ' + tabId);
            }
        };
        
        // Bind events
        $(document).ready(function() {
            // Template apply button
            $(document).on('click', '.mase-template-apply-btn', function(e) {
                e.preventDefault();
                var templateId = $(this).data('template-id');
                MASE.templateManager.apply(templateId);
            });
            
            // Save custom template button
            $(document).on('click', '#mase-save-custom-template-btn', function(e) {
                e.preventDefault();
                var name = $('#custom-template-name').val();
                var settings = MASE.templateManager.collectSettings();
                MASE.templateManager.save(name, settings);
            });
            
            // Delete custom template button
            $(document).on('click', '.mase-template-delete-btn', function(e) {
                e.preventDefault();
                var templateId = $(this).data('template-id');
                MASE.templateManager.delete(templateId);
            });
            
            // Template card hover
            $(document).on('mouseenter', '.mase-template-card', function() {
                $(this).css({
                    'transform': 'translateY(-4px)',
                    'box-shadow': '0 12px 24px rgba(0, 0, 0, 0.15)'
                });
            });
            
            $(document).on('mouseleave', '.mase-template-card', function() {
                $(this).css({
                    'transform': 'translateY(0)',
                    'box-shadow': ''
                });
            });
            
            // Template card selection
            $(document).on('click', '.mase-template-card', function(e) {
                if ($(e.target).is('button') || $(e.target).closest('button').length) {
                    return;
                }
                
                $('.mase-template-card').removeClass('selected');
                $(this).addClass('selected');
            });
            
            // View all templates link
            $(document).on('click', '#mase-view-all-templates-link', function(e) {
                e.preventDefault();
                MASE.switchTab('mase-templates-tab');
            });
        });
        
        // Test functions
        function runTests() {
            var results = [];
            var $resultsDiv = $('#test-results');
            $resultsDiv.empty();
            
            // Test 1: Template manager module exists
            results.push({
                name: 'Template manager module exists',
                pass: typeof MASE.templateManager !== 'undefined'
            });
            
            // Test 2: Apply method exists
            results.push({
                name: 'Apply method exists',
                pass: typeof MASE.templateManager.apply === 'function'
            });
            
            // Test 3: Save method exists
            results.push({
                name: 'Save method exists',
                pass: typeof MASE.templateManager.save === 'function'
            });
            
            // Test 4: Delete method exists
            results.push({
                name: 'Delete method exists',
                pass: typeof MASE.templateManager.delete === 'function'
            });
            
            // Test 5: UpdateActiveBadge method exists
            results.push({
                name: 'UpdateActiveBadge method exists',
                pass: typeof MASE.templateManager.updateActiveBadge === 'function'
            });
            
            // Test 6: CollectSettings method exists
            results.push({
                name: 'CollectSettings method exists',
                pass: typeof MASE.templateManager.collectSettings === 'function'
            });
            
            // Test 7: Apply button click handler
            var applyBtnExists = $('.mase-template-apply-btn').length > 0;
            results.push({
                name: 'Apply button exists in DOM',
                pass: applyBtnExists
            });
            
            // Test 8: Delete button click handler
            var deleteBtnExists = $('.mase-template-delete-btn').length > 0;
            results.push({
                name: 'Delete button exists in DOM',
                pass: deleteBtnExists
            });
            
            // Test 9: Save custom template button
            var saveBtnExists = $('#mase-save-custom-template-btn').length > 0;
            results.push({
                name: 'Save custom template button exists',
                pass: saveBtnExists
            });
            
            // Test 10: View all templates link
            var viewAllLinkExists = $('#mase-view-all-templates-link').length > 0;
            results.push({
                name: 'View all templates link exists',
                pass: viewAllLinkExists
            });
            
            // Test 11: Active badge functionality
            MASE.templateManager.updateActiveBadge('dark-elegance');
            var activeBadgeWorks = $('.mase-template-card[data-template-id="dark-elegance"]').hasClass('active') &&
                                   $('.mase-template-card[data-template-id="dark-elegance"] .mase-active-badge').length > 0;
            results.push({
                name: 'Active badge updates correctly',
                pass: activeBadgeWorks
            });
            
            // Reset to original state
            MASE.templateManager.updateActiveBadge('modern-minimal');
            
            // Display results
            var passCount = 0;
            results.forEach(function(result) {
                if (result.pass) passCount++;
                
                var $result = $('<div class="test-result ' + (result.pass ? 'pass' : 'fail') + '">')
                    .text((result.pass ? '✓ ' : '✗ ') + result.name);
                $resultsDiv.append($result);
            });
            
            // Summary
            var $summary = $('<div class="test-result ' + (passCount === results.length ? 'pass' : 'fail') + '">')
                .html('<strong>Summary: ' + passCount + ' / ' + results.length + ' tests passed</strong>');
            $resultsDiv.append($summary);
        }
    </script>
</body>
</html>
