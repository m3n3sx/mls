<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palette Keyboard Navigation Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .mase-palette-card {
            display: inline-block;
            width: 200px;
            padding: 16px;
            margin: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mase-palette-card:focus {
            outline: 2px solid #0073aa;
            outline-offset: 2px;
        }
        
        .mase-palette-card.active {
            border: 2px solid #0073aa;
            background: #f0f6fc;
        }
        
        .mase-palette-name {
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .mase-palette-apply-btn {
            width: 100%;
            padding: 8px;
            background: #0073aa;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .mase-palette-apply-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        #test-log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        
        .log-success {
            color: #10b981;
        }
        
        .log-error {
            color: #ef4444;
        }
        
        .log-info {
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <h1>Palette Keyboard Navigation Test</h1>
    
    <div class="test-section">
        <h2>Instructions</h2>
        <ol>
            <li>Click on a palette card or use Tab to focus on it</li>
            <li>Press <strong>Enter</strong> or <strong>Space</strong> to activate the palette</li>
            <li>Confirm the dialog that appears</li>
            <li>Check the test log below for results</li>
        </ol>
        <p><strong>Expected behavior:</strong> Both Enter and Space keys should trigger the palette activation, just like clicking.</p>
    </div>
    
    <div class="test-section">
        <h2>Palette Cards (with keyboard support)</h2>
        <div class="mase-palette-card active" data-palette="professional-blue" tabindex="0" role="button" aria-label="Apply Professional Blue palette">
            <div class="mase-palette-name">Professional Blue</div>
            <button class="mase-palette-apply-btn">Apply Palette</button>
        </div>
        
        <div class="mase-palette-card" data-palette="creative-purple" tabindex="0" role="button" aria-label="Apply Creative Purple palette">
            <div class="mase-palette-name">Creative Purple</div>
            <button class="mase-palette-apply-btn">Apply Palette</button>
        </div>
        
        <div class="mase-palette-card" data-palette="energetic-green" tabindex="0" role="button" aria-label="Apply Energetic Green palette">
            <div class="mase-palette-name">Energetic Green</div>
            <button class="mase-palette-apply-btn">Apply Palette</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Test Log</h2>
        <div id="test-log"></div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock MASE Admin object with keyboard navigation support
        var MASE = {
            state: {
                currentPalette: 'professional-blue',
                livePreviewEnabled: false
            },
            
            log: function(message, type) {
                type = type || 'info';
                var $log = $('#test-log');
                var timestamp = new Date().toLocaleTimeString();
                var $entry = $('<div class="log-entry log-' + type + '">')
                    .text('[' + timestamp + '] ' + message);
                $log.append($entry);
                $log.scrollTop($log[0].scrollHeight);
                console.log('MASE:', message);
            },
            
            handlePaletteClick: function(e) {
                var $card = $(e.currentTarget);
                var paletteId = $card.data('palette');
                var paletteName = $card.find('.mase-palette-name').text().trim();
                
                this.log('handlePaletteClick called for: ' + paletteName, 'info');
                
                if (!paletteId) {
                    this.log('ERROR: Palette ID not found', 'error');
                    return;
                }
                
                if ($card.hasClass('active')) {
                    this.log('Palette already active: ' + paletteId, 'info');
                    return;
                }
                
                var confirmMessage = 'Apply "' + paletteName + '" palette?\n\nThis will update your admin colors immediately.';
                
                if (!confirm(confirmMessage)) {
                    this.log('User cancelled palette application', 'info');
                    return;
                }
                
                this.log('Applying palette: ' + paletteId, 'success');
                
                // Update UI
                $('.mase-palette-card').removeClass('active');
                $card.addClass('active');
                
                var $applyBtn = $card.find('.mase-palette-apply-btn');
                var originalText = $applyBtn.text();
                $applyBtn.prop('disabled', true).text('Applying...');
                
                // Simulate AJAX success
                setTimeout(function() {
                    MASE.log('Palette applied successfully!', 'success');
                    MASE.state.currentPalette = paletteId;
                    $applyBtn.prop('disabled', false).text(originalText);
                }, 500);
            },
            
            handlePaletteKeydown: function(e) {
                this.log('Key pressed: ' + e.key, 'info');
                
                // Check if key is Enter or Space
                if (e.key === 'Enter' || e.key === ' ') {
                    this.log('âœ“ Enter or Space detected - triggering handlePaletteClick', 'success');
                    
                    // Prevent default browser behavior
                    e.preventDefault();
                    
                    // Call handlePaletteClick with event
                    this.handlePaletteClick(e);
                } else {
                    this.log('Key ignored (not Enter or Space)', 'info');
                }
            },
            
            bindEvents: function() {
                var self = this;
                
                // Palette card click handler
                $(document).on('click', '.mase-palette-card', function(e) {
                    self.handlePaletteClick.call(self, e);
                });
                
                // Palette card keyboard navigation
                $(document).on('keydown', '.mase-palette-card', function(e) {
                    self.handlePaletteKeydown.call(self, e);
                });
                
                this.log('Event handlers bound successfully', 'success');
            },
            
            init: function() {
                this.log('MASE Admin initializing...', 'info');
                this.bindEvents();
                this.log('Initialization complete', 'success');
                this.log('Try focusing a palette card and pressing Enter or Space', 'info');
            }
        };
        
        // Initialize on document ready
        $(document).ready(function() {
            MASE.init();
        });
    </script>
</body>
</html>
