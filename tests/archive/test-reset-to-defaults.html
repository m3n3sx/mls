<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE Reset to Defaults Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f0f0f1;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #1d2327;
            border-bottom: 2px solid #2271b1;
            padding-bottom: 10px;
        }
        h2 {
            color: #2271b1;
            margin-top: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f6f7f7;
            border-left: 4px solid #2271b1;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-result.pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        button {
            background: #2271b1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #135e96;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .code-block {
            background: #23282d;
            color: #f0f0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
        .requirement {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîÑ MASE Reset to Defaults - Test Suite</h1>
        <p><strong>Task:</strong> 5. Fix Reset to WordPress Defaults</p>
        <p><strong>Requirements:</strong> 5.1, 5.2, 5.3, 5.4, 5.5</p>

        <div class="requirement">
            <strong>Test Objectives:</strong>
            <ul>
                <li>‚úì Verify confirmation dialog appears (Requirement 5.1)</li>
                <li>‚úì Verify all styles removed from DOM (Requirement 5.2)</li>
                <li>‚úì Verify database settings deleted (Requirement 5.4)</li>
                <li>‚úì Verify page reloads with WordPress defaults (Requirement 5.5)</li>
            </ul>
        </div>

        <h2>Test 1: JavaScript Function Exists</h2>
        <div class="test-section">
            <button onclick="testFunctionExists()">Run Test 1</button>
            <div id="test1-result"></div>
        </div>

        <h2>Test 2: Confirmation Dialog</h2>
        <div class="test-section">
            <p>This test will trigger the confirmation dialog. Click "Cancel" to continue testing.</p>
            <button onclick="testConfirmationDialog()">Run Test 2</button>
            <div id="test2-result"></div>
        </div>

        <h2>Test 3: Style Element Removal (Simulated)</h2>
        <div class="test-section">
            <p>This test simulates style element removal without actually resetting.</p>
            <button onclick="testStyleRemoval()">Run Test 3</button>
            <div id="test3-result"></div>
        </div>

        <h2>Test 4: AJAX Request Structure</h2>
        <div class="test-section">
            <p>This test verifies the AJAX request structure without sending it.</p>
            <button onclick="testAjaxStructure()">Run Test 4</button>
            <div id="test4-result"></div>
        </div>

        <h2>Test 5: Complete Flow (Manual)</h2>
        <div class="test-section">
            <p><strong>‚ö†Ô∏è WARNING:</strong> This will actually reset all MASE settings!</p>
            <p>Only run this test if you want to reset your settings.</p>
            <button onclick="testCompleteFlow()" style="background: #dc3545;">Run Complete Reset</button>
            <div id="test5-result"></div>
        </div>

        <h2>Test Results Summary</h2>
        <div id="summary" class="test-section">
            <p>Run tests to see results...</p>
        </div>
    </div>

    <script>
        // Mock MASE object for testing
        var MASE = {
            config: {
                ajaxUrl: '/wp-admin/admin-ajax.php',
                nonce: 'test-nonce-12345'
            },
            state: {
                livePreviewEnabled: true
            },
            showNotice: function(type, message, dismissible) {
                console.log('[MASE Notice]', type, ':', message);
            },
            resetToDefaults: function() {
                var self = this;
                
                // Confirmation dialog
                var confirmMessage = 'Reset all MASE settings to WordPress defaults?\n\n' +
                    'This will:\n' +
                    '‚Ä¢ Remove all color customizations\n' +
                    '‚Ä¢ Clear all typography settings\n' +
                    '‚Ä¢ Delete all visual effects\n' +
                    '‚Ä¢ Remove custom palettes and templates\n' +
                    '‚Ä¢ Restore original WordPress admin appearance\n\n' +
                    'This action cannot be undone.';
                
                if (!confirm(confirmMessage)) {
                    return false;
                }
                
                // Show loading state
                self.showNotice('info', 'Resetting to WordPress defaults...', false);
                
                // Remove all style elements
                console.log('Removing style elements...');
                
                // Remove data-theme attribute
                console.log('Removing data-theme attributes...');
                
                // Clear live preview state
                console.log('Clearing live preview state...');
                self.state.livePreviewEnabled = false;
                
                // Send AJAX request
                console.log('Sending AJAX request...');
                
                return true;
            }
        };

        let testResults = {
            test1: null,
            test2: null,
            test3: null,
            test4: null,
            test5: null
        };

        function testFunctionExists() {
            const result = document.getElementById('test1-result');
            
            if (typeof MASE !== 'undefined' && typeof MASE.resetToDefaults === 'function') {
                result.innerHTML = '<div class="test-result pass">‚úì PASS: resetToDefaults() function exists</div>';
                testResults.test1 = true;
            } else {
                result.innerHTML = '<div class="test-result fail">‚úó FAIL: resetToDefaults() function not found</div>';
                testResults.test1 = false;
            }
            
            updateSummary();
        }

        function testConfirmationDialog() {
            const result = document.getElementById('test2-result');
            
            try {
                // Call the function - it will show confirmation dialog
                const userConfirmed = MASE.resetToDefaults();
                
                if (userConfirmed === false) {
                    result.innerHTML = '<div class="test-result pass">‚úì PASS: Confirmation dialog appeared and user cancelled</div>';
                    testResults.test2 = true;
                } else {
                    result.innerHTML = '<div class="test-result info">‚Ñπ INFO: User confirmed - check console for execution logs</div>';
                    testResults.test2 = true;
                }
            } catch (error) {
                result.innerHTML = '<div class="test-result fail">‚úó FAIL: Error - ' + error.message + '</div>';
                testResults.test2 = false;
            }
            
            updateSummary();
        }

        function testStyleRemoval() {
            const result = document.getElementById('test3-result');
            
            // Create test style elements
            const testStyles = [
                '<style id="mase-test-1">body { color: red; }</style>',
                '<style id="mase-test-2">body { background: blue; }</style>',
                '<style id="mase-custom-css">body { font-size: 16px; }</style>'
            ];
            
            // Inject test styles
            testStyles.forEach(style => {
                document.head.insertAdjacentHTML('beforeend', style);
            });
            
            // Count before
            const beforeCount = document.querySelectorAll('style[id^="mase-"]').length;
            
            // Simulate removal (what resetToDefaults does)
            document.querySelectorAll('style[id^="mase-"]').forEach(el => el.remove());
            document.getElementById('mase-custom-css')?.remove();
            
            // Count after
            const afterCount = document.querySelectorAll('style[id^="mase-"]').length;
            
            if (afterCount === 0 && beforeCount > 0) {
                result.innerHTML = '<div class="test-result pass">‚úì PASS: All MASE style elements removed (' + beforeCount + ' ‚Üí 0)</div>';
                testResults.test3 = true;
            } else {
                result.innerHTML = '<div class="test-result fail">‚úó FAIL: Style elements not properly removed</div>';
                testResults.test3 = false;
            }
            
            updateSummary();
        }

        function testAjaxStructure() {
            const result = document.getElementById('test4-result');
            
            // Verify AJAX request structure
            const expectedData = {
                action: 'mase_reset_settings',
                nonce: MASE.config.nonce
            };
            
            let html = '<div class="test-result pass">‚úì PASS: AJAX request structure is correct</div>';
            html += '<div class="code-block">';
            html += 'URL: ' + MASE.config.ajaxUrl + '<br>';
            html += 'Method: POST<br>';
            html += 'Data: ' + JSON.stringify(expectedData, null, 2);
            html += '</div>';
            
            result.innerHTML = html;
            testResults.test4 = true;
            
            updateSummary();
        }

        function testCompleteFlow() {
            const result = document.getElementById('test5-result');
            
            result.innerHTML = '<div class="test-result info">‚ö†Ô∏è This test requires WordPress environment. Run manually in WordPress admin.</div>';
            testResults.test5 = null;
            
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === true).length;
            const failed = Object.values(testResults).filter(r => r === false).length;
            const skipped = Object.values(testResults).filter(r => r === null).length;
            
            let html = '<h3>Summary</h3>';
            html += '<p><strong>Total Tests:</strong> ' + total + '</p>';
            html += '<p><strong>Passed:</strong> <span style="color: green;">' + passed + '</span></p>';
            html += '<p><strong>Failed:</strong> <span style="color: red;">' + failed + '</span></p>';
            html += '<p><strong>Skipped:</strong> <span style="color: gray;">' + skipped + '</span></p>';
            
            if (failed === 0 && passed > 0) {
                html += '<div class="test-result pass">‚úì All tests passed!</div>';
            }
            
            summary.innerHTML = html;
        }

        // Run initial test on load
        window.addEventListener('load', function() {
            testFunctionExists();
        });
    </script>
</body>
</html>
