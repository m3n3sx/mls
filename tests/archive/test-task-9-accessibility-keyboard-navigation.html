<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 9: Accessibility & Keyboard Navigation Test</title>
    <link rel="stylesheet" href="../assets/css/mase-templates.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        .test-section {
            margin-bottom: 40px;
        }
        .test-section h3 {
            color: #1e293b;
            margin-bottom: 15px;
        }
        .test-instructions {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .test-instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .test-instructions li {
            margin: 5px 0;
        }
        .test-results {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        .test-result-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .test-result-item.pass {
            background: #d1fae5;
            color: #065f46;
        }
        .test-result-item.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .test-result-item.info {
            background: #dbeafe;
            color: #1e40af;
        }
        .keyboard-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1e293b;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            font-family: monospace;
            z-index: 10000;
        }
        .focus-visible-indicator {
            outline: 3px solid #4A90E2 !important;
            outline-offset: 2px !important;
        }
        .button {
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
        }
        .button-primary {
            background: #4A90E2;
            color: white;
            border-color: #4A90E2;
        }
        .button-secondary {
            background: #fff;
            color: #1e293b;
        }
        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button:focus-visible {
            outline: 2px solid #4A90E2;
            outline-offset: 2px;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>

    <!-- Keyboard Indicator -->
    <div class="keyboard-indicator" id="keyboardIndicator">
        <div>Last Key: <span id="lastKey">None</span></div>
        <div>Focus: <span id="focusElement">None</span></div>
    </div>

    <div class="test-container">
        <div class="test-header">
            <h1>Task 9: Accessibility & Keyboard Navigation Test</h1>
            <p>This test validates keyboard navigation and screen reader support for template cards.</p>
            <p><strong>Requirements:</strong> 3.3, 3.4</p>
        </div>

        <!-- Test Section 1: Keyboard Navigation -->
        <div class="test-section">
            <h2>Test 9.1: Keyboard Navigation</h2>
            
            <div class="test-instructions">
                <h3>Instructions:</h3>
                <ol>
                    <li>Press <kbd>Tab</kbd> to navigate between template cards</li>
                    <li>Verify focus moves to each card sequentially</li>
                    <li>Verify focus indicators are visible (blue outline)</li>
                    <li>Press <kbd>Enter</kbd> or <kbd>Space</kbd> on a focused card</li>
                    <li>Verify the Apply button activates</li>
                    <li>Use <kbd>Shift+Tab</kbd> to navigate backwards</li>
                </ol>
                <p><strong>Expected:</strong> All cards are keyboard accessible with visible focus indicators</p>
            </div>

            <div id="test-results-keyboard" class="test-results">
                <h4>Test Results:</h4>
                <div id="keyboard-results"></div>
            </div>
        </div>

        <!-- Test Section 2: Screen Reader Support -->
        <div class="test-section">
            <h2>Test 9.2: Screen Reader Support</h2>
            
            <div class="test-instructions">
                <h3>Instructions:</h3>
                <ol>
                    <li>Enable a screen reader (NVDA, JAWS, or VoiceOver)</li>
                    <li>Navigate to the template gallery below</li>
                    <li>Verify template names are announced</li>
                    <li>Verify role="article" is recognized</li>
                    <li>Verify aria-label provides context</li>
                    <li>Check that button labels are descriptive</li>
                </ol>
                <p><strong>Expected:</strong> Screen readers announce all content with proper context</p>
            </div>

            <div id="test-results-screenreader" class="test-results">
                <h4>ARIA Attributes Detected:</h4>
                <div id="aria-results"></div>
            </div>
        </div>

        <!-- Template Gallery Test Area -->
        <div class="test-section">
            <h2>Template Gallery (Test Area)</h2>
            <p>Use the template cards below to test keyboard navigation and screen reader support.</p>
            
            <div class="mase-template-gallery">
                <!-- Template Card 1: Modern Professional -->
                <div class="mase-template-card" 
                     data-template="modern-professional" 
                     data-template-id="modern-professional" 
                     role="article" 
                     aria-label="Modern Professional"
                     tabindex="0">
                    <div class="mase-template-thumbnail">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjNEE5MEUyIiB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXdlaWdodD0iYm9sZCI+TW9kZXJuIFByb2Zlc3Npb25hbDwvdGV4dD48L3N2Zz4=" 
                             alt="Modern Professional template preview" />
                    </div>
                    <div class="mase-template-details">
                        <h3>Modern Professional</h3>
                        <p class="description">Clean and professional design with blue accents</p>
                    </div>
                    <div class="mase-template-actions">
                        <button type="button" 
                                class="button button-secondary mase-template-preview-btn" 
                                data-template-id="modern-professional"
                                aria-label="Preview Modern Professional template">
                            Preview
                        </button>
                        <button type="button" 
                                class="button button-primary mase-template-apply-btn" 
                                data-template-id="modern-professional"
                                aria-label="Apply Modern Professional template">
                            Apply
                        </button>
                    </div>
                </div>

                <!-- Template Card 2: Dark Elegance -->
                <div class="mase-template-card" 
                     data-template="dark-elegance" 
                     data-template-id="dark-elegance" 
                     role="article" 
                     aria-label="Dark Elegance"
                     tabindex="0">
                    <div class="mase-template-thumbnail">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjMkQzNzQ4IiB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXdlaWdodD0iYm9sZCI+RGFyayBFbGVnYW5jZTwvdGV4dD48L3N2Zz4=" 
                             alt="Dark Elegance template preview" />
                    </div>
                    <div class="mase-template-details">
                        <h3>Dark Elegance</h3>
                        <p class="description">Sophisticated dark theme with elegant styling</p>
                    </div>
                    <div class="mase-template-actions">
                        <button type="button" 
                                class="button button-secondary mase-template-preview-btn" 
                                data-template-id="dark-elegance"
                                aria-label="Preview Dark Elegance template">
                            Preview
                        </button>
                        <button type="button" 
                                class="button button-primary mase-template-apply-btn" 
                                data-template-id="dark-elegance"
                                aria-label="Apply Dark Elegance template">
                            Apply
                        </button>
                    </div>
                </div>

                <!-- Template Card 3: Vibrant Creative -->
                <div class="mase-template-card active" 
                     data-template="vibrant-creative" 
                     data-template-id="vibrant-creative" 
                     role="article" 
                     aria-label="Vibrant Creative"
                     tabindex="0">
                    <div class="mase-template-thumbnail">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48cmVjdCBmaWxsPSIjRUY0NDQ0IiB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXdlaWdodD0iYm9sZCI+VmlicmFudCBDcmVhdGl2ZTwvdGV4dD48L3N2Zz4=" 
                             alt="Vibrant Creative template preview" />
                        <span class="mase-active-badge" role="status" aria-label="Currently active template">Active</span>
                    </div>
                    <div class="mase-template-details">
                        <h3>Vibrant Creative</h3>
                        <p class="description">Bold and colorful design for creative projects</p>
                    </div>
                    <div class="mase-template-actions">
                        <button type="button" 
                                class="button button-secondary mase-template-preview-btn" 
                                data-template-id="vibrant-creative"
                                aria-label="Preview Vibrant Creative template">
                            Preview
                        </button>
                        <button type="button" 
                                class="button button-primary mase-template-apply-btn" 
                                data-template-id="vibrant-creative"
                                aria-label="Apply Vibrant Creative template"
                                aria-describedby="vibrant-creative-active">
                            Apply
                        </button>
                    </div>
                    <span id="vibrant-creative-active" class="sr-only">This template is currently active</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test tracking
        const testResults = {
            keyboard: [],
            aria: []
        };

        // Keyboard indicator
        document.addEventListener('keydown', function(e) {
            document.getElementById('lastKey').textContent = e.key;
            const focusedElement = document.activeElement;
            const elementDesc = focusedElement.getAttribute('aria-label') || 
                               focusedElement.className || 
                               focusedElement.tagName;
            document.getElementById('focusElement').textContent = elementDesc;
        });

        // Track focus events
        document.addEventListener('focusin', function(e) {
            const element = e.target;
            if (element.classList.contains('mase-template-card')) {
                const templateName = element.getAttribute('aria-label');
                logKeyboardResult(`✓ Focus moved to: ${templateName}`, 'pass');
                
                // Check for visible focus indicator
                const hasOutline = window.getComputedStyle(element).outline !== 'none';
                if (hasOutline) {
                    logKeyboardResult(`✓ Focus indicator visible on ${templateName}`, 'pass');
                } else {
                    logKeyboardResult(`✗ Focus indicator NOT visible on ${templateName}`, 'fail');
                }
            }
        });

        // Handle Enter/Space on template cards
        document.querySelectorAll('.mase-template-card').forEach(card => {
            card.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const templateName = this.getAttribute('aria-label');
                    const applyBtn = this.querySelector('.mase-template-apply-btn');
                    
                    if (applyBtn) {
                        logKeyboardResult(`✓ ${e.key} key activated Apply button for ${templateName}`, 'pass');
                        applyBtn.click();
                    } else {
                        logKeyboardResult(`✗ Apply button not found for ${templateName}`, 'fail');
                    }
                }
            });
        });

        // Handle Apply button clicks
        document.querySelectorAll('.mase-template-apply-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const templateId = this.getAttribute('data-template-id');
                const templateName = this.getAttribute('aria-label');
                
                // Show confirmation
                const confirmed = confirm(`Apply "${templateId}" template?\n\nThis will overwrite your current settings including:\n• Color scheme\n• Typography\n• Visual effects\n\nThis action cannot be undone.`);
                
                if (confirmed) {
                    logKeyboardResult(`✓ Apply button clicked for ${templateId}`, 'info');
                    alert(`Template "${templateId}" would be applied (test mode)`);
                } else {
                    logKeyboardResult(`ℹ User cancelled template application`, 'info');
                }
            });
        });

        // Log keyboard test results
        function logKeyboardResult(message, type) {
            testResults.keyboard.push({ message, type });
            const resultsDiv = document.getElementById('keyboard-results');
            const resultItem = document.createElement('div');
            resultItem.className = `test-result-item ${type}`;
            resultItem.textContent = message;
            resultsDiv.appendChild(resultItem);
        }

        // Check ARIA attributes on page load
        window.addEventListener('DOMContentLoaded', function() {
            checkARIAAttributes();
        });

        function checkARIAAttributes() {
            const resultsDiv = document.getElementById('aria-results');
            const cards = document.querySelectorAll('.mase-template-card');
            
            logARIAResult(`Found ${cards.length} template cards`, 'info');
            
            cards.forEach((card, index) => {
                const templateName = card.getAttribute('aria-label');
                const role = card.getAttribute('role');
                const dataTemplate = card.getAttribute('data-template');
                const tabindex = card.getAttribute('tabindex');
                
                // Check role="article"
                if (role === 'article') {
                    logARIAResult(`✓ Card ${index + 1}: role="article" present`, 'pass');
                } else {
                    logARIAResult(`✗ Card ${index + 1}: role="article" missing (found: ${role})`, 'fail');
                }
                
                // Check aria-label
                if (templateName) {
                    logARIAResult(`✓ Card ${index + 1}: aria-label="${templateName}"`, 'pass');
                } else {
                    logARIAResult(`✗ Card ${index + 1}: aria-label missing`, 'fail');
                }
                
                // Check data-template
                if (dataTemplate) {
                    logARIAResult(`✓ Card ${index + 1}: data-template="${dataTemplate}"`, 'pass');
                } else {
                    logARIAResult(`✗ Card ${index + 1}: data-template missing`, 'fail');
                }
                
                // Check tabindex
                if (tabindex === '0') {
                    logARIAResult(`✓ Card ${index + 1}: tabindex="0" (keyboard accessible)`, 'pass');
                } else {
                    logARIAResult(`✗ Card ${index + 1}: tabindex not set correctly (found: ${tabindex})`, 'fail');
                }

                // Check buttons
                const buttons = card.querySelectorAll('button');
                buttons.forEach((btn, btnIndex) => {
                    const btnLabel = btn.getAttribute('aria-label');
                    const btnText = btn.textContent.trim();
                    
                    if (btnLabel) {
                        logARIAResult(`✓ Card ${index + 1}, Button ${btnIndex + 1}: aria-label="${btnLabel}"`, 'pass');
                    } else {
                        logARIAResult(`⚠ Card ${index + 1}, Button ${btnIndex + 1}: No aria-label (text: "${btnText}")`, 'info');
                    }
                });
                
                // Check for active badge
                const activeBadge = card.querySelector('.mase-active-badge');
                if (activeBadge) {
                    const badgeRole = activeBadge.getAttribute('role');
                    if (badgeRole === 'status') {
                        logARIAResult(`✓ Card ${index + 1}: Active badge has role="status"`, 'pass');
                    } else {
                        logARIAResult(`✗ Card ${index + 1}: Active badge missing role="status"`, 'fail');
                    }
                }
            });
            
            // Summary
            const passCount = testResults.aria.filter(r => r.type === 'pass').length;
            const failCount = testResults.aria.filter(r => r.type === 'fail').length;
            logARIAResult(`\n=== Summary: ${passCount} passed, ${failCount} failed ===`, 'info');
        }

        function logARIAResult(message, type) {
            testResults.aria.push({ message, type });
            const resultsDiv = document.getElementById('aria-results');
            const resultItem = document.createElement('div');
            resultItem.className = `test-result-item ${type}`;
            resultItem.textContent = message;
            resultsDiv.appendChild(resultItem);
        }
    </script>
</body>
</html>
