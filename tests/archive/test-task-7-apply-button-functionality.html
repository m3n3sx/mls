<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 7: Apply Button Functionality Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: #f0f0f1;
        }
        
        h1 {
            color: #1d2327;
            border-bottom: 2px solid #2271b1;
            padding-bottom: 10px;
        }
        
        .test-section {
            background: white;
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #c3c4c7;
            border-radius: 4px;
            box-shadow: 0 1px 1px rgba(0,0,0,.04);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #1d2327;
            font-size: 20px;
            border-bottom: 1px solid #dcdcde;
            padding-bottom: 10px;
        }
        
        .test-section h3 {
            color: #2271b1;
            font-size: 16px;
            margin-top: 20px;
        }
        
        .test-instructions {
            background: #f0f6fc;
            border-left: 4px solid #2271b1;
            padding: 15px;
            margin: 15px 0;
        }
        
        .test-instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .test-instructions li {
            margin: 5px 0;
        }
        
        .mase-template-card {
            border: 1px solid #c3c4c7;
            border-radius: 4px;
            padding: 20px;
            margin: 15px 0;
            transition: opacity 0.3s, box-shadow 0.3s;
            background: white;
        }
        
        .mase-template-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,.1);
        }
        
        .mase-template-card h3 {
            margin-top: 0;
            color: #1d2327;
        }
        
        .mase-template-card p {
            color: #50575e;
            margin: 10px 0;
        }
        
        .mase-template-apply-btn {
            background: #2271b1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .mase-template-apply-btn:hover:not(:disabled) {
            background: #135e96;
        }
        
        .mase-template-apply-btn:disabled {
            background: #c3c4c7;
            cursor: not-allowed;
        }
        
        .mase-notice {
            padding: 12px 16px;
            margin: 15px 0;
            border-radius: 4px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .mase-notice-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .mase-notice-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .mase-notice-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        
        #console-log {
            background: #1d2327;
            color: #f0f0f1;
            border: 1px solid #c3c4c7;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            border-radius: 4px;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 3px 5px;
            border-radius: 2px;
        }
        
        .log-info {
            color: #72aee6;
        }
        
        .log-error {
            color: #f86368;
            background: rgba(248, 99, 104, 0.1);
        }
        
        .log-success {
            color: #68de7c;
        }
        
        .log-warning {
            color: #f0b849;
        }
        
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: #f6f7f7;
            border-radius: 4px;
        }
        
        .test-controls button {
            background: #50575e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 13px;
        }
        
        .test-controls button:hover {
            background: #3c434a;
        }
        
        .checklist {
            background: #f6f7f7;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .checklist-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
            display: flex;
            align-items: center;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-pass {
            background: #d4edda;
            color: #155724;
        }
        
        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .network-simulator {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .network-simulator h4 {
            margin-top: 0;
            color: #856404;
        }
        
        .network-simulator label {
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Task 7: Apply Button Functionality Test</h1>
    <p><strong>Requirements:</strong> 2.1, 2.2, 2.3, 2.4, 2.5, 6.1, 6.2, 6.3</p>
    
    <!-- Subtask 7.1: Test confirmation dialog -->
    <div class="test-section">
        <h2>Subtask 7.1: Test Confirmation Dialog</h2>
        <p><strong>Requirements:</strong> 6.1, 6.2, 6.3</p>
        
        <div class="test-instructions">
            <strong>Test Steps:</strong>
            <ul>
                <li>Click the Apply button below</li>
                <li>Verify dialog shows template name</li>
                <li>Verify dialog lists affected settings (colors, typography, visual effects)</li>
                <li>Verify warning about irreversibility</li>
                <li>Click Cancel and verify operation aborts</li>
            </ul>
        </div>
        
        <h3>Test Case 1: Confirmation Dialog Content</h3>
        <div class="mase-template-card" data-template="professional-blue" data-template-id="professional-blue">
            <h3>Professional Blue</h3>
            <p>A clean, professional design with blue accents perfect for corporate websites.</p>
            <button type="button" class="mase-template-apply-btn" data-template-id="professional-blue">Apply</button>
        </div>
        
        <div class="checklist">
            <strong>Verification Checklist:</strong>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-1">
                <label for="check-7-1-1">Dialog displays template name "Professional Blue"</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-2">
                <label for="check-7-1-2">Dialog lists "Color scheme" as affected setting</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-3">
                <label for="check-7-1-3">Dialog lists "Typography" as affected setting</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-4">
                <label for="check-7-1-4">Dialog lists "Visual effects" as affected setting</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-5">
                <label for="check-7-1-5">Dialog shows warning "This action cannot be undone"</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-1-6">
                <label for="check-7-1-6">Clicking Cancel aborts operation (no AJAX request sent)</label>
            </div>
        </div>
    </div>
    
    <!-- Subtask 7.2: Test successful application -->
    <div class="test-section">
        <h2>Subtask 7.2: Test Successful Application</h2>
        <p><strong>Requirements:</strong> 2.3, 2.5, 8.1, 8.2</p>
        
        <div class="test-instructions">
            <strong>Test Steps:</strong>
            <ul>
                <li>Click Apply and confirm</li>
                <li>Verify button disables and shows "Applying..."</li>
                <li>Verify card opacity reduces to 0.6</li>
                <li>Verify success notification appears</li>
                <li>Verify page reload message (reload disabled for testing)</li>
            </ul>
        </div>
        
        <h3>Test Case 2: Successful Template Application</h3>
        <div class="mase-template-card" data-template="modern-dark" data-template-id="modern-dark">
            <h3>Modern Dark</h3>
            <p>A sleek dark theme with modern aesthetics for contemporary interfaces.</p>
            <button type="button" class="mase-template-apply-btn" data-template-id="modern-dark">Apply</button>
        </div>
        
        <div class="checklist">
            <strong>Verification Checklist:</strong>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-1">
                <label for="check-7-2-1">Button becomes disabled immediately after confirmation</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-2">
                <label for="check-7-2-2">Button text changes to "Applying..."</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-3">
                <label for="check-7-2-3">Card opacity reduces to 0.6</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-4">
                <label for="check-7-2-4">Success notification appears with template name</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-5">
                <label for="check-7-2-5">Console log shows "Page would reload in 1 second"</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-2-6">
                <label for="check-7-2-6">AJAX request sent with correct template_id</label>
            </div>
        </div>
    </div>
    
    <!-- Subtask 7.3: Test error handling -->
    <div class="test-section">
        <h2>Subtask 7.3: Test Error Handling</h2>
        <p><strong>Requirements:</strong> 2.5, 8.3, 10.5</p>
        
        <div class="test-instructions">
            <strong>Test Steps:</strong>
            <ul>
                <li>Enable "Simulate Network Error" below</li>
                <li>Click Apply and confirm</li>
                <li>Verify error notification appears</li>
                <li>Verify button returns to normal state</li>
                <li>Verify card opacity returns to 1</li>
            </ul>
        </div>
        
        <div class="network-simulator">
            <h4>Network Error Simulator</h4>
            <label>
                <input type="checkbox" id="simulate-error"> Simulate Network Error (Force AJAX failure)
            </label>
            <label>
                <input type="radio" name="error-type" value="403"> 403 Forbidden (Insufficient permissions)
            </label>
            <label>
                <input type="radio" name="error-type" value="404"> 404 Not Found (Template not found)
            </label>
            <label>
                <input type="radio" name="error-type" value="500" checked> 500 Server Error
            </label>
            <label>
                <input type="radio" name="error-type" value="network"> Network Error (Connection failed)
            </label>
        </div>
        
        <h3>Test Case 3: Error Handling</h3>
        <div class="mase-template-card" data-template="minimal-light" data-template-id="minimal-light">
            <h3>Minimal Light</h3>
            <p>A clean, minimal light theme with subtle elegance.</p>
            <button type="button" class="mase-template-apply-btn" data-template-id="minimal-light">Apply</button>
        </div>
        
        <div class="checklist">
            <strong>Verification Checklist:</strong>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-1">
                <label for="check-7-3-1">Error notification appears with appropriate message</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-2">
                <label for="check-7-3-2">Button is re-enabled after error</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-3">
                <label for="check-7-3-3">Button text returns to "Apply"</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-4">
                <label for="check-7-3-4">Card opacity returns to 1</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-5">
                <label for="check-7-3-5">Error details logged to console</label>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check-7-3-6">
                <label for="check-7-3-6">User can retry after error (button functional)</label>
            </div>
        </div>
    </div>
    
    <!-- Additional test cases -->
    <div class="test-section">
        <h2>Additional Test Cases</h2>
        
        <h3>Test Case 4: Multiple Templates</h3>
        <p>Verify event delegation works correctly with multiple template cards.</p>
        
        <div class="mase-template-card" data-template="elegant-purple" data-template-id="elegant-purple">
            <h3>Elegant Purple</h3>
            <p>Sophisticated purple theme with elegant styling.</p>
            <button type="button" class="mase-template-apply-btn" data-template-id="elegant-purple">Apply</button>
        </div>
        
        <div class="mase-template-card" data-template="vibrant-orange" data-template-id="vibrant-orange">
            <h3>Vibrant Orange</h3>
            <p>Energetic orange theme for dynamic interfaces.</p>
            <button type="button" class="mase-template-apply-btn" data-template-id="vibrant-orange">Apply</button>
        </div>
        
        <h3>Test Case 5: Missing Template ID</h3>
        <p>This card has no data-template attribute. Should log error and abort.</p>
        
        <div class="mase-template-card">
            <h3>Invalid Template</h3>
            <p>This template card is missing the data-template attribute.</p>
            <button type="button" class="mase-template-apply-btn">Apply</button>
        </div>
    </div>
    
    <!-- Console log -->
    <div class="test-section">
        <h2>Console Log Output</h2>
        <div class="test-controls">
            <button onclick="clearConsoleLog()">Clear Log</button>
            <button onclick="exportTestResults()">Export Test Results</button>
        </div>
        <div id="console-log"></div>
    </div>
    
    <input type="hidden" id="mase_nonce" value="test-nonce-12345" />
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock MASE object with complete implementation
        var MASE = {
            config: {
                ajaxUrl: '/wp-admin/admin-ajax.php',
                nonce: 'test-nonce-12345'
            },
            
            state: {
                currentTemplate: null,
                isDirty: false
            },
            
            templateManager: {
                /**
                 * Handle Template Apply Button Click
                 * Implements all requirements for Task 7
                 */
                handleTemplateApply: function(e) {
                    var self = MASE;
                    
                    // Subtask 3.1: Prevent default event and stop propagation
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Get button element and parent card
                    var $button = $(e.currentTarget);
                    var $card = $button.closest('.mase-template-card');
                    
                    // Read data-template attribute from card
                    var templateId = $card.attr('data-template');
                    
                    // Validate template ID exists (Requirement 8.1, 8.4)
                    if (!templateId) {
                        logToConsole('ERROR: Template ID not found on card', 'error');
                        self.showNotice('error', 'Template ID is missing. Cannot apply template.');
                        return;
                    }
                    
                    // Get template name from card for confirmation
                    var templateName = $card.find('h3').text();
                    
                    // Log template apply action to console (Requirement 8.1)
                    logToConsole('Apply button clicked for template: ' + templateId, 'info');
                    
                    // Subtask 3.2: Implement confirmation dialog (Requirements 6.1, 6.2, 6.3)
                    var confirmMessage = 'Apply "' + templateName + '" template?\n\n' +
                        'This will overwrite your current settings including:\n' +
                        '• Color scheme\n' +
                        '• Typography\n' +
                        '• Visual effects\n\n' +
                        'This action cannot be undone.';
                    
                    if (!confirm(confirmMessage)) {
                        logToConsole('User cancelled template application', 'info');
                        return;
                    }
                    
                    // Subtask 3.3: Implement loading state (Requirements 2.5, 8.1, 8.2)
                    $button.prop('disabled', true).text('Applying...');
                    $card.css('opacity', '0.6');
                    
                    var originalText = 'Apply';
                    
                    // Subtask 3.4: Implement AJAX request (Requirements 2.2, 2.4, 8.3)
                    var requestData = {
                        action: 'mase_apply_template',
                        nonce: $('#mase_nonce').val(),
                        template_id: templateId
                    };
                    
                    logToConsole('Sending AJAX request: ' + JSON.stringify(requestData), 'info');
                    
                    // Check if error simulation is enabled
                    var simulateError = $('#simulate-error').is(':checked');
                    var errorType = $('input[name="error-type"]:checked').val();
                    
                    if (simulateError) {
                        logToConsole('Network error simulation enabled: ' + errorType, 'warning');
                        
                        // Simulate error after delay
                        setTimeout(function() {
                            var xhr = {
                                status: errorType === 'network' ? 0 : parseInt(errorType),
                                statusText: errorType === 'network' ? 'Network Error' : 'Error',
                                responseJSON: {
                                    success: false,
                                    data: {
                                        message: getErrorMessage(errorType)
                                    }
                                }
                            };
                            
                            handleAjaxError(xhr, $button, $card, originalText, templateName);
                        }, 1500);
                        
                        return;
                    }
                    
                    // Real AJAX call (mocked for testing)
                    $.ajax({
                        url: self.config.ajaxUrl,
                        type: 'POST',
                        data: requestData,
                        success: function(response) {
                            // Subtask 3.5: Implement success handler (Requirements 2.3, 8.2)
                            logToConsole('AJAX response - Success: ' + JSON.stringify(response), 'success');
                            
                            if (response.success) {
                                // Show success notification with template name
                                self.showNotice('success', 'Template "' + templateName + '" applied successfully!');
                                
                                // Log reload message
                                logToConsole('Page would reload in 1 second (disabled for testing)', 'info');
                                
                                // In real implementation, page would reload:
                                // setTimeout(function() { location.reload(); }, 1000);
                                
                                // For testing, restore button after 3 seconds
                                setTimeout(function() {
                                    $button.prop('disabled', false).text(originalText);
                                    $card.css('opacity', '1');
                                    logToConsole('Button restored (testing mode)', 'info');
                                }, 3000);
                            } else {
                                // Handle server-side error
                                var errorMessage = response.data.message || 'Failed to apply template';
                                logToConsole('Server error: ' + errorMessage, 'error');
                                
                                self.showNotice('error', errorMessage);
                                
                                // Restore button state
                                $button.prop('disabled', false).text(originalText);
                                $card.css('opacity', '1');
                            }
                        },
                        error: function(xhr, status, error) {
                            handleAjaxError(xhr, $button, $card, originalText, templateName);
                        }
                    });
                    
                    function handleAjaxError(xhr, $button, $card, originalText, templateName) {
                        // Subtask 3.6: Implement error handler (Requirements 2.5, 8.3, 10.5)
                        logToConsole('AJAX error - Status: ' + xhr.status + ', StatusText: ' + xhr.statusText, 'error');
                        
                        // Parse error message from response
                        var errorMessage = 'Failed to apply template.';
                        
                        if (xhr.status === 403) {
                            errorMessage = 'Insufficient permissions';
                        } else if (xhr.status === 404) {
                            errorMessage = 'Template not found';
                        } else if (xhr.status === 500) {
                            errorMessage = 'Server error. Please try again later.';
                        } else if (xhr.status === 0) {
                            errorMessage = 'Network error. Please check your connection.';
                        } else if (xhr.responseJSON && xhr.responseJSON.data && xhr.responseJSON.data.message) {
                            errorMessage = xhr.responseJSON.data.message;
                        }
                        
                        // Show error notification with message
                        self.showNotice('error', errorMessage);
                        
                        // Restore button state (enable, original text)
                        $button.prop('disabled', false).text(originalText);
                        
                        // Restore card opacity to 1
                        $card.css('opacity', '1');
                        
                        logToConsole('Button and card state restored after error', 'info');
                    }
                    
                    function getErrorMessage(errorType) {
                        switch(errorType) {
                            case '403': return 'Insufficient permissions';
                            case '404': return 'Template not found';
                            case '500': return 'Server error occurred';
                            case 'network': return 'Network connection failed';
                            default: return 'Unknown error';
                        }
                    }
                }
            },
            
            showNotice: function(type, message) {
                logToConsole('Showing notice (' + type + '): ' + message, type === 'error' ? 'error' : 'success');
                
                var $notice = $('<div>')
                    .addClass('mase-notice')
                    .addClass('mase-notice-' + type)
                    .text(message);
                
                $('.mase-notice').remove();
                $('body').prepend($notice);
                
                if (type === 'success') {
                    setTimeout(function() {
                        $notice.fadeOut(300, function() {
                            $(this).remove();
                        });
                    }, 4000);
                }
            }
        };
        
        // Console logging function
        function logToConsole(message, type) {
            type = type || 'info';
            var $log = $('#console-log');
            var timestamp = new Date().toLocaleTimeString();
            var $entry = $('<div class="log-entry log-' + type + '">')
                .text('[' + timestamp + '] ' + message);
            $log.append($entry);
            $log.scrollTop($log[0].scrollHeight);
            
            // Also log to browser console
            if (type === 'error') {
                console.error('MASE:', message);
            } else if (type === 'warning') {
                console.warn('MASE:', message);
            } else {
                console.log('MASE:', message);
            }
        }
        
        function clearConsoleLog() {
            $('#console-log').empty();
            logToConsole('Console log cleared', 'info');
        }
        
        function exportTestResults() {
            var results = {
                timestamp: new Date().toISOString(),
                testSuite: 'Task 7: Apply Button Functionality',
                subtasks: {
                    '7.1': {
                        name: 'Test confirmation dialog',
                        checks: [
                            { id: 'check-7-1-1', label: 'Dialog displays template name', checked: $('#check-7-1-1').is(':checked') },
                            { id: 'check-7-1-2', label: 'Dialog lists Color scheme', checked: $('#check-7-1-2').is(':checked') },
                            { id: 'check-7-1-3', label: 'Dialog lists Typography', checked: $('#check-7-1-3').is(':checked') },
                            { id: 'check-7-1-4', label: 'Dialog lists Visual effects', checked: $('#check-7-1-4').is(':checked') },
                            { id: 'check-7-1-5', label: 'Dialog shows warning', checked: $('#check-7-1-5').is(':checked') },
                            { id: 'check-7-1-6', label: 'Cancel aborts operation', checked: $('#check-7-1-6').is(':checked') }
                        ]
                    },
                    '7.2': {
                        name: 'Test successful application',
                        checks: [
                            { id: 'check-7-2-1', label: 'Button becomes disabled', checked: $('#check-7-2-1').is(':checked') },
                            { id: 'check-7-2-2', label: 'Button text changes to Applying...', checked: $('#check-7-2-2').is(':checked') },
                            { id: 'check-7-2-3', label: 'Card opacity reduces', checked: $('#check-7-2-3').is(':checked') },
                            { id: 'check-7-2-4', label: 'Success notification appears', checked: $('#check-7-2-4').is(':checked') },
                            { id: 'check-7-2-5', label: 'Console shows reload message', checked: $('#check-7-2-5').is(':checked') },
                            { id: 'check-7-2-6', label: 'AJAX request sent correctly', checked: $('#check-7-2-6').is(':checked') }
                        ]
                    },
                    '7.3': {
                        name: 'Test error handling',
                        checks: [
                            { id: 'check-7-3-1', label: 'Error notification appears', checked: $('#check-7-3-1').is(':checked') },
                            { id: 'check-7-3-2', label: 'Button re-enabled', checked: $('#check-7-3-2').is(':checked') },
                            { id: 'check-7-3-3', label: 'Button text returns to Apply', checked: $('#check-7-3-3').is(':checked') },
                            { id: 'check-7-3-4', label: 'Card opacity returns to 1', checked: $('#check-7-3-4').is(':checked') },
                            { id: 'check-7-3-5', label: 'Error logged to console', checked: $('#check-7-3-5').is(':checked') },
                            { id: 'check-7-3-6', label: 'User can retry', checked: $('#check-7-3-6').is(':checked') }
                        ]
                    }
                },
                consoleLog: $('#console-log').text()
            };
            
            // Calculate pass rate
            var totalChecks = 0;
            var passedChecks = 0;
            
            Object.keys(results.subtasks).forEach(function(key) {
                results.subtasks[key].checks.forEach(function(check) {
                    totalChecks++;
                    if (check.checked) passedChecks++;
                });
            });
            
            results.summary = {
                total: totalChecks,
                passed: passedChecks,
                failed: totalChecks - passedChecks,
                passRate: ((passedChecks / totalChecks) * 100).toFixed(2) + '%'
            };
            
            // Export as JSON
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(results, null, 2));
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "task-7-test-results.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            logToConsole('Test results exported: ' + passedChecks + '/' + totalChecks + ' checks passed', 'success');
        }
        
        // Subtask 3.7: Register event handler
        $(document).ready(function() {
            logToConsole('=== Task 7: Apply Button Functionality Test ===', 'info');
            logToConsole('Initializing MASE Admin...', 'info');
            
            // Use delegated event for template apply buttons
            $(document).on('click', '.mase-template-apply-btn', MASE.templateManager.handleTemplateApply.bind(MASE));
            
            logToConsole('Event handlers registered successfully', 'success');
            logToConsole('Ready to test template apply functionality', 'info');
            logToConsole('', 'info');
            logToConsole('Test Instructions:', 'info');
            logToConsole('1. Test Subtask 7.1: Click Apply and verify confirmation dialog', 'info');
            logToConsole('2. Test Subtask 7.2: Confirm and verify successful application', 'info');
            logToConsole('3. Test Subtask 7.3: Enable error simulation and verify error handling', 'info');
            logToConsole('', 'info');
        });
    </script>
</body>
</html>
