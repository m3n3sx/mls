<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE JavaScript Initialization Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
        #console-output {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .console-line {
            margin: 2px 0;
        }
        .console-error {
            color: #d32f2f;
        }
        .console-warn {
            color: #f57c00;
        }
        .console-log {
            color: #333;
        }
    </style>
</head>
<body>
    <h1>üîç MASE JavaScript Initialization Diagnostic</h1>
    
    <div class="test-section">
        <h2>1. Dependency Check</h2>
        <div id="dependency-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. MASE Object Check</h2>
        <div id="mase-object-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Event Handler Test</h2>
        <button id="test-button" class="mase-tab-button" data-tab="test">Test Tab Button</button>
        <button id="test-palette" class="mase-palette-apply-btn" data-palette-id="test">Test Palette Button</button>
        <div id="event-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Console Output</h2>
        <div id="console-output"></div>
    </div>
    
    <script>
        // Capture console output
        const consoleOutput = document.getElementById('console-output');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        function addConsoleOutput(type, ...args) {
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${type.toUpperCase()}] ${args.join(' ')}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Call original console method
            originalConsole[type].apply(console, args);
        }
        
        console.log = (...args) => addConsoleOutput('log', ...args);
        console.error = (...args) => addConsoleOutput('error', ...args);
        console.warn = (...args) => addConsoleOutput('warn', ...args);
        
        // Test 1: Check dependencies
        function testDependencies() {
            const results = document.getElementById('dependency-results');
            const tests = [
                { name: 'jQuery', check: () => typeof jQuery !== 'undefined' },
                { name: 'jQuery $ alias', check: () => typeof $ !== 'undefined' },
                { name: 'jQuery version', check: () => jQuery && jQuery.fn && jQuery.fn.jquery }
            ];
            
            tests.forEach(test => {
                const result = document.createElement('div');
                result.className = 'test-result';
                
                try {
                    const passed = test.check();
                    if (passed) {
                        result.className += ' test-pass';
                        result.textContent = `‚úì ${test.name}: ${test.name === 'jQuery version' ? jQuery.fn.jquery : 'OK'}`;
                    } else {
                        result.className += ' test-fail';
                        result.textContent = `‚úó ${test.name}: NOT FOUND`;
                    }
                } catch (e) {
                    result.className += ' test-fail';
                    result.textContent = `‚úó ${test.name}: ERROR - ${e.message}`;
                }
                
                results.appendChild(result);
            });
        }
        
        // Test 2: Check MASE object
        function testMASEObject() {
            const results = document.getElementById('mase-object-results');
            const tests = [
                { name: 'MASE object exists', check: () => typeof MASE !== 'undefined' },
                { name: 'MASE.init exists', check: () => MASE && typeof MASE.init === 'function' },
                { name: 'MASE.config exists', check: () => MASE && typeof MASE.config === 'object' },
                { name: 'MASE.state exists', check: () => MASE && typeof MASE.state === 'object' },
                { name: 'MASE.tabNavigation exists', check: () => MASE && typeof MASE.tabNavigation === 'object' },
                { name: 'MASE.paletteManager exists', check: () => MASE && typeof MASE.paletteManager === 'object' }
            ];
            
            tests.forEach(test => {
                const result = document.createElement('div');
                result.className = 'test-result';
                
                try {
                    const passed = test.check();
                    result.className += passed ? ' test-pass' : ' test-fail';
                    result.textContent = `${passed ? '‚úì' : '‚úó'} ${test.name}`;
                } catch (e) {
                    result.className += ' test-fail';
                    result.textContent = `‚úó ${test.name}: ERROR - ${e.message}`;
                }
                
                results.appendChild(result);
            });
        }
        
        // Test 3: Test event handlers
        function testEventHandlers() {
            const results = document.getElementById('event-results');
            
            // Test tab button click
            let tabClicked = false;
            $(document).on('click', '.mase-tab-button', function() {
                tabClicked = true;
            });
            
            $('#test-button').trigger('click');
            
            const tabResult = document.createElement('div');
            tabResult.className = 'test-result ' + (tabClicked ? 'test-pass' : 'test-fail');
            tabResult.textContent = `${tabClicked ? '‚úì' : '‚úó'} Tab button click event`;
            results.appendChild(tabResult);
            
            // Test palette button click
            let paletteClicked = false;
            $(document).on('click', '.mase-palette-apply-btn', function() {
                paletteClicked = true;
            });
            
            $('#test-palette').trigger('click');
            
            const paletteResult = document.createElement('div');
            paletteResult.className = 'test-result ' + (paletteClicked ? 'test-pass' : 'test-fail');
            paletteResult.textContent = `${paletteClicked ? '‚úì' : '‚úó'} Palette button click event`;
            results.appendChild(paletteResult);
        }
        
        // Run tests when jQuery is ready
        if (typeof jQuery !== 'undefined') {
            jQuery(document).ready(function() {
                console.log('Starting MASE diagnostic tests...');
                testDependencies();
                testMASEObject();
                testEventHandlers();
                console.log('Diagnostic tests complete');
            });
        } else {
            document.getElementById('dependency-results').innerHTML = 
                '<div class="test-result test-fail">‚úó jQuery is not loaded! Cannot run tests.</div>';
        }
    </script>
</body>
</html>
