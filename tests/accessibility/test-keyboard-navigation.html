<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE - Keyboard Navigation Test (Requirement 13.4)</title>
    <link rel="stylesheet" href="../../assets/css/mase-palettes.css">
    <link rel="stylesheet" href="../../assets/css/mase-templates.css">
    <link rel="stylesheet" href="../../assets/css/mase-accessibility.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f0f0f1;
        }
        
        .test-header {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #1e293b;
            border-bottom: 2px solid #4A90E2;
            padding-bottom: 10px;
        }
        
        .keyboard-hint {
            background: #f8f9fa;
            border-left: 4px solid #4A90E2;
            padding: 12px 16px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .keyboard-hint strong {
            color: #4A90E2;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-result.pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-result.pending {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        /* Tab Navigation Demo */
        .mase-tab-nav {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .mase-tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }
        
        .mase-tab-button:hover {
            color: #1e293b;
            background: #f8fafc;
        }
        
        .mase-tab-button[aria-selected="true"] {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
        }
        
        .mase-tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        .mase-tab-content.active {
            display: block;
        }
        
        /* Form Controls */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1e293b;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group input[type="checkbox"],
        .form-group input[type="radio"] {
            margin-right: 8px;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .button {
            padding: 10px 20px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            background: #ffffff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .button-primary {
            background: #4A90E2;
            color: #ffffff;
            border-color: #4A90E2;
        }
        
        .button-primary:hover {
            background: #357ABD;
        }
        
        .button-secondary:hover {
            background: #f8fafc;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: #ffffff;
            padding: 24px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .modal h3 {
            margin-top: 0;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* Focus tracking */
        .focus-tracker {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            color: #ffffff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            z-index: 2000;
        }
        
        .focus-tracker strong {
            color: #4A90E2;
        }
    </style>
</head>
<body>
    <!-- Skip Link (Requirement 13.5) -->
    <a href="#main-content" class="mase-skip-link">Skip to main content</a>
    
    <div class="test-header">
        <h1>üéπ Keyboard Navigation Test</h1>
        <p><strong>Requirement 13.4:</strong> Ensure all interactive elements are reachable via Tab key</p>
        <div class="keyboard-hint">
            <strong>Instructions:</strong> Use <kbd>Tab</kbd> to navigate forward, <kbd>Shift+Tab</kbd> to navigate backward, 
            <kbd>Enter</kbd> or <kbd>Space</kbd> to activate, <kbd>Arrow keys</kbd> in tab lists, <kbd>Escape</kbd> to close modals.
        </div>
    </div>
    
    <main id="main-content">
        <!-- Test 1: Tab Navigation -->
        <section class="test-section">
            <h2>Test 1: Tab List Navigation (Arrow Keys)</h2>
            <p>Use <kbd>Tab</kbd> to focus the tab list, then use <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> arrow keys to navigate between tabs.</p>
            
            <div role="tablist" class="mase-tab-nav" aria-label="Settings tabs">
                <button role="tab" 
                        class="mase-tab-button" 
                        id="tab-general" 
                        aria-selected="true" 
                        aria-controls="panel-general"
                        tabindex="0">
                    General
                </button>
                <button role="tab" 
                        class="mase-tab-button" 
                        id="tab-colors" 
                        aria-selected="false" 
                        aria-controls="panel-colors"
                        tabindex="-1">
                    Colors
                </button>
                <button role="tab" 
                        class="mase-tab-button" 
                        id="tab-typography" 
                        aria-selected="false" 
                        aria-controls="panel-typography"
                        tabindex="-1">
                    Typography
                </button>
                <button role="tab" 
                        class="mase-tab-button" 
                        id="tab-advanced" 
                        aria-selected="false" 
                        aria-controls="panel-advanced"
                        tabindex="-1">
                    Advanced
                </button>
            </div>
            
            <div id="panel-general" role="tabpanel" aria-labelledby="tab-general" class="mase-tab-content active" tabindex="0">
                <h3>General Settings</h3>
                <p>This is the general settings panel. Press Tab to navigate to the next control.</p>
            </div>
            
            <div id="panel-colors" role="tabpanel" aria-labelledby="tab-colors" class="mase-tab-content" tabindex="0" hidden>
                <h3>Color Settings</h3>
                <p>This is the color settings panel.</p>
            </div>
            
            <div id="panel-typography" role="tabpanel" aria-labelledby="tab-typography" class="mase-tab-content" tabindex="0" hidden>
                <h3>Typography Settings</h3>
                <p>This is the typography settings panel.</p>
            </div>
            
            <div id="panel-advanced" role="tabpanel" aria-labelledby="tab-advanced" class="mase-tab-content" tabindex="0" hidden>
                <h3>Advanced Settings</h3>
                <p>This is the advanced settings panel.</p>
            </div>
            
            <div class="test-result pending" id="result-tabs">
                ‚è≥ Test arrow key navigation in tab list
            </div>
        </section>
        
        <!-- Test 2: Form Controls -->
        <section class="test-section">
            <h2>Test 2: Form Controls Navigation</h2>
            <p>Use <kbd>Tab</kbd> to navigate through all form controls. Each should receive visible focus.</p>
            
            <form id="test-form">
                <div class="form-group">
                    <label for="input-text">Text Input:</label>
                    <input type="text" id="input-text" placeholder="Enter text here">
                </div>
                
                <div class="form-group">
                    <label for="input-email">Email Input:</label>
                    <input type="email" id="input-email" placeholder="email@example.com">
                </div>
                
                <div class="form-group">
                    <label for="select-option">Select Dropdown:</label>
                    <select id="select-option">
                        <option value="">Choose an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="textarea">Textarea:</label>
                    <textarea id="textarea" rows="3" placeholder="Enter multiple lines"></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="checkbox-1">
                        Checkbox Option 1
                    </label>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="checkbox-2">
                        Checkbox Option 2
                    </label>
                </div>
                
                <div class="form-group">
                    <fieldset>
                        <legend>Radio Group:</legend>
                        <label>
                            <input type="radio" name="radio-group" value="a" id="radio-a">
                            Option A
                        </label>
                        <label>
                            <input type="radio" name="radio-group" value="b" id="radio-b">
                            Option B
                        </label>
                        <label>
                            <input type="radio" name="radio-group" value="c" id="radio-c">
                            Option C
                        </label>
                    </fieldset>
                </div>
            </form>
            
            <div class="test-result pending" id="result-forms">
                ‚è≥ Test Tab navigation through all form controls
            </div>
        </section>
        
        <!-- Test 3: Buttons -->
        <section class="test-section">
            <h2>Test 3: Button Navigation</h2>
            <p>Use <kbd>Tab</kbd> to navigate between buttons. Press <kbd>Enter</kbd> or <kbd>Space</kbd> to activate.</p>
            
            <div class="button-group">
                <button class="button button-primary" id="btn-primary">Primary Button</button>
                <button class="button button-secondary" id="btn-secondary">Secondary Button</button>
                <button class="button button-secondary" id="btn-tertiary">Tertiary Button</button>
                <button class="button button-secondary" id="btn-open-modal">Open Modal</button>
            </div>
            
            <div class="test-result pending" id="result-buttons">
                ‚è≥ Test button activation with Enter and Space keys
            </div>
        </section>
        
        <!-- Test 4: Modal Focus Trap -->
        <section class="test-section">
            <h2>Test 4: Modal Focus Trap</h2>
            <p>Click "Open Modal" button above. Focus should be trapped inside modal. Press <kbd>Escape</kbd> to close.</p>
            
            <div class="test-result pending" id="result-modal">
                ‚è≥ Test focus trap in modal and Escape key dismissal
            </div>
        </section>
        
        <!-- Test 5: Skip Links -->
        <section class="test-section">
            <h2>Test 5: Skip Navigation Link</h2>
            <p>Press <kbd>Tab</kbd> from the top of the page. The first focusable element should be a "Skip to main content" link.</p>
            
            <div class="test-result pending" id="result-skip">
                ‚è≥ Test skip link appears on focus and works correctly
            </div>
        </section>
        
        <!-- Test 6: Focus Indicators -->
        <section class="test-section">
            <h2>Test 6: Visible Focus Indicators</h2>
            <p>All focused elements should have a visible 2px outline with 2px offset (Requirement 13.3).</p>
            
            <div class="test-result pending" id="result-focus">
                ‚è≥ Verify all elements show visible focus indicators
            </div>
        </section>
    </main>
    
    <!-- Modal -->
    <div class="modal-overlay" id="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal">
            <h3 id="modal-title">Test Modal</h3>
            <p>This modal tests focus trapping. Try pressing <kbd>Tab</kbd> - focus should stay within the modal.</p>
            
            <div class="form-group">
                <label for="modal-input">Modal Input:</label>
                <input type="text" id="modal-input" placeholder="Test input">
            </div>
            
            <div class="modal-actions">
                <button class="button button-secondary" id="btn-cancel">Cancel</button>
                <button class="button button-primary" id="btn-confirm">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Focus Tracker -->
    <div class="focus-tracker" id="focus-tracker">
        <strong>Currently Focused:</strong><br>
        <span id="focus-element">None</span>
    </div>
    
    <script>
        // Tab Navigation with Arrow Keys
        const tabList = document.querySelector('[role="tablist"]');
        const tabs = Array.from(document.querySelectorAll('[role="tab"]'));
        const panels = Array.from(document.querySelectorAll('[role="tabpanel"]'));
        
        function switchTab(oldTab, newTab) {
            // Deactivate old tab
            oldTab.setAttribute('aria-selected', 'false');
            oldTab.setAttribute('tabindex', '-1');
            
            // Activate new tab
            newTab.setAttribute('aria-selected', 'true');
            newTab.setAttribute('tabindex', '0');
            newTab.focus();
            
            // Hide old panel, show new panel
            const oldPanel = document.getElementById(oldTab.getAttribute('aria-controls'));
            const newPanel = document.getElementById(newTab.getAttribute('aria-controls'));
            
            oldPanel.hidden = true;
            oldPanel.classList.remove('active');
            
            newPanel.hidden = false;
            newPanel.classList.add('active');
            
            // Mark test as passed
            document.getElementById('result-tabs').className = 'test-result pass';
            document.getElementById('result-tabs').innerHTML = '‚úÖ Arrow key navigation working correctly';
        }
        
        tabList.addEventListener('keydown', (e) => {
            const currentTab = document.activeElement;
            const currentIndex = tabs.indexOf(currentTab);
            
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                e.preventDefault();
                let newIndex;
                
                if (e.key === 'ArrowRight') {
                    newIndex = currentIndex + 1;
                    if (newIndex >= tabs.length) newIndex = 0;
                } else {
                    newIndex = currentIndex - 1;
                    if (newIndex < 0) newIndex = tabs.length - 1;
                }
                
                switchTab(currentTab, tabs[newIndex]);
            } else if (e.key === 'Home') {
                e.preventDefault();
                switchTab(currentTab, tabs[0]);
            } else if (e.key === 'End') {
                e.preventDefault();
                switchTab(currentTab, tabs[tabs.length - 1]);
            }
        });
        
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                const currentTab = document.querySelector('[aria-selected="true"]');
                if (currentTab !== tab) {
                    switchTab(currentTab, tab);
                }
            });
        });
        
        // Form Controls Test
        const formControls = document.querySelectorAll('#test-form input, #test-form select, #test-form textarea');
        let formControlsFocused = new Set();
        
        formControls.forEach(control => {
            control.addEventListener('focus', () => {
                formControlsFocused.add(control.id);
                if (formControlsFocused.size === formControls.length) {
                    document.getElementById('result-forms').className = 'test-result pass';
                    document.getElementById('result-forms').innerHTML = '‚úÖ All form controls are keyboard accessible';
                }
            });
        });
        
        // Button Test
        const buttons = document.querySelectorAll('.button-group .button');
        let buttonActivated = false;
        
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (!buttonActivated) {
                    buttonActivated = true;
                    document.getElementById('result-buttons').className = 'test-result pass';
                    document.getElementById('result-buttons').innerHTML = '‚úÖ Buttons are keyboard activatable';
                }
            });
            
            btn.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    btn.click();
                }
            });
        });
        
        // Modal Focus Trap
        const modalOverlay = document.getElementById('modal-overlay');
        const btnOpenModal = document.getElementById('btn-open-modal');
        const btnCancel = document.getElementById('btn-cancel');
        const btnConfirm = document.getElementById('btn-confirm');
        const modalInput = document.getElementById('modal-input');
        let previousFocus;
        
        const focusableElements = [modalInput, btnCancel, btnConfirm];
        
        btnOpenModal.addEventListener('click', () => {
            previousFocus = document.activeElement;
            modalOverlay.classList.add('active');
            modalInput.focus();
            
            document.getElementById('result-modal').className = 'test-result pass';
            document.getElementById('result-modal').innerHTML = '‚úÖ Modal opened, focus trapped inside';
        });
        
        function closeModal() {
            modalOverlay.classList.remove('active');
            if (previousFocus) {
                previousFocus.focus();
            }
        }
        
        btnCancel.addEventListener('click', closeModal);
        btnConfirm.addEventListener('click', closeModal);
        
        // Escape key to close modal
        modalOverlay.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
            
            // Focus trap
            if (e.key === 'Tab') {
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];
                
                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        });
        
        // Skip Link Test
        const skipLink = document.querySelector('.mase-skip-link');
        skipLink.addEventListener('focus', () => {
            document.getElementById('result-skip').className = 'test-result pass';
            document.getElementById('result-skip').innerHTML = '‚úÖ Skip link is keyboard accessible';
        });
        
        // Focus Indicator Test
        let focusIndicatorTested = false;
        document.addEventListener('focusin', (e) => {
            if (!focusIndicatorTested && e.target.matches('button, input, select, textarea, a, [tabindex]')) {
                const styles = window.getComputedStyle(e.target);
                const outlineWidth = styles.getPropertyValue('outline-width');
                
                if (outlineWidth && parseFloat(outlineWidth) >= 2) {
                    focusIndicatorTested = true;
                    document.getElementById('result-focus').className = 'test-result pass';
                    document.getElementById('result-focus').innerHTML = '‚úÖ Focus indicators are visible (2px outline)';
                }
            }
        });
        
        // Focus Tracker
        const focusTracker = document.getElementById('focus-tracker');
        const focusElement = document.getElementById('focus-element');
        
        document.addEventListener('focusin', (e) => {
            const element = e.target;
            let description = element.tagName.toLowerCase();
            
            if (element.id) {
                description += `#${element.id}`;
            }
            if (element.getAttribute('aria-label')) {
                description += ` "${element.getAttribute('aria-label')}"`;
            }
            if (element.textContent && element.textContent.trim().length < 30) {
                description += ` "${element.textContent.trim()}"`;
            }
            
            focusElement.textContent = description;
        });
        
        // Auto-pass focus test after 5 seconds if any element was focused
        setTimeout(() => {
            if (focusIndicatorTested) {
                document.getElementById('result-focus').className = 'test-result pass';
                document.getElementById('result-focus').innerHTML = '‚úÖ Focus indicators verified';
            }
        }, 5000);
    </script>
</body>
</html>
