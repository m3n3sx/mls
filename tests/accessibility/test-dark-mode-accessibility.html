<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE - Dark Mode Accessibility Test</title>
    <link rel="stylesheet" href="../../assets/css/mase-admin.css">
    <link rel="stylesheet" href="../../assets/css/mase-accessibility.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: #f0f0f1;
        }
        
        .test-header {
            background: #ffffff;
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: #ffffff;
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #1e293b;
            border-bottom: 2px solid #4A90E2;
            padding-bottom: 10px;
        }
        
        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #4A90E2;
            padding: 16px;
            margin: 16px 0;
            border-radius: 4px;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-left: 3px solid #cbd5e1;
            border-radius: 4px;
        }
        
        .checklist li.checked {
            background: #d4edda;
            border-left-color: #46b450;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-result.pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-result.pending {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .contrast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .contrast-card {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .contrast-sample {
            padding: 20px;
            border-radius: 4px;
            margin: 10px 0;
            text-align: center;
            font-weight: 500;
        }
        
        .contrast-ratio {
            font-family: monospace;
            font-size: 14px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="mase-skip-link">Skip to main content</a>
    
    <div class="test-header">
        <h1>♿ Dark Mode Accessibility Test</h1>
        <p><strong>Requirements:</strong> 5.1-5.7, 6.6, 9.6-9.7</p>
        <p>Comprehensive accessibility testing for the dark/light mode toggle feature</p>
    </div>
    
    <main id="main-content">
        <!-- Test 1: Keyboard Navigation -->
        <section class="test-section">
            <h2>Test 1: Keyboard Navigation (Req 5.1, 5.2, 5.6)</h2>
            <p>Test keyboard accessibility of the dark mode toggle FAB</p>
            
            <div class="instructions">
                <strong>Test Steps:</strong>
                <ol>
                    <li>Press <kbd>Tab</kbd> to navigate to the FAB</li>
                    <li>Press <kbd>Enter</kbd> or <kbd>Space</kbd> to toggle mode</li>
                    <li>Press <kbd>Ctrl+Shift+D</kbd> (or <kbd>Cmd+Shift+D</kbd> on Mac) to toggle via shortcut</li>
                    <li>Verify FAB has visible focus indicator (2px outline)</li>
                </ol>
            </div>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        FAB is reachable via Tab key
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        Enter key toggles dark mode
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        Space key toggles dark mode
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        Ctrl/Cmd+Shift+D keyboard shortcut works
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        FAB shows visible focus indicator (2px outline, 2px offset)
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="keyboard">
                        Keyboard shortcut does NOT trigger in input fields
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-keyboard">
                ⏳ Test keyboard navigation
            </div>
        </section>
        
        <!-- Test 2: Screen Reader Announcements -->
        <section class="test-section">
            <h2>Test 2: Screen Reader Announcements (Req 5.4, 5.7)</h2>
            <p>Test screen reader support for mode changes</p>
            
            <div class="instructions">
                <strong>Screen Reader Instructions:</strong><br>
                <strong>Windows (NVDA):</strong> Ctrl+Alt+N to start<br>
                <strong>Mac (VoiceOver):</strong> Cmd+F5 to start<br>
                <strong>Linux (Orca):</strong> Super+Alt+S to start
            </div>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="screenreader">
                        FAB has descriptive aria-label ("Toggle dark mode")
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="screenreader">
                        FAB has aria-pressed attribute (true/false)
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="screenreader">
                        Mode change is announced ("Dark mode activated")
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="screenreader">
                        ARIA live region announces changes
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="screenreader">
                        Icon changes are hidden from screen readers (aria-hidden="true")
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-screenreader">
                ⏳ Test with screen reader
            </div>
        </section>
        
        <!-- Test 3: Focus Indicators -->
        <section class="test-section">
            <h2>Test 3: Focus Indicators (Req 5.7)</h2>
            <p>Test visible focus indicators meet WCAG 2.1 AA standards</p>
            
            <div class="instructions">
                <strong>Requirements:</strong>
                <ul>
                    <li>Minimum 2px outline width</li>
                    <li>2px offset from element</li>
                    <li>Sufficient contrast with background (3:1 minimum)</li>
                    <li>Visible in both light and dark modes</li>
                </ul>
            </div>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="focus">
                        FAB focus outline is at least 2px wide
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="focus">
                        Focus outline has 2px offset from FAB
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="focus">
                        Focus indicator visible in light mode
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="focus">
                        Focus indicator visible in dark mode
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="focus">
                        Focus indicator has sufficient contrast (3:1 minimum)
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-focus">
                ⏳ Test focus indicators
            </div>
        </section>
        
        <!-- Test 4: ARIA Attributes -->
        <section class="test-section">
            <h2>Test 4: ARIA Attributes (Req 5.4, 5.7)</h2>
            <p>Test proper ARIA attribute implementation</p>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        FAB has role="switch" or role="button"
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        FAB has aria-label attribute
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        FAB has aria-pressed attribute
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        aria-pressed updates on toggle (true/false)
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        Icon has aria-hidden="true"
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="aria">
                        ARIA live region exists for announcements
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-aria">
                ⏳ Test ARIA attributes
            </div>
        </section>
        
        <!-- Test 5: Contrast Ratios (WCAG 2.1 AA) -->
        <section class="test-section">
            <h2>Test 5: Contrast Ratios - WCAG 2.1 AA (Req 6.6)</h2>
            <p>Test color contrast meets WCAG 2.1 AA standards (4.5:1 for normal text, 3:1 for large text)</p>
            
            <div class="instructions">
                <strong>WCAG 2.1 AA Requirements:</strong>
                <ul>
                    <li>Normal text (< 18pt): 4.5:1 minimum</li>
                    <li>Large text (≥ 18pt or ≥ 14pt bold): 3:1 minimum</li>
                    <li>UI components and graphics: 3:1 minimum</li>
                </ul>
            </div>
            
            <h3>Light Mode Contrast Tests</h3>
            <div class="contrast-grid">
                <div class="contrast-card">
                    <h4>Admin Bar</h4>
                    <div class="contrast-sample" style="background: #23282d; color: #eee;">
                        Admin Bar Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-adminbar-light">Calculating...</span>
                    </div>
                </div>
                
                <div class="contrast-card">
                    <h4>Admin Menu</h4>
                    <div class="contrast-sample" style="background: #23282d; color: #eee;">
                        Menu Item Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-menu-light">Calculating...</span>
                    </div>
                </div>
                
                <div class="contrast-card">
                    <h4>Content Area</h4>
                    <div class="contrast-sample" style="background: #f0f0f1; color: #1d2327;">
                        Content Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-content-light">Calculating...</span>
                    </div>
                </div>
            </div>
            
            <h3>Dark Mode Contrast Tests</h3>
            <div class="contrast-grid">
                <div class="contrast-card">
                    <h4>Admin Bar (Dark)</h4>
                    <div class="contrast-sample" style="background: #1a1a1a; color: #e0e0e0;">
                        Admin Bar Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-adminbar-dark">Calculating...</span>
                    </div>
                </div>
                
                <div class="contrast-card">
                    <h4>Admin Menu (Dark)</h4>
                    <div class="contrast-sample" style="background: #2d2d2d; color: #e0e0e0;">
                        Menu Item Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-menu-dark">Calculating...</span>
                    </div>
                </div>
                
                <div class="contrast-card">
                    <h4>Content Area (Dark)</h4>
                    <div class="contrast-sample" style="background: #1e1e1e; color: #e0e0e0;">
                        Content Text
                    </div>
                    <div class="contrast-ratio">
                        Ratio: <span id="contrast-content-dark">Calculating...</span>
                    </div>
                </div>
            </div>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Light mode admin bar text contrast ≥ 4.5:1
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Light mode admin menu text contrast ≥ 4.5:1
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Light mode content text contrast ≥ 4.5:1
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Dark mode admin bar text contrast ≥ 4.5:1
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Dark mode admin menu text contrast ≥ 4.5:1
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="contrast">
                        Dark mode content text contrast ≥ 4.5:1
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-contrast">
                ⏳ Test contrast ratios
            </div>
        </section>
        
        <!-- Test 6: Reduced Motion Support -->
        <section class="test-section">
            <h2>Test 6: Reduced Motion Support (Req 9.6, 9.7)</h2>
            <p>Test animations are disabled when reduced motion is enabled</p>
            
            <div class="instructions">
                <strong>Enable Reduced Motion:</strong><br>
                <strong>Windows:</strong> Settings → Ease of Access → Display → Show animations<br>
                <strong>Mac:</strong> System Preferences → Accessibility → Display → Reduce motion<br>
                <strong>DevTools:</strong> Ctrl+Shift+P → "Emulate CSS prefers-reduced-motion: reduce"
            </div>
            
            <div id="motion-status" style="padding: 16px; border-radius: 8px; margin: 16px 0;">
                <strong>Current Status:</strong> <span id="motion-text">Checking...</span>
            </div>
            
            <ul class="checklist">
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="motion">
                        FAB icon rotation animation disabled (0s duration)
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="motion">
                        Color transition duration set to 0s
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="motion">
                        Mode toggle is instant (no smooth transition)
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="motion">
                        FAB hover effects have no animation
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" class="test-check" data-test="motion">
                        Functionality still works (mode still toggles)
                    </label>
                </li>
            </ul>
            
            <div class="test-result pending" id="result-motion">
                ⏳ Test reduced motion support
            </div>
        </section>
        
        <!-- Test Summary -->
        <section class="test-section">
            <h2>Test Summary</h2>
            <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <p><strong>Total Tests:</strong> <span id="total-tests">0</span></p>
                <p><strong>Passed:</strong> <span id="passed-tests">0</span></p>
                <p><strong>Progress:</strong> <span id="progress-percent">0%</span></p>
                
                <div style="margin-top: 20px;">
                    <div style="height: 30px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                        <div id="progress-bar" style="height: 100%; background: #46b450; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
                
                <div id="final-result" style="margin-top: 20px; padding: 16px; border-radius: 8px; display: none;">
                    <strong style="font-size: 18px;"></strong>
                </div>
            </div>
        </section>
    </main>
    
    <!-- ARIA Live Region for Announcements -->
    <div aria-live="polite" aria-atomic="true" class="screen-reader-text" id="sr-announcements"></div>
    
    <script src="../../assets/js/mase-admin.js"></script>
    <script>
        // Contrast calculation helper
        function getLuminance(r, g, b) {
            const [rs, gs, bs] = [r, g, b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        }
        
        function getContrastRatio(color1, color2) {
            const l1 = getLuminance(...color1);
            const l2 = getLuminance(...color2);
            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);
            return (lighter + 0.05) / (darker + 0.05);
        }
        
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [
                parseInt(result[1], 16),
                parseInt(result[2], 16),
                parseInt(result[3], 16)
            ] : null;
        }
        
        // Calculate contrast ratios
        function calculateContrasts() {
            // Light mode
            const lightAdminBar = getContrastRatio(hexToRgb('#23282d'), hexToRgb('#eee'));
            const lightMenu = getContrastRatio(hexToRgb('#23282d'), hexToRgb('#eee'));
            const lightContent = getContrastRatio(hexToRgb('#f0f0f1'), hexToRgb('#1d2327'));
            
            // Dark mode
            const darkAdminBar = getContrastRatio(hexToRgb('#1a1a1a'), hexToRgb('#e0e0e0'));
            const darkMenu = getContrastRatio(hexToRgb('#2d2d2d'), hexToRgb('#e0e0e0'));
            const darkContent = getContrastRatio(hexToRgb('#1e1e1e'), hexToRgb('#e0e0e0'));
            
            // Display results
            document.getElementById('contrast-adminbar-light').textContent = lightAdminBar.toFixed(2) + ':1 ' + (lightAdminBar >= 4.5 ? '✓' : '✗');
            document.getElementById('contrast-menu-light').textContent = lightMenu.toFixed(2) + ':1 ' + (lightMenu >= 4.5 ? '✓' : '✗');
            document.getElementById('contrast-content-light').textContent = lightContent.toFixed(2) + ':1 ' + (lightContent >= 4.5 ? '✓' : '✗');
            
            document.getElementById('contrast-adminbar-dark').textContent = darkAdminBar.toFixed(2) + ':1 ' + (darkAdminBar >= 4.5 ? '✓' : '✗');
            document.getElementById('contrast-menu-dark').textContent = darkMenu.toFixed(2) + ':1 ' + (darkMenu >= 4.5 ? '✓' : '✗');
            document.getElementById('contrast-content-dark').textContent = darkContent.toFixed(2) + ':1 ' + (darkContent >= 4.5 ? '✓' : '✗');
        }
        
        // Check reduced motion preference
        function checkReducedMotion() {
            const motionStatus = document.getElementById('motion-status');
            const motionText = document.getElementById('motion-text');
            
            if (window.matchMedia) {
                const reducedMotionMQ = window.matchMedia('(prefers-reduced-motion: reduce)');
                
                if (reducedMotionMQ.matches) {
                    motionText.textContent = 'Reduced Motion ENABLED ✓';
                    motionText.style.color = '#46b450';
                    motionStatus.style.background = '#d4edda';
                    motionStatus.style.border = '2px solid #46b450';
                } else {
                    motionText.textContent = 'Reduced Motion DISABLED';
                    motionText.style.color = '#FF6F00';
                    motionStatus.style.background = '#fff3cd';
                    motionStatus.style.border = '2px solid #ffc107';
                }
                
                reducedMotionMQ.addListener(checkReducedMotion);
            } else {
                motionText.textContent = 'Not Supported';
                motionText.style.color = '#dc3232';
            }
        }
        
        // Test summary tracking
        const checkboxes = document.querySelectorAll('.test-check');
        const totalTests = document.getElementById('total-tests');
        const passedTests = document.getElementById('passed-tests');
        const progressPercent = document.getElementById('progress-percent');
        const progressBar = document.getElementById('progress-bar');
        const finalResult = document.getElementById('final-result');
        
        totalTests.textContent = checkboxes.length;
        
        function updateSummary() {
            const checked = document.querySelectorAll('.test-check:checked').length;
            passedTests.textContent = checked;
            const percent = Math.round((checked / checkboxes.length) * 100);
            progressPercent.textContent = percent + '%';
            progressBar.style.width = percent + '%';
            
            // Update parent li styling
            checkboxes.forEach(cb => {
                const li = cb.closest('li');
                if (cb.checked) {
                    li.classList.add('checked');
                } else {
                    li.classList.remove('checked');
                }
            });
            
            // Show final result if all tests passed
            if (checked === checkboxes.length) {
                finalResult.style.display = 'block';
                finalResult.style.background = '#d4edda';
                finalResult.style.border = '2px solid #46b450';
                finalResult.querySelector('strong').textContent = '✅ All accessibility tests passed!';
                finalResult.querySelector('strong').style.color = '#155724';
            } else if (checked > 0) {
                finalResult.style.display = 'block';
                finalResult.style.background = '#fff3cd';
                finalResult.style.border = '2px solid #ffc107';
                finalResult.querySelector('strong').textContent = `⏳ ${checkboxes.length - checked} tests remaining`;
                finalResult.querySelector('strong').style.color = '#856404';
            }
        }
        
        checkboxes.forEach(cb => {
            cb.addEventListener('change', updateSummary);
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            calculateContrasts();
            checkReducedMotion();
            updateSummary();
        });
    </script>
</body>
</html>
