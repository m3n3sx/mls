<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE Browser Compatibility Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f1;
        }

        h1 {
            color: #1d2327;
            border-bottom: 2px solid #2271b1;
            padding-bottom: 10px;
        }

        h2 {
            color: #2c3338;
            margin-top: 30px;
        }

        .test-section {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .feature-test {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #dcdcde;
            border-radius: 3px;
        }

        .feature-name {
            font-weight: 600;
            color: #2c3338;
        }

        .feature-status {
            font-size: 18px;
            font-weight: bold;
        }

        .feature-status.supported {
            color: #46b450;
        }

        .feature-status.unsupported {
            color: #dc3232;
        }

        .feature-status.pending {
            color: #ffb900;
        }

        .browser-info {
            background: #f6f7f7;
            padding: 15px;
            border-left: 4px solid #2271b1;
            margin: 20px 0;
        }

        .browser-info p {
            margin: 5px 0;
        }

        .compatibility-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }

        .compatibility-notice.error {
            background: #f8d7da;
            border-color: #dc3232;
        }

        .compatibility-notice.success {
            background: #d4edda;
            border-color: #46b450;
        }

        .test-demo {
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #8c8f94;
            border-radius: 4px;
        }

        .gradient-demo {
            height: 100px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .blend-mode-demo {
            position: relative;
            height: 100px;
            background: #2271b1;
            border-radius: 4px;
            margin: 10px 0;
        }

        .blend-mode-demo::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #dc3232;
            mix-blend-mode: overlay;
        }

        button {
            background: #2271b1;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #135e96;
        }

        button:disabled {
            background: #8c8f94;
            cursor: not-allowed;
        }

        .log {
            background: #1d2327;
            color: #50fa7b;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .log-entry {
            margin: 3px 0;
        }

        .log-entry.error {
            color: #ff5555;
        }

        .log-entry.success {
            color: #50fa7b;
        }

        .log-entry.warning {
            color: #ffb86c;
        }
    </style>
</head>
<body>
    <h1>üîç MASE Browser Compatibility Test</h1>

    <div class="browser-info">
        <h3>Browser Information</h3>
        <p><strong>Browser:</strong> <span id="browser-name">Detecting...</span></p>
        <p><strong>Version:</strong> <span id="browser-version">Detecting...</span></p>
        <p><strong>User Agent:</strong> <span id="user-agent">Detecting...</span></p>
        <p><strong>Outdated:</strong> <span id="browser-outdated">Checking...</span></p>
    </div>

    <div class="test-section">
        <h2>Feature Detection Results</h2>
        <div id="feature-results"></div>
    </div>

    <div class="test-section">
        <h2>Visual Feature Tests</h2>
        
        <h3>CSS Gradients</h3>
        <div class="gradient-demo" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <p style="color: white; padding: 10px; margin: 0;">
                If you see a purple gradient, CSS gradients are working.
            </p>
        </div>

        <h3>CSS Blend Modes</h3>
        <div class="blend-mode-demo">
            <p style="color: white; padding: 10px; margin: 0; position: relative; z-index: 1;">
                If you see a blended purple color, blend modes are working.
            </p>
        </div>

        <h3>File Upload</h3>
        <div class="test-demo">
            <input type="file" id="test-file-input" accept="image/*">
            <p id="file-preview-result">Select an image to test FileReader API</p>
        </div>

        <h3>Drag & Drop</h3>
        <div class="test-demo" id="drag-drop-zone" style="min-height: 100px; display: flex; align-items: center; justify-content: center;">
            <p>Drag an image here to test drag & drop</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Interactive Tests</h2>
        <button id="test-webp">Test WebP Detection</button>
        <button id="test-intersection-observer">Test IntersectionObserver</button>
        <button id="test-css-variables">Test CSS Variables</button>
        <button id="run-all-tests">Run All Tests</button>
    </div>

    <div class="test-section">
        <h2>Test Log</h2>
        <div class="log" id="test-log"></div>
    </div>

    <div id="compatibility-notices"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock maseAdmin object for standalone testing
        window.maseAdmin = {
            debug: true,
            ajaxUrl: '',
            nonce: ''
        };

        // Mock MASE namespace
        window.MASE = window.MASE || {};

        // Test logger
        const logger = {
            log: function(message, type = 'info') {
                const logEntry = $('<div class="log-entry ' + type + '">').text('[' + new Date().toLocaleTimeString() + '] ' + message);
                $('#test-log').prepend(logEntry);
                console.log(message);
            },
            success: function(message) {
                this.log('‚úì ' + message, 'success');
            },
            error: function(message) {
                this.log('‚úó ' + message, 'error');
            },
            warning: function(message) {
                this.log('‚ö† ' + message, 'warning');
            }
        };

        // Load the compatibility module
        $.getScript('../assets/js/modules/mase-compatibility.js')
            .done(function() {
                logger.success('Compatibility module loaded successfully');
                runTests();
            })
            .fail(function() {
                logger.error('Failed to load compatibility module');
            });

        function runTests() {
            // Display browser info
            const browserInfo = MASE.compatibility.getBrowserInfo();
            $('#browser-name').text(browserInfo.name);
            $('#browser-version').text(browserInfo.version);
            $('#user-agent').text(navigator.userAgent);
            
            const isOutdated = MASE.compatibility.isOutdatedBrowser();
            $('#browser-outdated').text(isOutdated ? 'Yes - Please update!' : 'No')
                .css('color', isOutdated ? '#dc3232' : '#46b450');

            // Display feature detection results
            displayFeatureResults();

            // Setup interactive tests
            setupInteractiveTests();

            // Setup file upload test
            setupFileUploadTest();

            // Setup drag & drop test
            setupDragDropTest();

            logger.success('All tests initialized');
        }

        function displayFeatureResults() {
            const features = MASE.compatibility.features;
            const $results = $('#feature-results');
            $results.empty();

            for (const [feature, supported] of Object.entries(features)) {
                const featureName = feature.replace(/([A-Z])/g, ' $1').trim();
                const capitalizedName = featureName.charAt(0).toUpperCase() + featureName.slice(1);
                
                let statusText = '‚úì';
                let statusClass = 'supported';
                
                if (feature === 'webp' && supported === false) {
                    statusText = '‚è≥';
                    statusClass = 'pending';
                } else if (!supported) {
                    statusText = '‚úó';
                    statusClass = 'unsupported';
                }

                const $featureTest = $('<div class="feature-test">')
                    .append($('<span class="feature-name">').text(capitalizedName))
                    .append($('<span class="feature-status ' + statusClass + '">').text(statusText));
                
                $results.append($featureTest);

                logger.log(capitalizedName + ': ' + (supported ? 'Supported' : 'Not Supported'));
            }
        }

        function setupInteractiveTests() {
            $('#test-webp').on('click', function() {
                logger.log('Testing WebP support...');
                MASE.compatibility.detectWebP();
                
                $(document).one('mase:webp-detected', function(e, supported) {
                    if (supported) {
                        logger.success('WebP is supported');
                    } else {
                        logger.warning('WebP is not supported');
                    }
                    displayFeatureResults();
                });
            });

            $('#test-intersection-observer').on('click', function() {
                if (MASE.compatibility.isSupported('intersectionObserver')) {
                    logger.success('IntersectionObserver is supported');
                    
                    // Create a test element
                    const $testElement = $('<div>').css({
                        height: '100px',
                        background: '#46b450',
                        margin: '20px 0'
                    }).text('Test element for IntersectionObserver');
                    
                    $('#test-log').after($testElement);
                    
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                logger.success('IntersectionObserver detected element in viewport');
                                observer.disconnect();
                                setTimeout(() => $testElement.remove(), 2000);
                            }
                        });
                    });
                    
                    observer.observe($testElement[0]);
                } else {
                    logger.error('IntersectionObserver is not supported');
                }
            });

            $('#test-css-variables').on('click', function() {
                if (MASE.compatibility.isSupported('cssVariables')) {
                    logger.success('CSS Variables are supported');
                    
                    // Test CSS variable
                    $('body').css('--test-color', '#46b450');
                    const testValue = getComputedStyle(document.body).getPropertyValue('--test-color');
                    
                    if (testValue) {
                        logger.success('CSS Variable test passed: ' + testValue);
                    } else {
                        logger.warning('CSS Variable set but could not read value');
                    }
                } else {
                    logger.error('CSS Variables are not supported');
                }
            });

            $('#run-all-tests').on('click', function() {
                logger.log('Running all tests...');
                $('#test-webp').click();
                setTimeout(() => $('#test-intersection-observer').click(), 500);
                setTimeout(() => $('#test-css-variables').click(), 1000);
            });
        }

        function setupFileUploadTest() {
            $('#test-file-input').on('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                logger.log('Testing FileReader with: ' + file.name);

                if (MASE.compatibility.isSupported('fileReader')) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        $('#file-preview-result').html(
                            '<img src="' + e.target.result + '" style="max-width: 200px; max-height: 200px;">'
                        );
                        logger.success('FileReader successfully loaded image');
                    };
                    
                    reader.onerror = function() {
                        logger.error('FileReader failed to load image');
                    };
                    
                    reader.readAsDataURL(file);
                } else {
                    logger.error('FileReader is not supported');
                    $('#file-preview-result').text('FileReader not supported - cannot preview image');
                }
            });
        }

        function setupDragDropTest() {
            const $zone = $('#drag-drop-zone');

            if (MASE.compatibility.isSupported('dragDrop')) {
                $zone.on('dragover', function(e) {
                    e.preventDefault();
                    $(this).css('background', '#d4edda');
                    logger.log('Drag over detected');
                });

                $zone.on('dragleave', function() {
                    $(this).css('background', '');
                });

                $zone.on('drop', function(e) {
                    e.preventDefault();
                    $(this).css('background', '');
                    
                    const files = e.originalEvent.dataTransfer.files;
                    if (files.length > 0) {
                        logger.success('Drop detected: ' + files[0].name);
                        $(this).html('<p style="color: #46b450;">‚úì Successfully dropped: ' + files[0].name + '</p>');
                    }
                });

                logger.success('Drag & Drop handlers initialized');
            } else {
                $zone.html('<p style="color: #dc3232;">‚úó Drag & Drop not supported</p>');
                logger.error('Drag & Drop is not supported');
            }
        }
    </script>
</body>
</html>
