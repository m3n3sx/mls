<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Live Preview Integration Test - MASE</title>
    
    <!-- WordPress Color Picker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/wp-color-picker/2.1.2/wp-color-picker.min.css">
    
    <!-- MASE Admin Styles -->
    <link rel="stylesheet" href="../assets/css/mase-admin.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f1;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1d2327;
            margin-top: 0;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #2271b1;
        }
        
        .preview-area {
            margin-top: 20px;
            padding: 60px 40px;
            border: 2px dashed #8c8f94;
            border-radius: 4px;
            min-height: 200px;
            background: #f6f7f7;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .preview-area h3 {
            margin: 0 0 10px 0;
            color: #1d2327;
        }
        
        .preview-area p {
            margin: 0;
            color: #646970;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .status.success {
            background: #d7f0d7;
            color: #1e4620;
            border: 1px solid #00a32a;
        }
        
        .status.error {
            background: #f7d7d7;
            color: #8a2424;
            border: 1px solid #d63638;
        }
        
        .status.info {
            background: #e5f5fa;
            color: #1d2327;
            border: 1px solid #72aee6;
        }
        
        button {
            padding: 8px 16px;
            background: #2271b1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin: 5px;
        }
        
        button:hover {
            background: #135e96;
        }
        
        .test-results {
            margin-top: 20px;
        }
        
        .test-item {
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #ddd;
            background: #f6f7f7;
        }
        
        .test-item.pass {
            border-left-color: #00a32a;
            background: #d7f0d7;
        }
        
        .test-item.fail {
            border-left-color: #d63638;
            background: #f7d7d7;
        }
        
        /* Simulate admin area */
        #wpbody-content {
            padding: 20px;
            background: white;
            border-radius: 4px;
            min-height: 150px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸŽ¨ Gradient Live Preview Integration Test</h1>
        <p>Testing Task 18: Integration of gradient builder with live preview system</p>
        
        <div class="test-section">
            <h2>Test 1: Module Existence</h2>
            <button onclick="testModuleExistence()">Run Test</button>
            <div id="test1-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 2: Generate Gradient CSS</h2>
            <button onclick="testGenerateGradientCSS()">Run Test</button>
            <div id="test2-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 3: Live Preview Update</h2>
            <p>This test creates a gradient configuration and applies it to the preview area.</p>
            
            <!-- Hidden gradient configuration -->
            <div class="mase-background-config" data-area="dashboard" style="display: none;">
                <input type="checkbox" class="mase-background-enabled" checked>
                <select class="mase-background-type">
                    <option value="gradient" selected>Gradient</option>
                </select>
                <input type="range" class="mase-background-opacity" value="100" min="0" max="100">
                <select class="mase-background-blend-mode">
                    <option value="normal" selected>Normal</option>
                </select>
            </div>
            
            <!-- Gradient controls -->
            <div class="mase-background-gradient-controls" data-type="gradient">
                <select class="mase-gradient-type">
                    <option value="linear" selected>Linear</option>
                    <option value="radial">Radial</option>
                </select>
                <input type="number" class="mase-gradient-angle-input" value="135" min="0" max="360">
                
                <div class="mase-gradient-color-stops" data-area="dashboard">
                    <div class="mase-color-stop" data-index="0">
                        <input type="text" class="mase-color-picker" value="#667eea">
                        <input type="number" class="mase-stop-position" value="0" min="0" max="100">
                    </div>
                    <div class="mase-color-stop" data-index="1">
                        <input type="text" class="mase-color-picker" value="#764ba2">
                        <input type="number" class="mase-stop-position" value="100" min="0" max="100">
                    </div>
                </div>
            </div>
            
            <button onclick="testLivePreviewUpdate()">Apply Gradient</button>
            <button onclick="testLinearGradient()">Test Linear (Sunset)</button>
            <button onclick="testRadialGradient()">Test Radial (Ocean)</button>
            <div id="test3-results" class="test-results"></div>
            
            <div class="preview-area" id="wpbody-content">
                <h3>Preview Area (Dashboard)</h3>
                <p>This simulates the #wpbody-content element. Gradient changes should appear here in real-time.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test 4: Gradient Type Switching</h2>
            <p>Test switching between linear and radial gradients.</p>
            <button onclick="switchToLinear()">Switch to Linear</button>
            <button onclick="switchToRadial()">Switch to Radial</button>
            <div id="test4-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Test Summary</h2>
            <div id="summary" class="status info">
                Click "Run All Tests" to execute all tests.
            </div>
            <button onclick="runAllTests()">Run All Tests</button>
        </div>
    </div>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- WordPress Color Picker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/iris/1.0.7/iris.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wp-color-picker/2.1.2/wp-color-picker.min.js"></script>
    
    <!-- MASE Admin JS -->
    <script src="../assets/js/mase-admin.js"></script>
    
    <!-- MASE Gradient Builder -->
    <script src="../assets/js/modules/mase-gradient-builder.js"></script>
    
    <script>
        // Initialize MASE state
        if (typeof MASE !== 'undefined') {
            MASE.state.livePreviewEnabled = true;
            MASE.livePreview.enabled = true;
            console.log('MASE initialized:', MASE);
        }
        
        function testModuleExistence() {
            const results = document.getElementById('test1-results');
            results.innerHTML = '';
            
            const tests = [
                { name: 'MASE object exists', check: () => typeof MASE !== 'undefined' },
                { name: 'MASE.livePreview exists', check: () => typeof MASE.livePreview !== 'undefined' },
                { name: 'MASE.livePreview.updateBackground exists', check: () => typeof MASE.livePreview.updateBackground === 'function' },
                { name: 'MASE.livePreview.generateGradientCSS exists', check: () => typeof MASE.livePreview.generateGradientCSS === 'function' },
                { name: 'MASE.livePreview.getBackgroundConfig exists', check: () => typeof MASE.livePreview.getBackgroundConfig === 'function' },
                { name: 'MASE.gradientBuilder exists', check: () => typeof MASE.gradientBuilder !== 'undefined' },
                { name: 'MASE.gradientBuilder.getGradientConfig exists', check: () => typeof MASE.gradientBuilder.getGradientConfig === 'function' }
            ];
            
            let passCount = 0;
            tests.forEach(test => {
                const pass = test.check();
                if (pass) passCount++;
                results.innerHTML += `<div class="test-item ${pass ? 'pass' : 'fail'}">
                    ${pass ? 'âœ“' : 'âœ—'} ${test.name}
                </div>`;
            });
            
            results.innerHTML += `<div class="test-item ${passCount === tests.length ? 'pass' : 'fail'}">
                <strong>Result: ${passCount}/${tests.length} tests passed</strong>
            </div>`;
        }
        
        function testGenerateGradientCSS() {
            const results = document.getElementById('test2-results');
            results.innerHTML = '';
            
            // Test linear gradient
            const linearConfig = {
                gradient_type: 'linear',
                gradient_angle: 135,
                gradient_colors: [
                    { color: '#667eea', position: 0 },
                    { color: '#764ba2', position: 100 }
                ]
            };
            
            const linearCSS = MASE.livePreview.generateGradientCSS(linearConfig);
            const linearExpected = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            const linearPass = linearCSS === linearExpected;
            
            results.innerHTML += `<div class="test-item ${linearPass ? 'pass' : 'fail'}">
                ${linearPass ? 'âœ“' : 'âœ—'} Linear gradient: "${linearCSS}"
            </div>`;
            
            // Test radial gradient
            const radialConfig = {
                gradient_type: 'radial',
                gradient_colors: [
                    { color: '#ff6b6b', position: 0 },
                    { color: '#feca57', position: 100 }
                ]
            };
            
            const radialCSS = MASE.livePreview.generateGradientCSS(radialConfig);
            const radialExpected = 'radial-gradient(circle, #ff6b6b 0%, #feca57 100%)';
            const radialPass = radialCSS === radialExpected;
            
            results.innerHTML += `<div class="test-item ${radialPass ? 'pass' : 'fail'}">
                ${radialPass ? 'âœ“' : 'âœ—'} Radial gradient: "${radialCSS}"
            </div>`;
            
            // Test multi-stop gradient
            const multiConfig = {
                gradient_type: 'linear',
                gradient_angle: 90,
                gradient_colors: [
                    { color: '#ff0000', position: 0 },
                    { color: '#00ff00', position: 50 },
                    { color: '#0000ff', position: 100 }
                ]
            };
            
            const multiCSS = MASE.livePreview.generateGradientCSS(multiConfig);
            const multiExpected = 'linear-gradient(90deg, #ff0000 0%, #00ff00 50%, #0000ff 100%)';
            const multiPass = multiCSS === multiExpected;
            
            results.innerHTML += `<div class="test-item ${multiPass ? 'pass' : 'fail'}">
                ${multiPass ? 'âœ“' : 'âœ—'} Multi-stop gradient: "${multiCSS}"
            </div>`;
            
            const allPass = linearPass && radialPass && multiPass;
            results.innerHTML += `<div class="test-item ${allPass ? 'pass' : 'fail'}">
                <strong>Result: ${allPass ? 'All gradient CSS tests passed' : 'Some tests failed'}</strong>
            </div>`;
        }
        
        function testLivePreviewUpdate() {
            const results = document.getElementById('test3-results');
            results.innerHTML = '';
            
            try {
                // Call updateBackground
                MASE.livePreview.updateBackground('dashboard');
                
                // Check if gradient was applied
                const $preview = $('#wpbody-content');
                const bgImage = $preview.css('background-image');
                
                const hasGradient = bgImage.includes('gradient');
                
                results.innerHTML = `<div class="test-item ${hasGradient ? 'pass' : 'fail'}">
                    ${hasGradient ? 'âœ“' : 'âœ—'} Gradient applied to preview area
                </div>`;
                results.innerHTML += `<div class="test-item info">
                    Background: ${bgImage}
                </div>`;
                
            } catch (error) {
                results.innerHTML = `<div class="test-item fail">
                    âœ— Error: ${error.message}
                </div>`;
                console.error('Test error:', error);
            }
        }
        
        function testLinearGradient() {
            // Update gradient configuration
            $('.mase-gradient-type').val('linear');
            $('.mase-gradient-angle-input').val(135);
            
            // Update color stops
            $('.mase-color-stop').eq(0).find('.mase-color-picker').val('#ff6b6b');
            $('.mase-color-stop').eq(0).find('.mase-stop-position').val(0);
            $('.mase-color-stop').eq(1).find('.mase-color-picker').val('#feca57');
            $('.mase-color-stop').eq(1).find('.mase-stop-position').val(100);
            
            // Apply
            MASE.livePreview.updateBackground('dashboard');
            
            $('#test3-results').html('<div class="test-item pass">âœ“ Applied linear sunset gradient</div>');
        }
        
        function testRadialGradient() {
            // Update gradient configuration
            $('.mase-gradient-type').val('radial');
            
            // Update color stops
            $('.mase-color-stop').eq(0).find('.mase-color-picker').val('#667eea');
            $('.mase-color-stop').eq(0).find('.mase-stop-position').val(0);
            $('.mase-color-stop').eq(1).find('.mase-color-picker').val('#764ba2');
            $('.mase-color-stop').eq(1).find('.mase-stop-position').val(100);
            
            // Apply
            MASE.livePreview.updateBackground('dashboard');
            
            $('#test3-results').html('<div class="test-item pass">âœ“ Applied radial ocean gradient</div>');
        }
        
        function switchToLinear() {
            $('.mase-gradient-type').val('linear').trigger('change');
            MASE.livePreview.updateBackground('dashboard');
            $('#test4-results').html('<div class="test-item pass">âœ“ Switched to linear gradient</div>');
        }
        
        function switchToRadial() {
            $('.mase-gradient-type').val('radial').trigger('change');
            MASE.livePreview.updateBackground('dashboard');
            $('#test4-results').html('<div class="test-item pass">âœ“ Switched to radial gradient</div>');
        }
        
        function runAllTests() {
            testModuleExistence();
            setTimeout(() => testGenerateGradientCSS(), 100);
            setTimeout(() => testLivePreviewUpdate(), 200);
            
            setTimeout(() => {
                document.getElementById('summary').innerHTML = '<strong>All tests completed!</strong> Check results above.';
                document.getElementById('summary').className = 'status success';
            }, 500);
        }
        
        // Auto-run tests on load
        setTimeout(() => {
            console.log('Running initial tests...');
            testModuleExistence();
            testGenerateGradientCSS();
        }, 500);
    </script>
</body>
</html>
