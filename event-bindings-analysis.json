{
  "analysis_complete": true,
  "analysis_timestamp": "2025-10-29T00:00:00Z",
  "critical_issues": [
    {
      "selector": "#mase-live-preview-toggle",
      "severity": "CRITICAL",
      "message": "DUPLICATE EVENT HANDLERS - Multiple 'change' event bindings for same element",
      "conflict_type": "Race condition - Multiple handlers executing on same event",
      "impact": "Both handlers execute on every toggle, causing duplicate state updates and potential conflicts",
      "bindings": [
        {
          "file": "assets/js/mase-admin.js",
          "line": 10266,
          "event": "change",
          "init_context": "$(document).ready() -> MASE.init() -> bindEvents()",
          "handler_purpose": "Main live preview toggle handler with full validation and accessibility sync",
          "code_snippet": "$('#mase-live-preview-toggle').on('change', function (e) { ... })",
          "features": [
            "Event validation",
            "State management (MASE.state.livePreviewEnabled)",
            "Accessibility (aria-checked sync)",
            "Live preview bind/unbind",
            "Error handling with try-catch",
            "Debug logging"
          ]
        },
        {
          "file": "assets/js/mase-admin.js",
          "line": 13617,
          "event": "change",
          "init_context": "$(document).ready() - separate initialization block",
          "handler_purpose": "Bind admin menu preview events when toggle changes",
          "code_snippet": "$('#mase-live-preview-toggle').on('change', function () { ... })",
          "features": [
            "State management (MASE.state.livePreviewEnabled)",
            "Calls MASE.bindAdminMenuPreviewEvents()"
          ]
        }
      ],
      "recommendation": "CONSOLIDATE - Merge second handler into first handler or use event delegation",
      "fix_priority": "HIGH",
      "fix_approach": "Add MASE.bindAdminMenuPreviewEvents() call to the main handler at line 10266"
    }
  ],
  "all_bindings": {
    "mase-admin.js": [
      {
        "line": 10266,
        "selector": "#mase-live-preview-toggle",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.init() -> bindEvents()",
        "duplicate": true
      },
      {
        "line": 13617,
        "selector": "#mase-live-preview-toggle",
        "event": "change",
        "init_context": "$(document).ready() - separate block",
        "duplicate": true
      },
      {
        "line": 10232,
        "selector": "#mase-settings-form",
        "event": "submit",
        "init_context": "$(document).ready() -> MASE.init() -> bindEvents()"
      },
      {
        "line": 13645,
        "selector": ".mase-responsive-toggle",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.responsiveVariations.init()"
      },
      {
        "line": 13665,
        "selector": ".mase-breakpoint-tab",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.responsiveVariations.init()"
      }
    ],
    "mase-position-picker.js": [
      {
        "line": 72,
        "selector": ".mase-position-grid-cell",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.positionPicker.init()"
      },
      {
        "line": 98,
        "selector": ".mase-position-x, .mase-position-y",
        "event": "input",
        "init_context": "$(document).ready() -> MASE.positionPicker.init()"
      },
      {
        "line": 126,
        "selector": ".mase-position-x, .mase-position-y",
        "event": "blur",
        "init_context": "$(document).ready() -> MASE.positionPicker.init()"
      }
    ],
    "mase-pattern-library.js": [
      {
        "line": 132,
        "selector": ".mase-pattern-category-filter",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 148,
        "selector": ".mase-pattern-search",
        "event": "input",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 153,
        "selector": ".mase-pattern-item",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 160,
        "selector": ".mase-pattern-color-picker",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 169,
        "selector": ".mase-pattern-opacity-slider",
        "event": "input change",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 186,
        "selector": ".mase-pattern-scale-slider",
        "event": "input change",
        "init_context": "$(document).ready() -> MASE.patternLibrary.init()",
        "delegation": "$(document).on()"
      }
    ],
    "modules/mase-compatibility.js": [
      {
        "line": 232,
        "selector": "document",
        "event": "mase:background-image-set (custom)",
        "init_context": "$(document).ready() -> MASE.compatibility.init()",
        "delegation": "$(document).on()"
      }
    ],
    "modules/mase-gradient-builder.js": [
      {
        "line": 105,
        "selector": ".mase-gradient-type",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()"
      },
      {
        "line": 133,
        "selector": ".mase-gradient-angle-dial",
        "event": "mousedown",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()"
      },
      {
        "line": 148,
        "selector": "document",
        "event": "mousemove.gradient-dial",
        "init_context": "Dynamic - during dial drag",
        "delegation": "$(document).on()"
      },
      {
        "line": 164,
        "selector": "document",
        "event": "mouseup.gradient-dial",
        "init_context": "Dynamic - during dial drag",
        "delegation": "$(document).on()"
      },
      {
        "line": 174,
        "selector": ".mase-gradient-angle-input",
        "event": "input change",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()"
      },
      {
        "line": 206,
        "selector": ".mase-add-color-stop",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 213,
        "selector": ".mase-remove-color-stop",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 241,
        "selector": ".mase-color-stop input",
        "event": "input change",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 548,
        "selector": ".mase-gradient-category-filter",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()"
      },
      {
        "line": 556,
        "selector": ".mase-gradient-preset-item",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 612,
        "selector": ".mase-gradient-preset-item",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.gradientBuilder.init()"
      }
    ],
    "modules/mase-asset-loader.js": [
      {
        "line": 126,
        "selector": "[data-tab=\"backgrounds\"]",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.assetLoader.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 131,
        "selector": ".mase-background-type-select",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.assetLoader.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 141,
        "selector": ".mase-pattern-tab",
        "event": "click",
        "init_context": "$(document).ready() -> MASE.assetLoader.init()",
        "delegation": "$(document).on()"
      }
    ],
    "modules/mase-background-accessibility.js": [
      {
        "line": 267,
        "selector": ".mase-background-upload-zone",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 275,
        "selector": ".mase-position-grid-cell",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 328,
        "selector": ".mase-pattern-item",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 338,
        "selector": ".mase-gradient-preset-item",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 348,
        "selector": ".mase-background-area-toggle",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 356,
        "selector": ".mase-breakpoint-tab",
        "event": "keydown",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 408,
        "selector": "focusable elements",
        "event": "focus",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 411,
        "selector": "focusable elements",
        "event": "blur",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()"
      },
      {
        "line": 424,
        "selector": ".mase-background-type-selector",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()",
        "delegation": "$(document).on()"
      },
      {
        "line": 436,
        "selector": ".mase-background-enable-toggle",
        "event": "change",
        "init_context": "$(document).ready() -> MASE.backgroundAccessibility.init()",
        "delegation": "$(document).on()"
      }
    ]
  },
  "initialization_order": [
    "1. $(document).ready() fires",
    "2. MASE.init() called (line 13598)",
    "3. MASE.bindEvents() called from init()",
    "4. First #mase-live-preview-toggle handler bound (line 10266)",
    "5. MASE.buttonStyler.init() called (if on buttons tab)",
    "6. MASE.backgrounds.init() called (if on backgrounds tab)",
    "7. Second #mase-live-preview-toggle handler bound (line 13617) - DUPLICATE!",
    "8. MASE.responsiveVariations.init() called (separate ready block, line 13959)",
    "9. All module init() functions called from their own ready blocks"
  ],
  "race_condition_analysis": {
    "duplicate_handlers": {
      "selector": "#mase-live-preview-toggle",
      "handler_count": 2,
      "execution_order": "Both handlers execute on every 'change' event",
      "potential_conflicts": [
        "State updates happen twice",
        "MASE.state.livePreviewEnabled set twice",
        "livePreview.bind() called from first handler",
        "bindAdminMenuPreviewEvents() called from second handler",
        "No direct conflict but unnecessary duplication"
      ],
      "performance_impact": "Minimal - both handlers are lightweight",
      "correctness_impact": "Low - handlers don't conflict but duplication is unnecessary"
    }
  },
  "recommendations": {
    "immediate_fix": {
      "action": "Consolidate duplicate handlers",
      "approach": "Add bindAdminMenuPreviewEvents() call to main handler at line 10266",
      "code_change": {
        "file": "assets/js/mase-admin.js",
        "line": 10266,
        "add_after_line": 10340,
        "code_to_add": "// Bind admin menu preview events if available\nif (self.state.livePreviewEnabled && typeof MASE.bindAdminMenuPreviewEvents === 'function') {\n    MASE.bindAdminMenuPreviewEvents();\n}"
      },
      "remove": {
        "file": "assets/js/mase-admin.js",
        "lines": "13617-13622",
        "code_to_remove": "$('#mase-live-preview-toggle').on('change', function () { ... });"
      }
    },
    "verification": {
      "test_steps": [
        "1. Toggle live preview on",
        "2. Check console for duplicate log messages",
        "3. Verify admin menu preview events bind correctly",
        "4. Toggle live preview off",
        "5. Verify only one unbind occurs"
      ]
    }
  },
  "next_step": "Proceed to HTML/CSS analysis to verify selector existence and CSS blocking issues"
}
