<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASE v1.2.0 - Complete Integration Test Suite</title>
    <link rel="stylesheet" href="../../assets/css/mase-admin.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f1;
        }
        
        .test-suite-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .test-header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-header h1 {
            margin: 0 0 10px 0;
            color: #1d2327;
        }
        
        .test-progress {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .progress-item {
            flex: 1;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            text-align: center;
        }
        
        .progress-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .progress-label {
            font-size: 12px;
            color: #646970;
            text-transform: uppercase;
        }
        
        .test-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-section h2 {
            margin: 0 0 15px 0;
            color: #2271b1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .test-status.pending {
            background: #f0f0f1;
            color: #646970;
        }
        
        .test-status.running {
            background: #fcf9e8;
            color: #996800;
        }
        
        .test-status.pass {
            background: #edfaef;
            color: #00a32a;
        }
        
        .test-status.fail {
            background: #fcf0f1;
            color: #d63638;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
            border-left: 4px solid #ddd;
            border-radius: 4px;
        }
        
        .test-item.pass {
            border-left-color: #00a32a;
            background: #edfaef;
        }
        
        .test-item.fail {
            border-left-color: #d63638;
            background: #fcf0f1;
        }
        
        .test-item h4 {
            margin: 0 0 8px 0;
            color: #1d2327;
            font-size: 14px;
        }
        
        .test-item p {
            margin: 0;
            font-size: 13px;
            color: #646970;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button.primary {
            background: #2271b1;
            color: white;
        }
        
        button.primary:hover {
            background: #135e96;
        }
        
        button.secondary {
            background: #f0f0f1;
            color: #1d2327;
        }
        
        button.secondary:hover {
            background: #dcdcde;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .console-output {
            background: #1d2327;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .console-output div {
            margin: 2px 0;
        }
        
        .console-output .error {
            color: #ff6b6b;
        }
        
        .console-output .success {
            color: #46d369;
        }
        
        .console-output .info {
            color: #4a9eff;
        }
        
        /* Mock WordPress Elements */
        #wpadminbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 32px;
            background-color: #23282d;
            z-index: 99999;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }
        
        #wpadminbar .ab-item {
            color: #ffffff;
            text-decoration: none;
            padding: 0 10px;
        }
        
        #adminmenuwrap {
            position: fixed;
            top: 32px;
            left: 0;
            bottom: 0;
            width: 160px;
            background-color: #23282d;
            overflow-y: auto;
            z-index: 9999;
        }
        
        #adminmenu {
            background-color: #23282d;
        }
        
        #adminmenu a {
            display: block;
            color: #ffffff;
            padding: 10px 15px;
            text-decoration: none;
        }
        
        #adminmenu li.menu-top:hover {
            background-color: #191e23;
        }
        
        .test-suite-container {
            margin-left: 160px;
            margin-top: 32px;
        }
    </style>
</head>
<body>
    <!-- Mock WordPress Admin Bar -->
    <div id="wpadminbar">
        <a href="#" class="ab-item">WordPress</a>
        <a href="#" class="ab-item">Dashboard</a>
    </div>
    
    <!-- Mock WordPress Admin Menu -->
    <div id="adminmenuwrap">
        <ul id="adminmenu">
            <li class="menu-top"><a href="#">Dashboard</a></li>
            <li class="menu-top"><a href="#">Settings</a></li>
        </ul>
    </div>
    
    <div class="test-suite-container">
        <div class="test-header">
            <h1>ðŸ§ª MASE v1.2.0 - Integration Test Suite</h1>
            <p>Complete validation of all critical fixes and features</p>
            
            <div class="test-progress">
                <div class="progress-item">
                    <div class="progress-number" id="total-tests">0</div>
                    <div class="progress-label">Total Tests</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number" style="color: #00a32a;" id="passed-tests">0</div>
                    <div class="progress-label">Passed</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number" style="color: #d63638;" id="failed-tests">0</div>
                    <div class="progress-label">Failed</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number" style="color: #996800;" id="pending-tests">0</div>
                    <div class="progress-label">Pending</div>
                </div>
            </div>
            
            <div class="test-controls">
                <button class="primary" id="run-all-tests">Run All Tests</button>
                <button class="secondary" id="run-live-preview">Test Live Preview</button>
                <button class="secondary" id="run-dark-mode">Test Dark Mode</button>
                <button class="secondary" id="run-ajax-save">Test AJAX Save</button>
                <button class="secondary" id="run-tab-nav">Test Tab Navigation</button>
                <button class="secondary" id="clear-results">Clear Results</button>
            </div>
        </div>
        
        <!-- Test Section 9.1: Live Preview -->
        <div class="test-section" id="section-9-1">
            <h2>
                <span>9.1 Live Preview Functionality</span>
                <span class="test-status pending" id="status-9-1">Pending</span>
            </h2>
            <p>Requirements: 1.1, 1.2, 1.3, 1.4, 1.5</p>
            <div id="results-9-1"></div>
        </div>
        
        <!-- Test Section 9.2: Dark Mode -->
        <div class="test-section" id="section-9-2">
            <h2>
                <span>9.2 Dark Mode Functionality</span>
                <span class="test-status pending" id="status-9-2">Pending</span>
            </h2>
            <p>Requirements: 3.1, 3.2, 3.3, 3.4, 3.5</p>
            <div id="results-9-2"></div>
        </div>
        
        <!-- Test Section 9.3: Settings Save -->
        <div class="test-section" id="section-9-3">
            <h2>
                <span>9.3 Settings Save Functionality</span>
                <span class="test-status pending" id="status-9-3">Pending</span>
            </h2>
            <p>Requirements: 5.1, 5.2, 5.3, 5.4, 5.5</p>
            <div id="results-9-3"></div>
        </div>
        
        <!-- Test Section 9.4: Tab Navigation -->
        <div class="test-section" id="section-9-4">
            <h2>
                <span>9.4 Tab Navigation</span>
                <span class="test-status pending" id="status-9-4">Pending</span>
            </h2>
            <p>Requirements: 8.1, 8.2, 8.3, 8.4, 8.5</p>
            <div id="results-9-4"></div>
        </div>
        
        <!-- Test Section 9.5: Card Layout Responsiveness -->
        <div class="test-section" id="section-9-5">
            <h2>
                <span>9.5 Card Layout Responsiveness</span>
                <span class="test-status pending" id="status-9-5">Pending</span>
            </h2>
            <p>Requirements: 2.1, 2.2, 2.3, 2.4, 2.5</p>
            <div id="results-9-5"></div>
        </div>
        
        <!-- Test Section 9.6: Cross-Browser Compatibility -->
        <div class="test-section" id="section-9-6">
            <h2>
                <span>9.6 Cross-Browser Compatibility</span>
                <span class="test-status pending" id="status-9-6">Pending</span>
            </h2>
            <p>Requirements: All</p>
            <div id="results-9-6"></div>
        </div>
        
        <!-- Test Section 9.7: Error Handling -->
        <div class="test-section" id="section-9-7">
            <h2>
                <span>9.7 Error Handling</span>
                <span class="test-status pending" id="status-9-7">Pending</span>
            </h2>
            <p>Requirements: 5.4, 9.5</p>
            <div id="results-9-7"></div>
        </div>
        
        <!-- Console Output -->
        <div class="test-section">
            <h2>Console Output</h2>
            <div class="console-output" id="console-output"></div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../assets/js/mase-admin.js"></script>
    <script>
        (function($) {
            'use strict';
            
            // Test Suite State
            const testSuite = {
                totalTests: 0,
                passedTests: 0,
                failedTests: 0,
                pendingTests: 0,
                results: []
            };
            
            // Console logging
            const originalLog = console.log;
            const originalError = console.error;
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                logToConsole('info', args.join(' '));
            };
            
            console.error = function(...args) {
                originalError.apply(console, args);
                logToConsole('error', args.join(' '));
            };
            
            function logToConsole(type, message) {
                const $output = $('#console-output');
                const timestamp = new Date().toLocaleTimeString();
                const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
                $output.append(`<div class="${className}">[${timestamp}] ${message}</div>`);
                $output.scrollTop($output[0].scrollHeight);
            }
            
            function updateProgress() {
                $('#total-tests').text(testSuite.totalTests);
                $('#passed-tests').text(testSuite.passedTests);
                $('#failed-tests').text(testSuite.failedTests);
                $('#pending-tests').text(testSuite.pendingTests);
            }
            
            function updateSectionStatus(sectionId, status) {
                $(`#status-${sectionId}`).removeClass('pending running pass fail').addClass(status).text(status.toUpperCase());
            }
            
            function addTestResult(sectionId, testName, passed, message) {
                const $results = $(`#results-${sectionId}`);
                const $item = $('<div>').addClass('test-item').addClass(passed ? 'pass' : 'fail');
                $item.append(`<h4>${passed ? 'âœ“' : 'âœ—'} ${testName}</h4>`);
                $item.append(`<p>${message}</p>`);
                $results.append($item);
                
                testSuite.totalTests++;
                if (passed) {
                    testSuite.passedTests++;
                } else {
                    testSuite.failedTests++;
                }
                updateProgress();
                
                return passed;
            }
            
            // Test 9.1: Live Preview Functionality
            async function test_9_1_LivePreview() {
                console.log('=== Starting Test 9.1: Live Preview ===');
                updateSectionStatus('9-1', 'running');
                
                let allPassed = true;
                
                // Test 1.1: Check if live preview toggle exists
                const hasToggle = $('#mase-live-preview-toggle').length > 0;
                allPassed &= addTestResult('9-1', 'Live preview toggle exists', hasToggle, 
                    hasToggle ? 'Toggle element found' : 'Toggle element not found');
                
                // Test 1.2: Check if MASE object exists
                const hasMASE = typeof MASE !== 'undefined';
                allPassed &= addTestResult('9-1', 'MASE object exists', hasMASE,
                    hasMASE ? 'MASE object is defined' : 'MASE object not found');
                
                // Test 1.3: Check if live preview methods exist
                if (hasMASE) {
                    const hasToggleMethod = typeof MASE.toggleLivePreview === 'function';
                    allPassed &= addTestResult('9-1', 'toggleLivePreview() method exists', hasToggleMethod,
                        hasToggleMethod ? 'Method is defined' : 'Method not found');
                    
                    const hasUpdateMethod = typeof MASE.updateLivePreview === 'function';
                    allPassed &= addTestResult('9-1', 'updateLivePreview() method exists', hasUpdateMethod,
                        hasUpdateMethod ? 'Method is defined' : 'Method not found');
                }
                
                updateSectionStatus('9-1', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.1 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.2: Dark Mode Functionality
            async function test_9_2_DarkMode() {
                console.log('=== Starting Test 9.2: Dark Mode ===');
                updateSectionStatus('9-2', 'running');
                
                let allPassed = true;
                
                // Test 3.1: Check if dark mode toggle exists
                const hasToggle = $('#master-dark-mode').length > 0;
                allPassed &= addTestResult('9-2', 'Dark mode toggle exists', hasToggle,
                    hasToggle ? 'Toggle element found' : 'Toggle element not found');
                
                // Test 3.2: Check if dark mode method exists
                const hasMethod = typeof MASE !== 'undefined' && typeof MASE.toggleDarkMode === 'function';
                allPassed &= addTestResult('9-2', 'toggleDarkMode() method exists', hasMethod,
                    hasMethod ? 'Method is defined' : 'Method not found');
                
                // Test 3.3: Test dark mode toggle
                if (hasToggle && hasMethod) {
                    $('#master-dark-mode').prop('checked', true).trigger('change');
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const hasAttribute = document.documentElement.hasAttribute('data-theme');
                    const attributeValue = document.documentElement.getAttribute('data-theme');
                    allPassed &= addTestResult('9-2', 'data-theme attribute set', hasAttribute && attributeValue === 'dark',
                        `data-theme="${attributeValue}"`);
                    
                    // Test 3.4: Check localStorage
                    const storedValue = localStorage.getItem('mase_dark_mode');
                    allPassed &= addTestResult('9-2', 'localStorage persistence', storedValue === 'true',
                        `localStorage value: ${storedValue}`);
                    
                    // Clean up
                    $('#master-dark-mode').prop('checked', false).trigger('change');
                }
                
                updateSectionStatus('9-2', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.2 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.3: Settings Save Functionality
            async function test_9_3_SettingsSave() {
                console.log('=== Starting Test 9.3: Settings Save ===');
                updateSectionStatus('9-3', 'running');
                
                let allPassed = true;
                
                // Test 5.1: Check if save button exists
                const hasButton = $('#mase-save-settings').length > 0;
                allPassed &= addTestResult('9-3', 'Save button exists', hasButton,
                    hasButton ? 'Button element found' : 'Button element not found');
                
                // Test 5.2: Check if save method exists
                const hasMethod = typeof MASE !== 'undefined' && typeof MASE.saveSettings === 'function';
                allPassed &= addTestResult('9-3', 'saveSettings() method exists', hasMethod,
                    hasMethod ? 'Method is defined' : 'Method not found');
                
                // Test 5.3: Check if showNotice method exists
                const hasNoticeMethod = typeof MASE !== 'undefined' && typeof MASE.showNotice === 'function';
                allPassed &= addTestResult('9-3', 'showNotice() method exists', hasNoticeMethod,
                    hasNoticeMethod ? 'Method is defined' : 'Method not found');
                
                // Test 5.4: Check AJAX configuration
                if (typeof MASE !== 'undefined' && MASE.config) {
                    const hasAjaxUrl = MASE.config.ajaxUrl && MASE.config.ajaxUrl.length > 0;
                    const hasNonce = MASE.config.nonce && MASE.config.nonce.length > 0;
                    allPassed &= addTestResult('9-3', 'AJAX configuration', hasAjaxUrl && hasNonce,
                        `ajaxUrl: ${hasAjaxUrl}, nonce: ${hasNonce}`);
                }
                
                updateSectionStatus('9-3', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.3 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.4: Tab Navigation
            async function test_9_4_TabNavigation() {
                console.log('=== Starting Test 9.4: Tab Navigation ===');
                updateSectionStatus('9-4', 'running');
                
                let allPassed = true;
                
                // Test 8.1: Check if tab buttons exist
                const hasTabs = $('.mase-tab').length > 0;
                allPassed &= addTestResult('9-4', 'Tab buttons exist', hasTabs,
                    hasTabs ? `Found ${$('.mase-tab').length} tabs` : 'No tabs found');
                
                // Test 8.2: Check if switchTab method exists
                const hasMethod = typeof MASE !== 'undefined' && typeof MASE.switchTab === 'function';
                allPassed &= addTestResult('9-4', 'switchTab() method exists', hasMethod,
                    hasMethod ? 'Method is defined' : 'Method not found');
                
                // Test 8.3: Check localStorage for active tab
                const hasLocalStorage = typeof localStorage !== 'undefined';
                allPassed &= addTestResult('9-4', 'localStorage available', hasLocalStorage,
                    hasLocalStorage ? 'localStorage is supported' : 'localStorage not available');
                
                updateSectionStatus('9-4', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.4 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.5: Card Layout Responsiveness
            async function test_9_5_CardLayout() {
                console.log('=== Starting Test 9.5: Card Layout ===');
                updateSectionStatus('9-5', 'running');
                
                let allPassed = true;
                
                // Test 2.1: Check if card elements exist
                const hasCards = $('.mase-section-card').length > 0;
                allPassed &= addTestResult('9-5', 'Card elements exist', hasCards,
                    hasCards ? `Found ${$('.mase-section-card').length} cards` : 'No cards found');
                
                // Test 2.2: Check if setting rows exist
                const hasRows = $('.mase-setting-row').length > 0;
                allPassed &= addTestResult('9-5', 'Setting rows exist', hasRows,
                    hasRows ? `Found ${$('.mase-setting-row').length} rows` : 'No rows found');
                
                // Test 2.3: Check CSS grid layout
                if (hasRows) {
                    const $row = $('.mase-setting-row').first();
                    const display = $row.css('display');
                    const isGrid = display === 'grid';
                    allPassed &= addTestResult('9-5', 'Grid layout applied', isGrid,
                        `display: ${display}`);
                }
                
                updateSectionStatus('9-5', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.5 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.6: Cross-Browser Compatibility
            async function test_9_6_CrossBrowser() {
                console.log('=== Starting Test 9.6: Cross-Browser ===');
                updateSectionStatus('9-6', 'running');
                
                let allPassed = true;
                
                // Test browser features
                const hasLocalStorage = typeof localStorage !== 'undefined';
                allPassed &= addTestResult('9-6', 'localStorage support', hasLocalStorage,
                    hasLocalStorage ? 'localStorage is supported' : 'localStorage not available');
                
                const hasCSSVariables = CSS.supports('color', 'var(--test)');
                allPassed &= addTestResult('9-6', 'CSS variables support', hasCSSVariables,
                    hasCSSVariables ? 'CSS custom properties supported' : 'CSS variables not supported');
                
                const hasJQuery = typeof jQuery !== 'undefined';
                allPassed &= addTestResult('9-6', 'jQuery loaded', hasJQuery,
                    hasJQuery ? `jQuery ${jQuery.fn.jquery}` : 'jQuery not loaded');
                
                updateSectionStatus('9-6', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.6 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Test 9.7: Error Handling
            async function test_9_7_ErrorHandling() {
                console.log('=== Starting Test 9.7: Error Handling ===');
                updateSectionStatus('9-7', 'running');
                
                let allPassed = true;
                
                // Test error handling methods
                const hasShowNotice = typeof MASE !== 'undefined' && typeof MASE.showNotice === 'function';
                allPassed &= addTestResult('9-7', 'Error notification method exists', hasShowNotice,
                    hasShowNotice ? 'showNotice() method available' : 'Method not found');
                
                // Test console error logging
                const hasConsoleError = typeof console.error === 'function';
                allPassed &= addTestResult('9-7', 'Console error logging', hasConsoleError,
                    hasConsoleError ? 'console.error() available' : 'console.error() not available');
                
                updateSectionStatus('9-7', allPassed ? 'pass' : 'fail');
                console.log(`Test 9.7 completed: ${allPassed ? 'PASS' : 'FAIL'}`);
            }
            
            // Run all tests
            async function runAllTests() {
                console.log('========================================');
                console.log('MASE v1.2.0 Integration Test Suite');
                console.log('========================================');
                
                // Reset counters
                testSuite.totalTests = 0;
                testSuite.passedTests = 0;
                testSuite.failedTests = 0;
                testSuite.pendingTests = 0;
                updateProgress();
                
                // Clear previous results
                $('.test-section [id^="results-"]').empty();
                
                // Run all tests
                await test_9_1_LivePreview();
                await test_9_2_DarkMode();
                await test_9_3_SettingsSave();
                await test_9_4_TabNavigation();
                await test_9_5_CardLayout();
                await test_9_6_CrossBrowser();
                await test_9_7_ErrorHandling();
                
                console.log('========================================');
                console.log(`All tests completed: ${testSuite.passedTests}/${testSuite.totalTests} passed`);
                console.log('========================================');
                
                logToConsole('success', `âœ“ Test suite completed: ${testSuite.passedTests}/${testSuite.totalTests} passed`);
            }
            
            // Event handlers
            $('#run-all-tests').on('click', runAllTests);
            $('#run-live-preview').on('click', test_9_1_LivePreview);
            $('#run-dark-mode').on('click', test_9_2_DarkMode);
            $('#run-ajax-save').on('click', test_9_3_SettingsSave);
            $('#run-tab-nav').on('click', test_9_4_TabNavigation);
            
            $('#clear-results').on('click', function() {
                $('.test-section [id^="results-"]').empty();
                $('.test-status').removeClass('running pass fail').addClass('pending').text('PENDING');
                testSuite.totalTests = 0;
                testSuite.passedTests = 0;
                testSuite.failedTests = 0;
                testSuite.pendingTests = 0;
                updateProgress();
                $('#console-output').empty();
                console.log('Test results cleared');
            });
            
            // Initialize
            $(document).ready(function() {
                console.log('Integration Test Suite initialized');
                console.log('Click "Run All Tests" to begin testing');
                updateProgress();
            });
            
        })(jQuery);
    </script>
</body>
</html>
