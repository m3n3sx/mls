<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 10: Live Preview Enabled by Default - Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            padding: 20px;
            background: #f0f0f1;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1d2327;
            border-bottom: 2px solid #0073aa;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #0073aa;
        }
        .test-section h2 {
            margin-top: 0;
            color: #0073aa;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-result.pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .checkbox-demo {
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 20px 0;
        }
        .mase-header-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #0073aa;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .mase-header-toggle input[type="checkbox"] {
            margin: 0;
        }
        .console-output {
            background: #1d2327;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .console-output div {
            margin: 5px 0;
        }
        button {
            background: #0073aa;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        .color-picker-demo {
            margin: 20px 0;
        }
        .color-picker-demo input[type="color"] {
            width: 100px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        #admin-bar-preview {
            background: #23282d;
            color: white;
            padding: 10px 20px;
            margin: 20px 0;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Task 10: Live Preview Enabled by Default - Test Suite</h1>
        <p><strong>Requirements:</strong> 10.1, 10.2, 10.3, 10.4, 10.5</p>
        
        <div class="test-section">
            <h2>Test 1: HTML Checkbox Default State (Requirement 10.1, 10.2, 10.3)</h2>
            <div class="checkbox-demo">
                <label class="mase-header-toggle">
                    <input 
                        type="checkbox" 
                        id="mase-live-preview-toggle"
                        name="mase_live_preview" 
                        value="1"
                        checked
                        role="switch"
                        aria-checked="true"
                        aria-label="Toggle live preview mode"
                    />
                    <span>Live Preview</span>
                </label>
            </div>
            <div id="test1-results"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: JavaScript Initialization (Requirement 10.4, 10.5)</h2>
            <div id="test2-results"></div>
            <div class="console-output" id="console-output"></div>
        </div>

        <div class="test-section">
            <h2>Test 3: Live Preview Functionality (Requirement 10.1, 10.2, 10.3)</h2>
            <p>Change the color below without clicking the toggle. The preview should update immediately.</p>
            <div class="color-picker-demo">
                <label>
                    Admin Bar Background Color:
                    <input type="color" id="admin-bar-bg-color" value="#23282d">
                </label>
            </div>
            <div id="admin-bar-preview">
                Admin Bar Preview - This should change color when you adjust the color picker above
            </div>
            <div id="test3-results"></div>
        </div>

        <div class="test-section">
            <h2>Test 4: Toggle Disable/Enable (Requirement 10.1, 10.2, 10.3)</h2>
            <button id="test-disable-toggle">Uncheck Toggle</button>
            <button id="test-enable-toggle">Check Toggle</button>
            <button id="test-reload-simulation">Simulate Page Reload</button>
            <div id="test4-results"></div>
        </div>

        <div class="test-section">
            <h2>Test Summary</h2>
            <div id="test-summary"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock MASE Admin object for testing
        var MASE = {
            config: {
                livePreviewEnabled: false
            },
            state: {
                livePreviewEnabled: false
            },
            init: function() {
                // Simulate the init() method from mase-admin.js
                console.log('MASE Admin initializing...');
                console.log('MASE: Version 1.2.0');
                
                // Enable live preview by default (Requirement 10.1, 10.2, 10.4, 10.5)
                console.log('MASE: Enabling live preview by default...');
                this.state.livePreviewEnabled = true;
                
                // Ensure checkbox is checked programmatically
                $('#mase-live-preview-toggle')
                    .prop('checked', true)
                    .attr('aria-checked', 'true');
                
                console.log('MASE: Live Preview enabled by default');
                
                console.log('MASE Admin initialization complete!');
                console.log('MASE: Current state:', this.state);
            }
        };

        // Console output capture
        var consoleOutput = [];
        var originalLog = console.log;
        console.log = function() {
            var message = Array.prototype.slice.call(arguments).join(' ');
            consoleOutput.push(message);
            $('#console-output').append('<div>' + message + '</div>');
            originalLog.apply(console, arguments);
        };

        // Test results tracking
        var testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        function addTestResult(containerId, testName, passed, message) {
            testResults.total++;
            if (passed) {
                testResults.passed++;
                $('#' + containerId).append(
                    '<div class="test-result pass">✓ ' + testName + ': ' + message + '</div>'
                );
            } else {
                testResults.failed++;
                $('#' + containerId).append(
                    '<div class="test-result fail">✗ ' + testName + ': ' + message + '</div>'
                );
            }
            updateSummary();
        }

        function addInfoResult(containerId, message) {
            $('#' + containerId).append(
                '<div class="test-result info">ℹ ' + message + '</div>'
            );
        }

        function updateSummary() {
            var percentage = testResults.total > 0 ? 
                Math.round((testResults.passed / testResults.total) * 100) : 0;
            
            $('#test-summary').html(
                '<h3>Results: ' + testResults.passed + '/' + testResults.total + ' tests passed (' + percentage + '%)</h3>' +
                '<p>Passed: ' + testResults.passed + ' | Failed: ' + testResults.failed + '</p>'
            );
        }

        $(document).ready(function() {
            // Test 1: HTML Checkbox Default State
            var checkbox = $('#mase-live-preview-toggle');
            var isChecked = checkbox.is(':checked');
            var hasCheckedAttr = checkbox.attr('checked') !== undefined;
            var ariaChecked = checkbox.attr('aria-checked');
            var hasRole = checkbox.attr('role') === 'switch';

            addTestResult('test1-results', 'Checkbox is checked', isChecked, 
                isChecked ? 'Checkbox is checked by default' : 'Checkbox is NOT checked');
            
            addTestResult('test1-results', 'Has checked attribute', hasCheckedAttr, 
                hasCheckedAttr ? 'checked attribute is present' : 'checked attribute is missing');
            
            addTestResult('test1-results', 'ARIA checked is true', ariaChecked === 'true', 
                'aria-checked="' + ariaChecked + '"');
            
            addTestResult('test1-results', 'Has role="switch"', hasRole, 
                hasRole ? 'role="switch" is present' : 'role="switch" is missing');

            // Test 2: JavaScript Initialization
            MASE.init();
            
            setTimeout(function() {
                var stateEnabled = MASE.state.livePreviewEnabled === true;
                var checkboxStillChecked = $('#mase-live-preview-toggle').is(':checked');
                var ariaUpdated = $('#mase-live-preview-toggle').attr('aria-checked') === 'true';
                var hasDefaultLog = consoleOutput.some(function(log) {
                    return log.includes('Live Preview enabled by default');
                });

                addTestResult('test2-results', 'State is enabled', stateEnabled, 
                    'livePreviewEnabled = ' + MASE.state.livePreviewEnabled);
                
                addTestResult('test2-results', 'Checkbox programmatically checked', checkboxStillChecked, 
                    checkboxStillChecked ? 'jQuery .prop("checked", true) worked' : 'Checkbox not checked');
                
                addTestResult('test2-results', 'ARIA attribute updated', ariaUpdated, 
                    'aria-checked updated to "true"');
                
                addTestResult('test2-results', 'Console log present', hasDefaultLog, 
                    hasDefaultLog ? 'Found "Live Preview enabled by default" in console' : 'Log message not found');
            }, 100);

            // Test 3: Live Preview Functionality
            var colorChangeDetected = false;
            $('#admin-bar-bg-color').on('input', function() {
                var color = $(this).val();
                $('#admin-bar-preview').css('background-color', color);
                colorChangeDetected = true;
                
                addInfoResult('test3-results', 'Color changed to: ' + color);
            });

            setTimeout(function() {
                // Trigger a color change programmatically
                $('#admin-bar-bg-color').val('#0073aa').trigger('input');
                
                setTimeout(function() {
                    var previewColor = $('#admin-bar-preview').css('background-color');
                    var expectedRgb = 'rgb(0, 115, 170)'; // #0073aa in RGB
                    
                    addTestResult('test3-results', 'Live preview updates immediately', 
                        previewColor === expectedRgb, 
                        'Preview color: ' + previewColor);
                }, 200);
            }, 500);

            // Test 4: Toggle Disable/Enable
            $('#test-disable-toggle').on('click', function() {
                $('#mase-live-preview-toggle').prop('checked', false).attr('aria-checked', 'false');
                MASE.state.livePreviewEnabled = false;
                addInfoResult('test4-results', 'Toggle unchecked - live preview should stop');
            });

            $('#test-enable-toggle').on('click', function() {
                $('#mase-live-preview-toggle').prop('checked', true).attr('aria-checked', 'true');
                MASE.state.livePreviewEnabled = true;
                addInfoResult('test4-results', 'Toggle checked - live preview should resume');
            });

            $('#test-reload-simulation').on('click', function() {
                // Simulate page reload by re-running init
                consoleOutput = [];
                $('#console-output').html('');
                MASE.init();
                
                var isCheckedAfterReload = $('#mase-live-preview-toggle').is(':checked');
                addTestResult('test4-results', 'Live preview enabled after reload', 
                    isCheckedAfterReload, 
                    isCheckedAfterReload ? 'Checkbox is checked after simulated reload' : 'Checkbox is NOT checked');
            });

            // Monitor toggle changes
            $('#mase-live-preview-toggle').on('change', function() {
                var isChecked = $(this).is(':checked');
                console.log('MASE: Live preview toggle changed to:', isChecked);
                MASE.state.livePreviewEnabled = isChecked;
            });
        });
    </script>
</body>
</html>
