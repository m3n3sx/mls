{
  "plugin_info": {
    "name": "Modern Admin Styler Enterprise (MASE)",
    "version": "1.2.2",
    "description": "Enterprise-grade WordPress admin styling plugin with clean, maintainable architecture",
    "main_file": "modern-admin-styler.php",
    "requires_wp": "5.0",
    "requires_php": "7.4",
    "text_domain": "modern-admin-styler",
    "last_updated": "2025-10-29"
  },
  
  "php_files": {
    "core_classes": [
      {
        "file": "includes/class-mase-admin.php",
        "class": "MASE_Admin",
        "purpose": "Admin interface, asset enqueuing, AJAX handlers",
        "lines": 5417,
        "key_methods": [
          "enqueue_assets($hook) - Enqueues CSS/JS with dependencies, conditional loading",
          "handle_ajax_save_settings() - Main settings save handler with validation",
          "ajax_apply_palette() - Palette application without full validation",
          "ajax_apply_template() - Template application without full validation",
          "inject_custom_css() - Injects generated CSS into admin head with caching"
        ],
        "dependencies": ["MASE_Settings", "MASE_CSS_Generator", "MASE_CacheManager"],
        "recent_changes": [
          {
            "line": 698,
            "change": "Added admin bar visibility fix for settings page",
            "date": "2025-10-29",
            "reason": "Admin bar sometimes hidden by WordPress on certain admin pages"
          }
        ]
      },
      {
        "file": "includes/class-mase-settings.php",
        "class": "MASE_Settings",
        "purpose": "Settings storage, retrieval, validation, defaults",
        "lines": 7881,
        "key_methods": [
          "get_option() - Retrieves settings with defaults",
          "update_option() - Saves settings with full validation",
          "get_defaults() - Returns default settings structure",
          "validate() - Validates settings before save",
          "get_all_palettes() - Returns all color palettes",
          "get_all_templates() - Returns all templates",
          "get_gradient_presets() - Returns gradient presets library",
          "get_pattern_library() - Returns pattern library data",
          "get_google_font_url() - Generates Google Fonts URL",
          "preload_google_fonts() - Generates preload links for fonts"
        ],
        "option_name": "mase_settings",
        "note": "Palette/template functions bypass full validation for performance"
      },
      {
        "file": "includes/class-mase-css-generator.php",
        "class": "MASE_CSS_Generator",
        "purpose": "Generates CSS from settings with mode-specific caching",
        "lines": 7892,
        "key_methods": [
          "generate() - Main CSS generation with mode-specific caching",
          "generate_admin_bar_css() - Admin bar styles",
          "generate_admin_menu_css() - Admin menu styles (fixed background stacking)",
          "generate_glassmorphism_css() - Glassmorphism effects (fixed background stacking)",
          "generate_gradient_background() - Gradient backgrounds"
        ],
        "performance_target": "<100ms generation time",
        "recent_fixes": [
          {
            "method": "generate_admin_menu_css()",
            "issue": "Background color stacking (3 layers = 3x darker)",
            "fix": "Apply background only to #adminmenuback, not all three layers",
            "requirements": ["6.1", "6.2", "6.4", "6.5", "12.1", "12.2", "12.3"]
          }
        ]
      },
      {
        "file": "includes/class-mase-cache.php",
        "class": "MASE_Cache",
        "purpose": "CSS caching using WordPress transients",
        "key_methods": [
          "get_cached_light_mode_css() - Light mode cache",
          "get_cached_dark_mode_css() - Dark mode cache",
          "set_cached_light_mode_css() - Cache light mode",
          "set_cached_dark_mode_css() - Cache dark mode",
          "invalidate_all_caches() - Clear all caches"
        ],
        "cache_keys": [
          "mase_generated_css_light_v1.3.0",
          "mase_generated_css_dark_v1.3.0",
          "mase_login_css",
          "mase_button_css",
          "mase_generated_css"
        ]
      },
      {
        "file": "includes/class-mase-cachemanager.php",
        "class": "MASE_CacheManager",
        "purpose": "Static cache management wrapper",
        "note": "Provides static methods wrapping MASE_Cache"
      },
      {
        "file": "includes/class-mase-migration.php",
        "class": "MASE_Migration",
        "purpose": "Version migration and upgrade handling",
        "note": "Loaded early in modern-admin-styler.php"
      },
      {
        "file": "includes/class-mase-background-migration.php",
        "class": "MASE_Background_Migration",
        "purpose": "Background system migration",
        "note": "Loaded early in modern-admin-styler.php"
      },
      {
        "file": "includes/class-mase-mobile-optimizer.php",
        "class": "MASE_Mobile_Optimizer",
        "purpose": "Mobile device optimization and detection",
        "note": "Loaded early in modern-admin-styler.php"
      },
      {
        "file": "includes/class-mase-rest-api.php",
        "class": "MASE_REST_API",
        "purpose": "REST API endpoints for modern architecture",
        "endpoints": [
          "/mase/v1/settings",
          "/mase/v1/templates",
          "/mase/v1/palettes"
        ]
      }
    ],
    
    "template_files": [
      {
        "file": "includes/admin-settings-page.php",
        "purpose": "Main admin settings page HTML template",
        "lines": 5972,
        "tabs": [
          "General - Palettes, Templates, Master Controls",
          "Admin Bar - Colors, Typography, Visual Effects",
          "Menu - Colors, Typography, Visual Effects",
          "Content - Background, Spacing, Layout",
          "Typography - Font controls for all areas",
          "Dashboard Widgets - Widget customization",
          "Form Controls - Input field styling",
          "Effects - Animations, Hover, Visual Effects",
          "Universal Buttons - Button styling system",
          "Backgrounds - Advanced background system",
          "Templates - Full template gallery",
          "Login Page - Login customization",
          "Advanced - Custom CSS/JS, Backup"
        ]
      },
      "includes/backgrounds-tab-content.php",
      "includes/form-controls-tab-content.php",
      "includes/login-tab-section.php",
      "includes/universal-buttons-tab-content.php",
      "includes/visual-effects-section.php",
      "includes/widgets-tab-content.php",
      "includes/templates/content-tab.php"
    ]
  },
  
  "js_files": {
    "main_scripts": [
      {
        "file": "assets/js/mase-admin.js",
        "purpose": "Main admin interface JavaScript with live preview",
        "dependencies": ["jquery", "wp-color-picker", "mase-asset-loader"],
        "enqueue_priority": "Loads after asset loader",
        "key_modules": [
          "MASE.livePreview - Live preview functionality (integrated, not separate file)",
          "MASE.darkMode - Dark mode toggle",
          "MASE.palettes - Palette management",
          "MASE.templates - Template management",
          "MASE.settings - Settings save/load"
        ],
        "localized_data": ["maseAdmin", "maseL10n"],
        "inline_scripts": [
          {
            "name": "dark_mode_fouc_prevention",
            "position": "before",
            "purpose": "Prevent Flash of Unstyled Content by checking localStorage synchronously",
            "execution_time": "<50ms",
            "requirements": ["12.1", "12.2", "12.3", "12.4"]
          }
        ],
        "note": "Live preview is NOT a separate file - it's integrated into mase-admin.js"
      },
      {
        "file": "assets/js/mase-accessibility.js",
        "purpose": "Accessibility features (WCAG 2.1 AA compliance)",
        "dependencies": ["jquery"],
        "features": [
          "Keyboard navigation",
          "Focus indicators",
          "Screen reader announcements",
          "ARIA attributes"
        ]
      },
      {
        "file": "assets/js/mase-pattern-library.js",
        "purpose": "Pattern library for backgrounds",
        "dependencies": ["jquery", "mase-admin", "mase-asset-loader"],
        "localized_data": "masePatternLibrary"
      },
      {
        "file": "assets/js/mase-position-picker.js",
        "purpose": "Background position picker UI",
        "dependencies": ["jquery", "mase-admin", "mase-asset-loader"]
      }
    ],
    
    "modules": [
      {
        "file": "assets/js/modules/mase-asset-loader.js",
        "purpose": "Lazy loading and performance utilities",
        "note": "MUST load FIRST - provides debounce/throttle utilities",
        "dependencies": ["jquery"],
        "enqueue_priority": "First script loaded"
      },
      {
        "file": "assets/js/modules/mase-gradient-builder.js",
        "purpose": "Gradient builder UI",
        "dependencies": ["jquery", "wp-color-picker", "mase-admin", "mase-asset-loader"],
        "loading": "On-demand when gradient tab active"
      },
      {
        "file": "assets/js/modules/mase-compatibility.js",
        "purpose": "Browser feature detection and fallbacks",
        "dependencies": ["jquery"],
        "note": "Loads early for feature detection"
      },
      {
        "file": "assets/js/modules/mase-error-recovery.js",
        "purpose": "Error recovery mechanisms",
        "dependencies": ["jquery", "mase-admin"],
        "note": "Sets up global error handlers"
      },
      {
        "file": "assets/js/modules/mase-background-accessibility.js",
        "purpose": "Background system accessibility",
        "dependencies": ["jquery", "mase-admin", "mase-gradient-builder", "mase-pattern-library", "mase-position-picker"]
      },
      "assets/js/modules/event-bus.js",
      "assets/js/modules/state-manager.js",
      "assets/js/modules/palette-manager.js",
      "assets/js/modules/template-manager.js",
      "assets/js/modules/preview-engine.js",
      "assets/js/modules/animations.js",
      "assets/js/modules/animation-timeline.js",
      "assets/js/modules/animation-presets.js",
      "assets/js/modules/color-system.js",
      "assets/js/modules/typography.js",
      "assets/js/modules/api-client.js",
      "assets/js/modules/ai-suggestions.js",
      "assets/js/modules/event-adapter.js",
      "assets/js/modules/main-admin.js",
      "assets/js/modules/index.js"
    ]
  },
  
  "css_files": {
    "main_stylesheets": [
      {
        "file": "assets/css/mase-admin.css",
        "purpose": "Main admin interface styles",
        "dependencies": ["wp-color-picker"],
        "note": "Base stylesheet for settings page",
        "inline_styles": [
          {
            "id": "dashicons-pointer-fix",
            "purpose": "Fix dashicons blocking toggle clicks with pointer-events: none",
            "critical": true,
            "requirements": ["1.1-1.5", "4.1-4.5"]
          }
        ]
      },
      {
        "file": "assets/css/mase-palettes.css",
        "purpose": "Palette gallery styles",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-templates.css",
        "purpose": "Template gallery styles",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-accessibility.css",
        "purpose": "Accessibility enhancements",
        "dependencies": ["mase-admin"],
        "features": [
          "Focus indicators",
          "High contrast support",
          "Screen reader utilities"
        ]
      },
      {
        "file": "assets/css/mase-responsive.css",
        "purpose": "Responsive design styles",
        "dependencies": ["mase-admin"],
        "breakpoints": [
          "Mobile: <768px",
          "Tablet": 768-1024px",
          "Desktop: >1024px"
        ]
      },
      {
        "file": "assets/css/mase-pattern-library.css",
        "purpose": "Pattern library UI styles"
      },
      {
        "file": "assets/css/mase-animation-editor.css",
        "purpose": "Animation editor UI styles"
      }
    ]
  },
  
  "test_files": {
    "e2e_tests": [
      {
        "directory": "tests/e2e",
        "framework": "Playwright",
        "files": [
          "comprehensive-functionality-test.spec.js",
          "quick-smoke-test.spec.js"
        ],
        "config": "playwright.config.js",
        "auth": "tests/e2e/.auth/",
        "helpers": "tests/e2e/helpers/auth.js",
        "setup": "tests/e2e/global-setup.js"
      }
    ],
    "visual_tests": [
      {
        "directory": "tests/visual-interactive",
        "purpose": "Visual regression and interactive testing",
        "structure": {
          "scenarios": "Test scenarios organized by feature",
          "helpers": "Test helper utilities",
          "reports": "Test execution reports",
          "screenshots": "Test screenshots",
          "videos": "Test recordings"
        },
        "key_files": [
          "orchestrator.cjs - Test orchestration",
          "runner.cjs - Test execution",
          "reporter.cjs - Report generation",
          "config.cjs - Test configuration",
          "helpers.cjs - Test utilities",
          "diagnose-page-structure.cjs - Page structure analysis"
        ],
        "scenario_categories": [
          "admin-bar",
          "advanced",
          "backgrounds",
          "buttons",
          "content",
          "effects",
          "form-controls",
          "general",
          "live-preview",
          "login",
          "menu",
          "palettes",
          "responsive",
          "templates",
          "typography",
          "widgets"
        ]
      }
    ],
    "cypress_tests": [
      {
        "directory": "tests/cypress",
        "framework": "Cypress",
        "config": "cypress.config.js",
        "files": [
          "tests/cypress/e2e/mase-basic.cy.js"
        ],
        "support": [
          "tests/cypress/support/commands.js",
          "tests/cypress/support/e2e.js"
        ]
      }
    ],
    "other_tests": [
      "tests/browser-console-test.js",
      "tests/simple-browser-tests.js",
      "tests/curl-api-test.sh",
      "tests/benchmarks/css-generation.php"
    ]
  },
  
  "key_directories": {
    "includes": {
      "purpose": "PHP backend classes and admin functionality",
      "structure": "One class per file pattern (class-mase-*.php)",
      "note": "PSR-4 autoloader in modern-admin-styler.php"
    },
    "assets/js": {
      "purpose": "JavaScript files for admin interface",
      "structure": "Main scripts + modules subdirectory",
      "note": "Live preview integrated into mase-admin.js, not separate file"
    },
    "assets/css": {
      "purpose": "Stylesheets for admin styling",
      "naming": "BEM with mase- prefix"
    },
    "tests": {
      "purpose": "Testing suites",
      "types": [
        "e2e - Playwright end-to-end tests",
        "visual-interactive - Visual regression tests",
        "cypress - Cypress tests",
        "benchmarks - Performance benchmarks"
      ]
    },
    "docs": {
      "purpose": "Documentation and guides",
      "categories": [
        "User guides",
        "Developer guides",
        "Architecture",
        "Task summaries"
      ],
      "subdirectories": [
        "docs/archive - Archived documentation",
        "docs/screenshots - Test and feature screenshots"
      ]
    },
    "languages": {
      "purpose": "Localization files",
      "files": [
        "modern-admin-styler.pot - POT template",
        "modern-admin-styler-pl_PL.po - Polish translation",
        "modern-admin-styler-pl_PL.mo - Compiled Polish translation"
      ]
    },
    "scripts": {
      "purpose": "Build, deployment, and validation scripts",
      "files": [
        "analyze-bundles.js",
        "check-bundle-size.js",
        "check-php-syntax.sh",
        "create-package.sh",
        "deploy-production.sh",
        "generate-readme-txt.sh",
        "gradual-rollout.sh",
        "monitor-deployment.sh",
        "production-build.sh",
        "profile-performance.js",
        "security-scan.sh",
        "test-production-build.sh",
        "update-version.sh",
        "validate-all.sh",
        "validate-production.sh",
        "validate-wpcs.sh",
        "audit-nonces.sh",
        "audit-sanitization.sh"
      ]
    }
  },
  
  "asset_enqueue_mechanism": {
    "file": "includes/class-mase-admin.php",
    "method": "enqueue_assets($hook)",
    "hook": "admin_enqueue_scripts",
    "conditional_loading": "Only on 'toplevel_page_mase-settings' hook",
    "load_order": [
      "1. wp-color-picker (WordPress core)",
      "2. mase-admin.css (main styles)",
      "3. mase-palettes.css",
      "4. mase-templates.css",
      "5. mase-accessibility.css",
      "6. mase-responsive.css",
      "7. mase-asset-loader.js (MUST load first - provides utilities)",
      "8. mase-admin.js (main script with live preview integrated)",
      "9. mase-gradient-builder.js (on-demand)",
      "10. mase-pattern-library.css + .js",
      "11. mase-position-picker.js",
      "12. mase-compatibility.js (early for feature detection)",
      "13. mase-error-recovery.js (early for error handlers)",
      "14. mase-background-accessibility.js",
      "15. mase-google-fonts (conditional, if enabled)"
    ],
    "inline_scripts": {
      "dark_mode_fouc_prevention": {
        "position": "before mase-admin.js",
        "purpose": "Prevent Flash of Unstyled Content by checking localStorage synchronously",
        "execution_time": "<50ms",
        "requirements": ["12.1", "12.2", "12.3", "12.4"]
      }
    },
    "inline_styles": {
      "dashicons_pointer_fix": {
        "position": "inline with mase-admin.css",
        "purpose": "Fix dashicons blocking toggle clicks with pointer-events: none",
        "critical": true,
        "requirements": ["1.1-1.5", "4.1-4.5"]
      },
      "adminbar_visibility_fix": {
        "position": "admin_head hook",
        "purpose": "Force admin bar to be visible on MASE settings page",
        "added": "2025-10-29",
        "line": 698
      }
    },
    "localized_data": {
      "maseAdmin": {
        "ajaxUrl": "admin-ajax.php URL",
        "nonce": "mase_save_settings nonce",
        "debug": "WP_DEBUG status",
        "palettes": "Palette data from get_palettes_data()",
        "templates": "Template data from get_templates_data()",
        "gradientPresets": "Gradient presets from get_gradient_presets_data()",
        "strings": "UI strings (translatable)"
      },
      "maseL10n": {
        "dark_mode_strings": "Dark mode FAB tooltips and announcements",
        "error_messages": "Error messages for all operations",
        "ui_messages": "General UI feedback messages"
      },
      "masePatternLibrary": {
        "patterns": "Pattern library data (also loaded via AJAX on-demand)"
      }
    }
  },
  
  "ajax_handlers": {
    "core_settings": [
      "mase_save_settings - Main settings save with full validation",
      "mase_export_settings - Export configuration",
      "mase_import_settings - Import configuration",
      "mase_reset_settings - Reset to defaults"
    ],
    "palettes": [
      "mase_apply_palette - Apply color palette (bypasses full validation)",
      "mase_save_custom_palette - Save custom palette (bypasses full validation)",
      "mase_delete_custom_palette - Delete custom palette (bypasses full validation)"
    ],
    "templates": [
      "mase_apply_template - Apply template (bypasses full validation)",
      "mase_save_custom_template - Save custom template (bypasses full validation)",
      "mase_delete_custom_template - Delete custom template (bypasses full validation)"
    ],
    "backups": [
      "mase_create_backup - Create settings backup",
      "mase_restore_backup - Restore from backup",
      "mase_get_backups - List available backups"
    ],
    "uploads": [
      "mase_upload_menu_logo - Upload menu logo",
      "mase_upload_login_logo - Upload login logo",
      "mase_upload_login_background - Upload login background",
      "mase_upload_background_image - Upload background image",
      "mase_select_background_image - Select from media library",
      "mase_remove_background_image - Remove background image"
    ],
    "dark_mode": [
      "mase_toggle_dark_mode - Toggle dark/light mode"
    ],
    "buttons": [
      "mase_get_button_defaults - Get default button settings",
      "mase_reset_button_type - Reset specific button type",
      "mase_reset_all_buttons - Reset all button settings"
    ],
    "patterns": [
      "mase_get_pattern_library - Load pattern library data"
    ],
    "error_logging": [
      "mase_log_client_error - Log client-side errors"
    ],
    "mobile": [
      "mase_store_low_power_detection - Store low-power mode detection",
      "mase_report_device_capabilities - Report device capabilities"
    ]
  },
  
  "live_preview_architecture": {
    "integration": "Integrated into mase-admin.js as MASE.livePreview module",
    "not_separate_file": true,
    "note": "There is NO separate mase-admin-live-preview.js file",
    "primary_file": "assets/js/mase-admin.js",
    "module_name": "MASE.livePreview",
    "enqueue_location": "includes/class-mase-admin.php::enqueue_assets()",
    "dependencies": ["jquery", "wp-color-picker", "mase-asset-loader"],
    "localized_data": ["maseAdmin", "maseL10n"],
    "purpose": "Prevent duplicate event handlers and race conditions by keeping all functionality in one file"
  },
  
  "security_implementation": {
    "nonce_verification": "All AJAX handlers use check_ajax_referer('mase_save_settings', 'nonce')",
    "capability_checks": "All AJAX handlers verify current_user_can('manage_options')",
    "input_sanitization": "sanitize_text_field(), sanitize_hex_color(), absint()",
    "output_escaping": "esc_html(), esc_attr(), esc_url()",
    "file_uploads": "Type validation, size limits, MIME verification, SVG sanitization",
    "requirements": ["22.1", "22.2", "22.3"]
  },
  
  "recent_changes": {
    "adminbar_visibility_fix": {
      "file": "includes/class-mase-admin.php",
      "line": 698,
      "change": "Added inline CSS to force admin bar visibility on settings page",
      "reason": "Admin bar sometimes hidden by WordPress on certain admin pages",
      "date": "2025-10-29",
      "implementation": "Inline style in admin_head hook with !important rules"
    },
    "content_spacing_fix": {
      "file": "includes/class-mase-settings.php",
      "line": 482,
      "change": "Changed content left margin from 20px to 0px",
      "reason": "WordPress already has proper margin from menu",
      "date": "2025-10-29"
    },
    "menu_background_fix": {
      "file": "includes/class-mase-css-generator.php",
      "methods": ["generate_admin_menu_css()", "generate_glassmorphism_css()"],
      "change": "Apply background only to #adminmenuback, not all three layers",
      "reason": "Prevent color stacking (3 layers = 3x darker)",
      "requirements": ["6.1", "6.2", "6.4", "6.5", "12.1", "12.2", "12.3"]
    }
  },
  
  "architecture_patterns": {
    "php": {
      "pattern": "WordPress plugin architecture",
      "conventions": [
        "One class per file",
        "PSR-4 autoloader in modern-admin-styler.php",
        "WordPress hooks/filters exclusively",
        "Security: nonce verification, capability checks, input sanitization",
        "Settings stored in wp_options table"
      ]
    },
    "javascript": {
      "pattern": "Module pattern with jQuery",
      "conventions": [
        "Namespace: MASE global object",
        "jQuery(document).ready() wrappers",
        "Event-driven architecture",
        "Localized data via wp_localize_script()",
        "Live preview integrated into main file, not separate"
      ]
    },
    "css": {
      "pattern": "BEM methodology",
      "conventions": [
        "Prefix: mase-",
        "CSS custom properties for theming",
        "Mobile-first responsive design"
      ]
    }
  },
  
  "performance_optimizations": {
    "caching": {
      "strategy": "Mode-specific CSS caching",
      "cache_keys": ["Light mode", "Dark mode", "Login", "Buttons", "Generated CSS"],
      "invalidation": "On settings save or mode toggle",
      "duration": "3600 seconds (1 hour)"
    },
    "lazy_loading": {
      "assets": "Conditional loading based on active tab",
      "modules": "On-demand module loading via asset loader",
      "fonts": "Google Fonts loaded only when enabled and typography tab active"
    },
    "css_generation": {
      "target": "<100ms generation time",
      "method": "String concatenation (faster than array joins)",
      "cache_hit": "<1ms response time",
      "cache_miss": "~50-100ms generation time"
    }
  },
  
  "accessibility_compliance": {
    "standard": "WCAG 2.1 AA",
    "features": [
      "Keyboard navigation",
      "Focus indicators",
      "ARIA labels and attributes",
      "Screen reader announcements",
      "Color contrast compliance"
    ],
    "requirements": ["9.1", "9.2", "9.3", "9.4", "9.5", "13.1-13.5"]
  },
  
  "build_and_deployment": {
    "build_tool": "Vite",
    "config": "vite.config.js",
    "scripts": {
      "dev": "vite",
      "build": "vite build",
      "test": "vitest --run",
      "test:e2e": "playwright test",
      "test:visual": "node tests/visual-interactive/runner.cjs --mode interactive",
      "lint": "eslint assets/js/**/*.js",
      "validate:all": "npm run validate:php && npm run lint && npm run validate:security",
      "build:production": "bash scripts/production-build.sh",
      "deploy": "bash scripts/deploy-production.sh"
    },
    "deployment_scripts": [
      "scripts/production-build.sh",
      "scripts/deploy-production.sh",
      "scripts/monitor-deployment.sh",
      "scripts/gradual-rollout.sh",
      "scripts/validate-production.sh"
    ]
  }
}
