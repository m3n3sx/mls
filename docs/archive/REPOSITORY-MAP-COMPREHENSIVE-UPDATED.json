{
  "plugin_info": {
    "name": "Modern Admin Styler Enterprise (MASE)",
    "version": "1.3.0",
    "description": "Enterprise-grade WordPress admin styling plugin with clean dark mode implementation",
    "main_file": "modern-admin-styler.php",
    "last_updated": "2025-10-29",
    "status": "DARK MODE REFACTORED - Clean CSS implementation"
  },

  "recent_critical_changes": {
    "dark_mode_css_refactor": {
      "file": "assets/css/mase-admin.css",
      "lines": "9800-9890",
      "date": "2025-10-29",
      "change": "Replaced 'nuclear option' CSS with clean CSS variables implementation",
      "removed": [
        "Nuclear option: *[style*='#6b6b6b'] { display: none !important; }",
        "Aggressive pseudo-element hiding",
        "Complex circular background prevention",
        "150+ lines of defensive CSS"
      ],
      "added": [
        "CSS variables for dark mode colors (--mase-bg-primary, --mase-text-primary, etc.)",
        "Clean selectors targeting WordPress core elements",
        "Smooth transitions (0.3s ease)",
        "~90 lines of maintainable CSS"
      ],
      "benefits": [
        "No more hiding legitimate gray elements",
        "Predictable behavior",
        "Better performance (no attribute selectors)",
        "Professional, maintainable code",
        "Easier debugging"
      ],
      "status": "IMPLEMENTED - Ready for testing"
    },
    "global_dark_mode_implementation": {
      "file": "includes/class-mase-admin.php",
      "methods": ["enqueue_global_dark_mode()", "render_global_dark_mode_fab()", "handle_ajax_toggle_dark_mode()"],
      "lines": "157-217, 3465+",
      "status": "IMPLEMENTED",
      "features": [
        "Floating Action Button (FAB) on all admin pages",
        "Keyboard shortcut: Ctrl+Shift+D",
        "localStorage persistence",
        "User meta synchronization",
        "AJAX save to server"
      ]
    }
  },

  "php_files": {
    "core_classes": [
      {
        "file": "includes/class-mase-admin.php",
        "class": "MASE_Admin",
        "lines": 5483,
        "purpose": "Admin interface, asset enqueuing, AJAX handlers",
        "key_methods": [
          "enqueue_assets($hook) - Conditional asset loading for settings page only",
          "enqueue_global_dark_mode($hook) - Global dark mode assets on all admin pages",
          "render_global_dark_mode_fab() - Floating action button for dark mode toggle",
          "handle_ajax_toggle_dark_mode() - Dark mode toggle AJAX handler",
          "inject_custom_css() - Injects generated CSS into admin head",
          "handle_ajax_save_settings() - Main settings save with full validation",
          "ajax_apply_palette() - Palette application (bypasses full validation)",
          "ajax_apply_template() - Template application (bypasses full validation)"
        ],
        "asset_enqueue_order": [
          "1. wp-color-picker (WordPress core)",
          "2. mase-admin.css (main styles with clean dark mode)",
          "3. mase-palettes.css",
          "4. mase-templates.css",
          "5. mase-accessibility.css",
          "6. mase-responsive.css",
          "7. mase-asset-loader.js (MUST load first - provides utilities)",
          "8. mase-admin.js (main script with integrated live preview)",
          "9. mase-gradient-builder.js (on-demand)",
          "10. mase-pattern-library.css + .js",
          "11. mase-position-picker.js",
          "12. mase-compatibility.js (early for feature detection)",
          "13. mase-error-recovery.js (early for error handlers)",
          "14. mase-background-accessibility.js"
        ],
        "inline_scripts": {
          "dark_mode_fouc_prevention": {
            "position": "before mase-admin.js",
            "purpose": "Prevent FOUC by checking localStorage synchronously",
            "execution_time": "<50ms"
          }
        },
        "localized_data": {
          "maseL10n": "Dark mode translations and UI strings",
          "maseAdmin": "AJAX config, palettes, templates, gradient presets"
        }
      },
      {
        "file": "includes/class-mase-settings.php",
        "class": "MASE_Settings",
        "lines": 7881,
        "purpose": "Settings storage, retrieval, validation, defaults",
        "option_name": "mase_settings"
      },
      {
        "file": "includes/class-mase-css-generator.php",
        "class": "MASE_CSS_Generator",
        "lines": 7892,
        "purpose": "Generates CSS from settings with mode-specific caching",
        "performance_target": "<100ms generation time"
      },
      {
        "file": "includes/class-mase-cache.php",
        "class": "MASE_Cache",
        "purpose": "CSS caching using WordPress transients",
        "cache_keys": [
          "mase_generated_css_light_v1.3.0",
          "mase_generated_css_dark_v1.3.0",
          "mase_login_css",
          "mase_button_css"
        ]
      },
      {
        "file": "includes/class-mase-cachemanager.php",
        "class": "MASE_CacheManager",
        "purpose": "Static cache management wrapper"
      },
      {
        "file": "includes/class-mase-migration.php",
        "class": "MASE_Migration",
        "purpose": "Version migration and upgrade handling"
      },
      {
        "file": "includes/class-mase-mobile-optimizer.php",
        "class": "MASE_Mobile_Optimizer",
        "purpose": "Mobile device optimization and detection"
      },
      {
        "file": "includes/class-mase-rest-api.php",
        "class": "MASE_REST_API",
        "purpose": "REST API endpoints"
      },
      {
        "file": "includes/class-mase-background-migration.php",
        "class": "MASE_Background_Migration",
        "purpose": "Background system migration"
      }
    ],
    "template_files": [
      "includes/admin-settings-page.php - Main admin settings page (5972 lines)",
      "includes/backgrounds-tab-content.php",
      "includes/form-controls-tab-content.php",
      "includes/login-tab-section.php",
      "includes/universal-buttons-tab-content.php",
      "includes/visual-effects-section.php",
      "includes/widgets-tab-content.php",
      "includes/templates/content-tab.php"
    ]
  },

  "js_files": {
    "main_scripts": [
      {
        "file": "assets/js/mase-admin.js",
        "purpose": "Main admin interface JavaScript with integrated live preview",
        "dependencies": ["jquery", "wp-color-picker", "mase-asset-loader"],
        "key_modules": [
          "MASE.livePreview - Live preview functionality (INTEGRATED, not separate file)",
          "MASE.darkMode - Dark mode toggle",
          "MASE.palettes - Palette management",
          "MASE.templates - Template management",
          "MASE.settings - Settings save/load"
        ],
        "note": "Live preview is NOT a separate file - it's integrated to prevent duplicate event handlers"
      },
      {
        "file": "assets/js/mase-global-dark-mode.js",
        "purpose": "Global dark mode toggle for all admin pages",
        "dependencies": ["jquery"],
        "features": [
          "FAB click handler",
          "Keyboard shortcut: Ctrl+Shift+D",
          "localStorage persistence",
          "AJAX save to server",
          "Smooth mode switching"
        ],
        "localized_data": "maseGlobalDarkMode (ajaxUrl, nonce)",
        "ajax_action": "mase_toggle_dark_mode"
      },
      {
        "file": "assets/js/mase-accessibility.js",
        "purpose": "Accessibility features (WCAG 2.1 AA compliance)",
        "dependencies": ["jquery"]
      },
      {
        "file": "assets/js/mase-pattern-library.js",
        "purpose": "Pattern library for backgrounds",
        "dependencies": ["jquery", "mase-admin", "mase-asset-loader"]
      },
      {
        "file": "assets/js/mase-position-picker.js",
        "purpose": "Background position picker UI",
        "dependencies": ["jquery", "mase-admin", "mase-asset-loader"]
      }
    ],
    "modules": [
      "assets/js/modules/mase-asset-loader.js - MUST load FIRST (provides utilities)",
      "assets/js/modules/mase-gradient-builder.js - Gradient builder UI",
      "assets/js/modules/mase-compatibility.js - Browser feature detection",
      "assets/js/modules/mase-error-recovery.js - Error recovery mechanisms",
      "assets/js/modules/mase-background-accessibility.js - Background accessibility",
      "assets/js/modules/event-bus.js",
      "assets/js/modules/state-manager.js",
      "assets/js/modules/palette-manager.js",
      "assets/js/modules/template-manager.js",
      "assets/js/modules/preview-engine.js",
      "assets/js/modules/animations.js",
      "assets/js/modules/animation-timeline.js",
      "assets/js/modules/animation-presets.js",
      "assets/js/modules/color-system.js",
      "assets/js/modules/typography.js",
      "assets/js/modules/api-client.js",
      "assets/js/modules/ai-suggestions.js",
      "assets/js/modules/event-adapter.js",
      "assets/js/modules/main-admin.js",
      "assets/js/modules/index.js"
    ],
    "removed_files": [
      {
        "file": "assets/js/mase-admin-live-preview.js",
        "status": "DOES NOT EXIST",
        "reason": "Live preview integrated into mase-admin.js to prevent duplicate event handlers"
      }
    ]
  },

  "css_files": {
    "main_stylesheets": [
      {
        "file": "assets/css/mase-admin.css",
        "lines": 15425,
        "purpose": "Main admin interface styles with clean dark mode implementation",
        "dependencies": ["wp-color-picker"],
        "dark_mode_implementation": {
          "approach": "CSS variables with clean selectors",
          "lines": "9800-9890",
          "variables": [
            "--mase-bg-primary: #1a1a1a",
            "--mase-bg-secondary: #2a2a2a",
            "--mase-text-primary: #e0e0e0",
            "--mase-text-secondary: #b0b0b0",
            "--mase-border: #3a3a3a",
            "--mase-surface: #2a2a2a",
            "--mase-surface-hover: #3a3a3a"
          ],
          "selectors": [
            "html[data-theme='dark']",
            "body.mase-dark-mode"
          ],
          "transitions": "0.3s ease for smooth mode switching"
        }
      },
      {
        "file": "assets/css/mase-palettes.css",
        "purpose": "Palette gallery styles",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-templates.css",
        "purpose": "Template gallery styles",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-accessibility.css",
        "purpose": "Accessibility enhancements",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-responsive.css",
        "purpose": "Responsive design styles",
        "dependencies": ["mase-admin"]
      },
      {
        "file": "assets/css/mase-pattern-library.css",
        "purpose": "Pattern library UI styles"
      },
      {
        "file": "assets/css/mase-animation-editor.css",
        "purpose": "Animation editor UI styles"
      }
    ]
  },

  "test_files": {
    "e2e_tests": [
      "tests/e2e/comprehensive-functionality-test.spec.js",
      "tests/e2e/quick-smoke-test.spec.js",
      "tests/e2e/global-setup.js",
      "tests/e2e/helpers/auth.js"
    ],
    "visual_tests": [
      "tests/visual-interactive/**/* - Visual regression and interactive testing"
    ],
    "cypress_tests": [
      "tests/cypress/e2e/mase-basic.cy.js",
      "tests/cypress/support/commands.js",
      "tests/cypress/support/e2e.js"
    ]
  },

  "key_directories": {
    "includes": "PHP backend classes and admin functionality",
    "assets/js": "JavaScript files for admin interface",
    "assets/css": "Stylesheets for admin styling",
    "tests": "Testing suites (e2e, visual-interactive, cypress, benchmarks)",
    "docs": "Documentation and guides",
    "languages": "Localization files"
  },

  "dark_mode_architecture": {
    "status": "REFACTORED - Clean implementation",
    "approach": "CSS variables + simple selectors",
    "components": {
      "css": {
        "file": "assets/css/mase-admin.css",
        "lines": "9800-9890",
        "implementation": "CSS variables for colors, clean selectors for WordPress elements",
        "removed": "Nuclear option CSS (150+ lines of defensive code)",
        "added": "~90 lines of clean, maintainable CSS"
      },
      "global_toggle": {
        "file": "assets/js/mase-global-dark-mode.js",
        "purpose": "Global dark mode toggle on all admin pages",
        "features": [
          "FAB in bottom-right corner",
          "Keyboard shortcut: Ctrl+Shift+D",
          "localStorage persistence",
          "User meta synchronization"
        ]
      },
      "php_handler": {
        "file": "includes/class-mase-admin.php",
        "method": "handle_ajax_toggle_dark_mode()",
        "action": "wp_ajax_mase_toggle_dark_mode",
        "saves_to": "user_meta: mase_dark_mode_preference"
      }
    },
    "benefits": [
      "No more hiding legitimate elements",
      "Predictable behavior",
      "Better performance",
      "Professional code",
      "Easier debugging",
      "Maintainable"
    ]
  },

  "live_preview_architecture": {
    "integration": "Integrated into mase-admin.js as MASE.livePreview module",
    "not_separate_file": true,
    "primary_file": "assets/js/mase-admin.js",
    "module_name": "MASE.livePreview",
    "purpose": "Prevent duplicate event handlers and race conditions"
  },

  "security_implementation": {
    "nonce_verification": "All AJAX handlers use check_ajax_referer()",
    "capability_checks": "All AJAX handlers verify current_user_can('manage_options')",
    "input_sanitization": "sanitize_text_field(), sanitize_hex_color(), absint()",
    "output_escaping": "esc_html(), esc_attr(), esc_url()"
  },

  "next_steps": {
    "testing": [
      "Clear browser cache and localStorage",
      "Test dark mode toggle on all admin pages",
      "Verify no gray circles appear",
      "Test keyboard shortcut (Ctrl+Shift+D)",
      "Verify smooth transitions",
      "Check localStorage persistence",
      "Test user meta synchronization"
    ],
    "cleanup": [
      "Remove debug-gray-circle.js (no longer needed)",
      "Remove DARK-MODE-REFACTOR-PLAN.md (completed)",
      "Remove DARK-MODE-REBUILD-PLAN.md (completed)",
      "Update documentation with new clean implementation"
    ]
  }
}
